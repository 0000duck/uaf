<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Client examples &mdash; PyUAF 2.3.0 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="PyUAF 2.3.0 documentation" href="index.html" />
    <link rel="next" title="pyuaf" href="api_pyuaf.html" />
    <link rel="prev" title="PyUAF - Python bindings for the UAF (Unified Architecture Framework)" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api_pyuaf.html" title="pyuaf"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="PyUAF - Python bindings for the UAF (Unified Architecture Framework)"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PyUAF 2.3.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="client-examples">
<h1>Client examples<a class="headerlink" href="#client-examples" title="Permalink to this headline">¶</a></h1>
<div class="section" id="easiest-client-example">
<h2>Easiest client example<a class="headerlink" href="#easiest-client-example" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># examples/pyuaf/client/easiest_client_example.py</span>

<span class="c1"># Start the demo server ($SDK/bin/uaservercpp) of Unified Automation before running this script!</span>

<span class="kn">import</span> <span class="nn">pyuaf</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">Address</span><span class="p">,</span> <span class="n">NodeId</span>
<span class="kn">from</span> <span class="nn">pyuaf.client</span>           <span class="k">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.settings</span>  <span class="k">import</span> <span class="n">ClientSettings</span>

<span class="c1"># create a client named &quot;myClient&quot;, and provide the discovery URL of the server (uaservercpp):</span>
<span class="n">myClient</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">ClientSettings</span><span class="p">(</span><span class="s2">&quot;myClient&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;opc.tcp://localhost:48010&quot;</span><span class="p">]))</span>

<span class="c1"># specify the address of the node of which we would like to read its Value attribute:</span>
<span class="c1"># (here we&#39;re using an absolute address, i.e. a NodeId(&lt;identifier&gt;, &lt;namespace URI&gt;) and a &lt;server URI&gt;)</span>
<span class="n">someAddress</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="n">NodeId</span><span class="p">(</span><span class="s2">&quot;Demo.SimulationSpeed&quot;</span><span class="p">,</span>                         <span class="c1"># NodeId identifier</span>
                             <span class="s2">&quot;http://www.unifiedautomation.com/DemoServer&quot;</span><span class="p">),</span> <span class="c1"># NodeId namespace URI</span>
                      <span class="s2">&quot;urn:UnifiedAutomation:UaServerCpp&quot;</span><span class="p">)</span>                   <span class="c1"># server URI</span>

<span class="c1"># read the Value attribute of the node that we just addressed:</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="p">[</span><span class="n">someAddress</span><span class="p">]</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The value is </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-define-addresses">
<h2>How to define addresses?<a class="headerlink" href="#how-to-define-addresses" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># examples/pyuaf/util/how_to_define_addresses.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Example: how to define addresses</span>
<span class="sd">====================================================================================================</span>

<span class="sd">An OPC UA address space consists of Nodes, connected to each other by References. </span>

<span class="sd">In the UAF, these Nodes can be addressed in two ways:</span>
<span class="sd">  1) by their ExpandedNodeId (or NodeId and a server URI)</span>
<span class="sd">  2) by a RelativePath relative to another address</span>

<span class="sd">1) An ExpandedNodeId is like an &quot;absolute address&quot; of a Node. It contains </span>
<span class="sd"> - a server URI : information about the server that hosts the Node </span>
<span class="sd"> - a NodeId     : information to locate the Node within the address space of that server.</span>

<span class="sd">2) A RelativePath on the other hand is like a &quot;relative address&quot; of a Node. Since</span>
<span class="sd">an address space of a server is a sort of &quot;web&quot; of Nodes and References, you </span>
<span class="sd">can follow a path of references and nodes to locate a particular Node. This path contains:</span>
<span class="sd"> - a starting node: the node from which the relative path starts</span>
<span class="sd"> - a relative path: the path that leads to the node of our interest.</span>
<span class="sd">                    This path consists of one or more elements, </span>
<span class="sd">                    and each element consists of a BrowseName and some other properties.</span>

<span class="sd">Either way, the node is defined within a certain namespace (a sort of &quot;context&quot;) because they </span>
<span class="sd">consist of elements that have an associated namespace URI. This URI (a Uniform Resource Identifier)</span>
<span class="sd">is in fact just a string that fully defines the namespace. For instance, the standard OPC UA</span>
<span class="sd">namespace has the namespace URI &quot;http://opcfoundation.org/UA/&quot;. This means that all NodeIds </span>
<span class="sd">and BrowseNames defined by the OPC UA standard are all qualified by this OPC UA namespace URI. </span>
<span class="sd">If you define your own nodes, you should define them within your own namespace, which could have</span>
<span class="sd">the following URI for example: &quot;http://www.myorganization.org/mymachines/&quot;.</span>

<span class="sd">While namespaces are defined by a URI, they can also be referred to by an integer: the namespace </span>
<span class="sd">index. OPC UA servers expose a NamespaceArray that map these namespace indexes to URIs.</span>
<span class="sd">So all identifiers and qualified names exposed by a server can simply refer to a namespace index, </span>
<span class="sd">and it is the responsibility of the client to read the NamespaceArray and use it to convert the </span>
<span class="sd">namespace indexes into URIs. Fortunately, a UAF Client will do this conversion for you, behind the</span>
<span class="sd">scenes. Namespace indexes therefore do NOT suffice to qualify an identifier or a name, since they</span>
<span class="sd">depend on a mapping (the NamespaceArray), and this mapping depends on the server and may change</span>
<span class="sd">over time. One notable exception is namespace index 0 (zero). This index is reserved for the </span>
<span class="sd">standard OPC UA namespace, so it ALWAYS (!) refers to namespace URI &quot;http://opcfoundation.org/UA/&quot;.</span>
<span class="sd">&quot;&quot;&quot;</span> 

<span class="kn">import</span> <span class="nn">pyuaf</span>
<span class="kn">from</span> <span class="nn">pyuaf.client</span>                   <span class="k">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.settings</span>          <span class="k">import</span> <span class="n">ClientSettings</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>                     <span class="k">import</span> <span class="n">Address</span><span class="p">,</span> <span class="n">ExpandedNodeId</span><span class="p">,</span> <span class="n">RelativePathElement</span><span class="p">,</span> <span class="n">QualifiedName</span><span class="p">,</span> <span class="n">LocalizedText</span><span class="p">,</span> <span class="n">NodeId</span>
<span class="kn">from</span> <span class="nn">pyuaf.util.opcuaidentifiers</span>    <span class="k">import</span> <span class="n">OpcUaId_RootFolder</span><span class="p">,</span> <span class="n">OpcUaId_ObjectsFolder</span><span class="p">,</span> <span class="n">OpcUaId_ObjectsFolder</span><span class="p">,</span> <span class="n">OpcUaId_Server</span>
<span class="kn">from</span> <span class="nn">pyuaf.util.constants</span>           <span class="k">import</span> <span class="n">OPCUA_NAMESPACE_URI</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span>

<span class="c1">#========================================================#</span>
<span class="c1">#                     standard nodes                     #</span>
<span class="c1">#========================================================#</span>

<span class="c1"># First we define some standard OPC UA nodes. </span>
<span class="c1"># Standard nodes have NodeIds that are fully defined by the OPC UA standard.</span>
<span class="c1"># For instance, the Root node that is present on all servers, has a</span>
<span class="c1">#   - namespace URI &quot;http://opcfoundation.org/UA/&quot; --&gt; defined as pyuaf.util.constants.OPCUA_NAMESPACE_URI</span>
<span class="c1">#   - namespace index 0                            --&gt; defined as pyuaf.util.constants.OPCUA_NAMESPACE_ID</span>
<span class="c1">#                                                      (note that index 0 is ALWAYS reserved for the OPC UA namespace!) </span>
<span class="c1">#   - the numeric NodeId identifier 84             --&gt; defined as pyuaf.util.opcuaidentifiers.OpcUaId_RootFolder</span>
<span class="c1"># </span>
<span class="c1"># So here are all valid ways to define the Root node: </span>
<span class="n">Root_NodeId</span> <span class="o">=</span> <span class="n">NodeId</span><span class="p">(</span><span class="mi">84</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">Root_NodeId</span> <span class="o">=</span> <span class="n">NodeId</span><span class="p">(</span><span class="n">OpcUaId_RootFolder</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">)</span>                      <span class="c1"># same as the previous, but with symbols</span>
<span class="n">Root_NodeId</span> <span class="o">=</span> <span class="n">NodeId</span><span class="p">(</span><span class="n">OpcUaId_RootFolder</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_URI</span><span class="p">)</span>                     <span class="c1"># namespace URI instead of namespace index</span>
<span class="n">Root_NodeId</span> <span class="o">=</span> <span class="n">NodeId</span><span class="p">(</span><span class="n">OpcUaId_RootFolder</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_URI</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">)</span> <span class="c1"># redundant namespace info, but valid</span>

<span class="c1"># NodeIds don&#39;t contain info about the server they are hosted by.</span>
<span class="c1"># If you specifically want to refer to a NodeId within a particular server, you need to</span>
<span class="c1"># use an ExpandedNodeId, which contains</span>
<span class="c1">#   - a NodeId</span>
<span class="c1">#   - and a serverUri</span>
<span class="c1"># Assume from now on that the particular nodes we want to refer to, are hosted by a server defined</span>
<span class="c1"># by the server URI &quot;urn:UnifiedAutomation:UaDemoserver&quot;:</span>
<span class="n">serverUri</span> <span class="o">=</span> <span class="s2">&quot;urn:UnifiedAutomation:UaDemoserver&quot;</span> 
<span class="c1"># Then we can refer to the Root node like this:</span>
<span class="n">Root_Node</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">Root_NodeId</span><span class="p">,</span> <span class="n">serverUri</span> <span class="p">)</span>
<span class="c1"># An absolute address can also be created directly from an ExpandedNodeId:</span>
<span class="n">Root_Node</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">ExpandedNodeId</span><span class="p">(</span><span class="n">OpcUaId_RootFolder</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">,</span> <span class="n">serverUri</span><span class="p">)</span> <span class="p">)</span>

<span class="c1"># within the Root folder, there is another standard node called the Objects folder:</span>
<span class="n">Objects_Node</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="n">OpcUaId_ObjectsFolder</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">),</span> <span class="n">serverUri</span> <span class="p">)</span>

<span class="c1"># we could also refer to the Objects node via a relative path!</span>
<span class="c1"># We can do this, since the standard Object node has a standard BrowseName. </span>
<span class="c1"># The following are all valid ways to define the BrowseName of the Objects node </span>
<span class="n">Objects_BrowseName</span> <span class="o">=</span> <span class="n">QualifiedName</span><span class="p">(</span><span class="s2">&quot;Objects&quot;</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">)</span>
<span class="n">Objects_BrowseName</span> <span class="o">=</span> <span class="n">QualifiedName</span><span class="p">(</span><span class="s2">&quot;Objects&quot;</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_URI</span><span class="p">)</span>                      <span class="c1"># namespace URI instead of index</span>
<span class="n">Objects_BrowseName</span> <span class="o">=</span> <span class="n">QualifiedName</span><span class="p">(</span><span class="s2">&quot;Objects&quot;</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_URI</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">)</span>  <span class="c1"># redundant namespace info, but valid</span>
<span class="c1"># we can now create a path from the Root node to the Objects node, using a path of one element:</span>
<span class="n">Objects_Node</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">Root_Node</span><span class="p">,</span> <span class="p">[</span> <span class="n">RelativePathElement</span><span class="p">(</span><span class="n">Objects_BrowseName</span><span class="p">)</span> <span class="p">]</span> <span class="p">)</span>
<span class="c1"># The Objects_Node that we just created, refers to the exact same node as the Objects_Node that we previously created.</span>

<span class="c1"># within the Objects node, there is a standard node called Server, which represents a sort </span>
<span class="c1"># of object that contains all kinds of information about the server. </span>
<span class="c1"># The following are all equally valid ways to define this node:</span>
<span class="n">Server_Node</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">ExpandedNodeId</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="n">OpcUaId_Server</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">),</span> <span class="n">serverUri</span><span class="p">)</span> <span class="p">)</span>
<span class="n">Server_Node</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">ExpandedNodeId</span><span class="p">(</span> <span class="n">OpcUaId_Server</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">,</span> <span class="n">serverUri</span><span class="p">)</span> <span class="p">)</span>
<span class="n">Server_Node</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">Root_Node</span>   <span class="p">,</span> <span class="p">[</span> <span class="n">RelativePathElement</span><span class="p">(</span><span class="n">QualifiedName</span><span class="p">(</span><span class="s2">&quot;Objects&quot;</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">)),</span> 
                                       <span class="n">RelativePathElement</span><span class="p">(</span><span class="n">QualifiedName</span><span class="p">(</span><span class="s2">&quot;Server&quot;</span> <span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">))</span> <span class="p">]</span> <span class="p">)</span>
<span class="n">Server_Node</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">Objects_Node</span><span class="p">,</span> <span class="p">[</span> <span class="n">RelativePathElement</span><span class="p">(</span><span class="n">QualifiedName</span><span class="p">(</span><span class="s2">&quot;Server&quot;</span> <span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">))</span> <span class="p">]</span> <span class="p">)</span>
<span class="c1"># note that all Server_Node instances are equally valid, even the last one </span>
<span class="c1"># (which is a &quot;relative path to a relative path to an ExpandedNodeId&quot;) </span>



</pre></div>
</div>
</div>
<div class="section" id="how-to-read-some-data">
<h2>How to read some data?<a class="headerlink" href="#how-to-read-some-data" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># examples/pyuaf/client/how_to_read_some_data.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">EXAMPLE: how to read some data</span>
<span class="sd">====================================================================================================</span>

<span class="sd">A UAF Client can read data in two ways:</span>
<span class="sd">  - either using the &quot;convenience&quot; method: read()</span>
<span class="sd">  - or using the &quot;generic&quot; method: processRequest() </span>

<span class="sd">The &quot;convenience&quot; methods (such as read(), beginRead(), write(), ...) are conveniently to use </span>
<span class="sd"> (since they accept the most frequently used parameters directly), </span>
<span class="sd">but they are less powerful than the &quot;generic&quot; processRequest() method </span>
<span class="sd"> (since this method accepts ReadRequests, AsyncReadRequests, etc. that can be fully configured).</span>

<span class="sd">In this example, we will use several ways to read data:</span>
<span class="sd"> - first option  : &quot;convenience&quot; synchronous  function read()</span>
<span class="sd"> - second option : &quot;generic&quot;     synchronous  function processRequest()</span>
<span class="sd"> - third option  : &quot;convenience&quot; asynchronous function beginRead()       , with external callback</span>
<span class="sd"> - fourth option : &quot;generic&quot;     asynchronous function processRequest()  , with external callback</span>
<span class="sd"> - fifth option  : &quot;convenience&quot; asynchronous function beginRead()       , with overridden callback</span>
<span class="sd"> - sixth option  : &quot;generic&quot;     asynchronous function processRequest()  , with overridden callback</span>

<span class="sd">To run the example, start the UaDemoServer of UnifiedAutomation first on the same machine. </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">pyuaf</span>
<span class="kn">from</span> <span class="nn">pyuaf.client</span>           <span class="k">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.settings</span>  <span class="k">import</span> <span class="n">ClientSettings</span><span class="p">,</span> <span class="n">ReadSettings</span><span class="p">,</span> <span class="n">SessionSettings</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.requests</span>  <span class="k">import</span> <span class="n">ReadRequest</span><span class="p">,</span> <span class="n">AsyncReadRequest</span><span class="p">,</span> <span class="n">ReadRequestTarget</span> 
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">Address</span><span class="p">,</span> <span class="n">NodeId</span><span class="p">,</span> <span class="n">RelativePathElement</span><span class="p">,</span> <span class="n">QualifiedName</span><span class="p">,</span> <span class="n">LocalizedText</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">primitives</span>
<span class="kn">from</span> <span class="nn">pyuaf.util.errors</span>      <span class="k">import</span> <span class="n">UafError</span>


<span class="c1"># define the namespace URI and server URI of the UaDemoServer</span>
<span class="n">demoNsUri</span>     <span class="o">=</span> <span class="s2">&quot;http://www.unifiedautomation.com/DemoServer&quot;</span>
<span class="n">demoServerUri</span> <span class="o">=</span> <span class="s2">&quot;urn:UnifiedAutomation:UaServerCpp&quot;</span>

<span class="c1"># define some addresses of nodes of which we will read the Value attribute</span>
<span class="c1"># (you could also define addresses as Relative Paths to other addresses, </span>
<span class="c1">#  see the example that shows you how to define addresses)</span>
<span class="n">someDoubleNode</span>        <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s2">&quot;Demo.Static.Scalar.Double&quot;</span>              <span class="p">,</span> <span class="n">demoNsUri</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>
<span class="n">someUInt32Node</span>        <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s2">&quot;Demo.Static.Scalar.UInt32&quot;</span>              <span class="p">,</span> <span class="n">demoNsUri</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>
<span class="n">someStringNode</span>        <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s2">&quot;Demo.Static.Scalar.String&quot;</span>              <span class="p">,</span> <span class="n">demoNsUri</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>
<span class="n">someLocalizedTextNode</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s2">&quot;Demo.Static.Scalar.LocalizedText&quot;</span>       <span class="p">,</span> <span class="n">demoNsUri</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>
<span class="n">someSByteArrayNode</span>    <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s2">&quot;Demo.Static.Arrays.SByte&quot;</span>               <span class="p">,</span> <span class="n">demoNsUri</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>

<span class="c1"># define a function to print the readResult (which is of type pyuaf.client.results.ReadResult)</span>
<span class="k">def</span> <span class="nf">printResult</span><span class="p">(</span><span class="n">readResult</span><span class="p">):</span>
    <span class="c1"># overall result</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The overall status is: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="n">readResult</span><span class="o">.</span><span class="n">overallStatus</span><span class="p">))</span>
    
    <span class="c1"># target 0:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">status</span>                         <span class="c1"># &#39;status&#39; has type pyuaf.util.Status</span>
    <span class="n">data</span>   <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>                           <span class="c1"># &#39;data&#39; has type pyuaf.util.primitives.Double</span>
    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">isGood</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">primitives</span><span class="o">.</span><span class="n">Double</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The double is: </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    
    <span class="c1"># target 1:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">status</span>                         <span class="c1"># &#39;status&#39; has type pyuaf.util.Status</span>
    <span class="n">data</span>   <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>                           <span class="c1"># &#39;data&#39; has type pyuaf.util.primitives.UInt32</span>
    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">isGood</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">primitives</span><span class="o">.</span><span class="n">UInt32</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The uint32 is: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    
    <span class="c1"># target 2:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">status</span>                         <span class="c1"># &#39;status&#39; has type pyuaf.util.Status</span>
    <span class="n">data</span>   <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>                           <span class="c1"># &#39;data&#39; has type pyuaf.util.primitives.String</span>
    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">isGood</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">primitives</span><span class="o">.</span><span class="n">String</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The string is: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    
    <span class="c1"># target 3:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">status</span>                         <span class="c1"># &#39;status&#39; has type pyuaf.util.Status</span>
    <span class="n">data</span>   <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>                           <span class="c1"># &#39;data&#39; has type pyuaf.util.LocalizedText</span>
    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">isGood</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">LocalizedText</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The locale is: &#39;</span><span class="si">%s</span><span class="s2">&#39;, the text is: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">locale</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
    
    <span class="c1"># target 4:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">status</span>                         <span class="c1"># &#39;status&#39; has type pyuaf.util.Status</span>
    <span class="n">data</span>   <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>                           <span class="c1"># &#39;data&#39; is a list of pyuaf.util.primitives.SByte</span>
    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">isGood</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The array is:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; - array[</span><span class="si">%d</span><span class="s2">] = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>


<span class="c1"># define the ClientSettings:</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">ClientSettings</span><span class="p">()</span>
<span class="n">settings</span><span class="o">.</span><span class="n">applicationName</span> <span class="o">=</span> <span class="s2">&quot;MyClient&quot;</span>
<span class="n">settings</span><span class="o">.</span><span class="n">discoveryUrls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;opc.tcp://localhost:48010&quot;</span><span class="p">)</span>

<span class="c1"># create the client</span>
<span class="n">myClient</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>



<span class="c1"># read the node attributes all at once</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First option: use the convenience function read() to read data synchronously&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;============================================================================&quot;</span><span class="p">)</span>
    
<span class="c1"># OPTIONAL: You could also provide a ReadSettings to configure a call timeout, </span>
<span class="c1">#           or maximum age of the values, or ... </span>
<span class="n">serviceSettings</span> <span class="o">=</span> <span class="n">ReadSettings</span><span class="p">()</span>
<span class="n">serviceSettings</span><span class="o">.</span><span class="n">callTimeoutSec</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">serviceSettings</span><span class="o">.</span><span class="n">maxAgeSec</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># OPTIONAL: And you could also provide a SessionConfig to configure the sessions </span>
<span class="c1">#           (e.g. set the timeout to 600.0 seconds)</span>
<span class="c1">#           For more info about SessionConfigs, see the sessionconfig_example</span>
<span class="n">sessionSettings</span> <span class="o">=</span> <span class="n">SessionSettings</span><span class="p">()</span>
<span class="n">sessionSettings</span><span class="o">.</span><span class="n">sessionTimeoutSec</span> <span class="o">=</span> <span class="mf">600.0</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># now read the node attributes</span>
    <span class="n">readResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="n">addresses</span>     <span class="o">=</span> <span class="p">[</span><span class="n">someDoubleNode</span><span class="p">,</span> <span class="n">someUInt32Node</span><span class="p">,</span> <span class="n">someStringNode</span><span class="p">,</span> 
                                                 <span class="n">someLocalizedTextNode</span><span class="p">,</span> <span class="n">someSByteArrayNode</span><span class="p">],</span>
                                <span class="n">serviceSettings</span> <span class="o">=</span> <span class="n">serviceSettings</span><span class="p">,</span> <span class="c1"># optional argument</span>
                                <span class="n">sessionSettings</span> <span class="o">=</span> <span class="n">sessionSettings</span><span class="p">)</span> <span class="c1"># optional argument</span>
    
    <span class="c1"># print the result using the function we defined before</span>
    <span class="n">printResult</span><span class="p">(</span><span class="n">readResult</span><span class="p">)</span>
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Some error occurred: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>



<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Second option: use the generic function processRequest() to read data synchronously&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===================================================================================&quot;</span><span class="p">)</span>

<span class="c1"># create a request with 5 targets</span>
<span class="n">readRequest</span> <span class="o">=</span> <span class="n">ReadRequest</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">someDoubleNode</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">someUInt32Node</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">someStringNode</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">someLocalizedTextNode</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">someSByteArrayNode</span>

<span class="c1"># we could also add a 6th node, of which we want to read the DisplayName (= of type LocalizedText)</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReadRequestTarget</span><span class="p">())</span> <span class="c1"># or readRequest.targets.resize(6)</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">address</span>     <span class="o">=</span> <span class="n">someDoubleNode</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">attributeId</span> <span class="o">=</span> <span class="n">pyuaf</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">attributeids</span><span class="o">.</span><span class="n">DisplayName</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">serviceSettings</span>        <span class="o">=</span> <span class="n">serviceSettings</span> <span class="c1"># optional</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">sessionSettings</span>        <span class="o">=</span> <span class="n">sessionSettings</span> <span class="c1"># optional</span>

<span class="k">try</span><span class="p">:</span>    
    <span class="c1"># process the request</span>
    <span class="n">readResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">processRequest</span><span class="p">(</span><span class="n">readRequest</span><span class="p">)</span>
    
    <span class="c1"># print the result</span>
    <span class="n">printResult</span><span class="p">(</span><span class="n">readResult</span><span class="p">)</span>
    
    <span class="c1"># also print the display name of the 6th node:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">status</span>
    <span class="n">data</span>   <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">isGood</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">LocalizedText</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The DisplayName-locale is: &#39;</span><span class="si">%s</span><span class="s2">&#39;, the DisplayName-text is: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">locale</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Some error occurred: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>
    
    

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Third option: use the convenience function beginRead() to read data asynchronously&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==================================================================================&quot;</span><span class="p">)</span>

<span class="c1"># notice we enable asynchronous communication now by providing the printResult() method as </span>
<span class="c1"># a callback function!</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">asyncReadResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">beginRead</span><span class="p">(</span><span class="n">addresses</span>       <span class="o">=</span> <span class="p">[</span><span class="n">someDoubleNode</span><span class="p">,</span> <span class="n">someUInt32Node</span><span class="p">,</span> 
                                                            <span class="n">someStringNode</span><span class="p">,</span> <span class="n">someLocalizedTextNode</span><span class="p">,</span> 
                                                            <span class="n">someSByteArrayNode</span><span class="p">],</span>
                                         <span class="n">serviceSettings</span> <span class="o">=</span> <span class="n">serviceSettings</span><span class="p">,</span> <span class="c1"># optional argument</span>
                                         <span class="n">sessionSettings</span> <span class="o">=</span> <span class="n">sessionSettings</span><span class="p">,</span> <span class="c1"># optional argument</span>
                                         <span class="n">callback</span>        <span class="o">=</span> <span class="n">printResult</span><span class="p">)</span>     <span class="c1"># callback function!</span>
    
    <span class="c1"># check if there was an &quot;immediate&quot; error on the client side when executing the asynchronous </span>
    <span class="c1"># service call:</span>
    <span class="k">if</span> <span class="n">asyncReadResult</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OK, the client could invoke the asynchronous request without problems.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Let&#39;s wait a second for the result ...&quot;</span><span class="p">)</span>
        
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The read result should have been received by now!&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Some error occurred: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fourth option: use the generic function processRequest() to read data asynchronously&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;====================================================================================&quot;</span><span class="p">)</span>

<span class="c1"># notice we enable asynchronous communication now by providing the printResult() method as </span>
<span class="c1"># a callback function!</span>

<span class="c1"># create an asynchronous (!) request with 5 targets</span>
<span class="n">asyncReadRequest</span> <span class="o">=</span> <span class="n">AsyncReadRequest</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># we can simply copy the targets of the synchronous request to the asynchronous request:</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">asyncReadRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
<span class="c1"># OPTIONAL: also copy the service config and session config:</span>
<span class="n">asyncReadRequest</span><span class="o">.</span><span class="n">serviceSettings</span> <span class="o">=</span> <span class="n">serviceSettings</span>
<span class="n">asyncReadRequest</span><span class="o">.</span><span class="n">sessionSettings</span> <span class="o">=</span> <span class="n">sessionSettings</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># process the request</span>
    <span class="n">asyncReadResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">processRequest</span><span class="p">(</span><span class="n">asyncReadRequest</span><span class="p">,</span> <span class="n">resultCallback</span><span class="o">=</span><span class="n">printResult</span><span class="p">)</span>
    
    <span class="c1"># check if there was an &quot;immediate&quot; error on the client side when executing the asynchronous </span>
    <span class="c1"># service call:</span>
    <span class="k">if</span> <span class="n">asyncReadResult</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OK, the client could invoke the asynchronous request without problems.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Let&#39;s wait a second for the result ...&quot;</span><span class="p">)</span>
        
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The read result should have been received by now!&quot;</span><span class="p">)</span>

    
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Some error occurred: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>



<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fifth option: read data asynchronously using beginRead() without specifying external callbacks&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==============================================================================================&quot;</span><span class="p">)</span>

<span class="c1"># instead of using &quot;external&quot; callback functions (such as printResult() above), we can also use</span>
<span class="c1"># the &quot;internal&quot; callback function of the Client class. If the argument &#39;callback&#39; of beginRead() is </span>
<span class="c1"># not used (or &#39;resultCallback&#39; is not used in case of processRequest()), the asynchronous result</span>
<span class="c1"># will be dispatched to the readComplete() method of the Client class. </span>
<span class="c1"># In other words, when you subclass Client, you can simply override the readComplete() method</span>
<span class="c1"># to receive the asynchronous read results.</span>

<span class="k">class</span> <span class="nc">MySubClasssedClient</span><span class="p">(</span><span class="n">Client</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
        <span class="n">Client</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">readComplete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span> <span class="c1"># overridden method!</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is the overridden method readComplete() speaking:&quot;</span><span class="p">)</span>
        <span class="n">printResult</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="c1"># create the client</span>
<span class="n">mySubClassedClient</span> <span class="o">=</span> <span class="n">MySubClasssedClient</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
    
<span class="k">try</span><span class="p">:</span>
    <span class="n">asyncReadResult</span> <span class="o">=</span> <span class="n">mySubClassedClient</span><span class="o">.</span><span class="n">beginRead</span><span class="p">(</span>
                                         <span class="n">addresses</span>       <span class="o">=</span> <span class="p">[</span><span class="n">someDoubleNode</span><span class="p">,</span> <span class="n">someUInt32Node</span><span class="p">,</span> 
                                                            <span class="n">someStringNode</span><span class="p">,</span> <span class="n">someLocalizedTextNode</span><span class="p">,</span> 
                                                            <span class="n">someSByteArrayNode</span><span class="p">],</span>
                                         <span class="n">serviceSettings</span> <span class="o">=</span> <span class="n">serviceSettings</span><span class="p">,</span> <span class="c1"># optional argument</span>
                                         <span class="n">sessionSettings</span> <span class="o">=</span> <span class="n">sessionSettings</span><span class="p">)</span> <span class="c1"># optional argument!</span>
    <span class="c1"># note: the &#39;callback&#39; argument is not used in the above call!</span>
    
    <span class="c1"># check if there was an &quot;immediate&quot; error on the client side when executing the asynchronous </span>
    <span class="c1"># service call:</span>
    <span class="k">if</span> <span class="n">asyncReadResult</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OK, the client could invoke the asynchronous request without problems.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Let&#39;s wait a second for the result ...&quot;</span><span class="p">)</span>
        
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The read result should have been received by now!&quot;</span><span class="p">)</span>
    
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Some error occurred: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>
    


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sixth option: read data asynchronously using processRequest() without specifying external callbacks&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===================================================================================================&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># process the request</span>
    <span class="n">asyncReadResult</span> <span class="o">=</span> <span class="n">mySubClassedClient</span><span class="o">.</span><span class="n">processRequest</span><span class="p">(</span><span class="n">asyncReadRequest</span><span class="p">)</span> 
    <span class="c1"># note: the &#39;resultCallback&#39; argument is not used in the above call!</span>
    
    <span class="c1"># check if there was an &quot;immediate&quot; error on the client side when executing the asynchronous </span>
    <span class="c1"># service call:</span>
    <span class="k">if</span> <span class="n">asyncReadResult</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OK, the client could invoke the asynchronous request without problems.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Let&#39;s wait a second for the result ...&quot;</span><span class="p">)</span>
        
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The read result should have been received by now!&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Some error occurred: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>
    

</pre></div>
</div>
</div>
<div class="section" id="how-to-browse-some-nodes">
<h2>How to browse some nodes?<a class="headerlink" href="#how-to-browse-some-nodes" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># examples/pyuaf/client/how_to_browse_some_nodes.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">EXAMPLE: how to browse some nodes</span>
<span class="sd">====================================================================================================</span>

<span class="sd">A UAF Client can browse nodes in two ways:</span>
<span class="sd">  - either using the &quot;convenience&quot; method: browse()</span>
<span class="sd">  - or using the &quot;generic&quot; method: processRequest() </span>

<span class="sd">The &quot;convenience&quot; methods (such as read(), write(), call(), ...) are conveniently to use </span>
<span class="sd"> (since they accept the most frequently used parameters directly), </span>
<span class="sd">but they are less powerful than the &quot;generic&quot; processRequest() method </span>
<span class="sd"> (since this method accepts ReadRequests, WriteRequests, etc. that can be fully configured).</span>

<span class="sd">In this example, we will use both ways to browse nodes.</span>

<span class="sd">As will be shown in this example, the UAF can automatically take care of BrowseNext calls,</span>
<span class="sd">so as a user you don&#39;t have to worry about incomplete Browse results!</span>

<span class="sd">To run the example, start the UaServerCPP of UnifiedAutomation first on the same machine. </span>
<span class="sd">($SDK/bin/uaservercpp, this executable is part of the SDK).</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">pyuaf</span>
<span class="kn">from</span> <span class="nn">pyuaf.client</span>           <span class="k">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.settings</span>  <span class="k">import</span> <span class="n">ClientSettings</span><span class="p">,</span> <span class="n">BrowseSettings</span><span class="p">,</span> <span class="n">SessionSettings</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.requests</span>  <span class="k">import</span> <span class="n">BrowseRequest</span><span class="p">,</span> <span class="n">BrowseRequestTarget</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">Address</span><span class="p">,</span> <span class="n">NodeId</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">primitives</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">opcuaidentifiers</span>
<span class="kn">from</span> <span class="nn">pyuaf.util.errors</span>      <span class="k">import</span> <span class="n">UafError</span>


<span class="c1"># define the namespace URI and server URI of the UaServerCPP demo server</span>
<span class="n">demoServerUri</span> <span class="o">=</span> <span class="s2">&quot;urn:UnifiedAutomation:UaServerCpp&quot;</span>

<span class="c1"># define the address of the Root node which we would like to start browsing</span>
<span class="n">rootNode</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="n">opcuaidentifiers</span><span class="o">.</span><span class="n">OpcUaId_RootFolder</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>

<span class="c1"># define the ClientSettings:</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">ClientSettings</span><span class="p">()</span>
<span class="n">settings</span><span class="o">.</span><span class="n">applicationName</span> <span class="o">=</span> <span class="s2">&quot;MyClient&quot;</span>
<span class="n">settings</span><span class="o">.</span><span class="n">discoveryUrls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;opc.tcp://localhost:48010&quot;</span><span class="p">)</span>

<span class="c1"># create the client</span>
<span class="n">myClient</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>



<span class="k">try</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First option: use the convenience function </span><span class="se">\&quot;</span><span class="s2">browse()</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===================================================&quot;</span><span class="p">)</span>
    
    <span class="c1"># now browse the root node</span>
    <span class="c1"># (notice that there is also an argument called &#39;maxAutoBrowseNext&#39;, which we don&#39;t mention</span>
    <span class="c1">#  here because we can leave it at the default value (100), to make sure that BrowseNext is </span>
    <span class="c1"># automatically being called for us as much as needed!)</span>
    <span class="n">firstLevelBrowseResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">browse</span><span class="p">([</span><span class="n">rootNode</span><span class="p">])</span>
    
    <span class="c1"># Notice too that you can optionally provide a BrowseSettings and/or a SessionSettings argument</span>
    <span class="c1"># for more detailed configuration, like this:</span>
    <span class="c1"># OPTIONAL: let&#39;s specify a small call timeout, since the UaDemoServer is running </span>
    <span class="c1">#           on the local machine anyway:</span>
    <span class="n">browseSettings</span> <span class="o">=</span> <span class="n">BrowseSettings</span><span class="p">()</span>
    <span class="n">browseSettings</span><span class="o">.</span><span class="n">callTimeoutSec</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="c1"># OPTIONAL: and finally let&#39;s also specify that sessions should have a timeout of 600 seconds:</span>
    <span class="n">sessionSettings</span> <span class="o">=</span> <span class="n">SessionSettings</span><span class="p">()</span>
    <span class="n">sessionSettings</span><span class="o">.</span><span class="n">sessionTimeoutSec</span> <span class="o">=</span> <span class="mf">600.0</span>
    <span class="c1"># now call the browse() function:</span>
    <span class="n">myClient</span><span class="o">.</span><span class="n">browse</span><span class="p">([</span><span class="n">rootNode</span><span class="p">],</span> <span class="n">browseSettings</span> <span class="o">=</span> <span class="n">browseSettings</span><span class="p">,</span> <span class="n">sessionSettings</span> <span class="o">=</span> <span class="n">sessionSettings</span><span class="p">)</span>
    
    <span class="c1"># print the result</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; - Browse result of the first level:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ---------------------------------&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">firstLevelBrowseResult</span><span class="p">)</span>
    
    <span class="c1"># we don&#39;t expect that &quot;manual&quot; BrowseNext calls are still needed, as the UAF will</span>
    <span class="c1"># have done the BrowseNext calls up to 100 times automatically for us! If there would still be</span>
    <span class="c1"># some continuation points left, then we surely have some unexpected problem!</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">firstLevelBrowseResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">continuationPoint</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    
    <span class="c1"># we can now continue browsing the other nodes that we discovered, all simultaneously!!!</span>
    <span class="n">noOfFoundReferences</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">firstLevelBrowseResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
    <span class="n">newNodesToBeBrowsed</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">noOfFoundReferences</span><span class="p">):</span>
        <span class="n">newNodesToBeBrowsed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">Address</span><span class="p">(</span><span class="n">firstLevelBrowseResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">references</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">nodeId</span><span class="p">)</span> <span class="p">)</span>
    
    <span class="n">secondLevelBrowseResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="n">newNodesToBeBrowsed</span><span class="p">)</span>
    
    <span class="c1"># print the result</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; - Browse result of the second level:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ----------------------------------&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">secondLevelBrowseResult</span><span class="p">)</span>
    
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Second option: use the generic function </span><span class="se">\&quot;</span><span class="s2">processRequest()</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==========================================================&quot;</span><span class="p">)</span>
    
    <span class="c1"># create a request with 1 target, and re-use the browseSettings and sessionSettings </span>
    <span class="c1"># which we created earlier:</span>
    <span class="n">firstLevelBrowseRequest</span> <span class="o">=</span> <span class="n">BrowseRequest</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">firstLevelBrowseRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">rootNode</span>
    <span class="n">firstLevelBrowseRequest</span><span class="o">.</span><span class="n">serviceSettings</span> <span class="o">=</span> <span class="n">browseSettings</span>
    <span class="n">firstLevelBrowseRequest</span><span class="o">.</span><span class="n">sessionSettings</span> <span class="o">=</span> <span class="n">sessionSettings</span>
    
    <span class="c1"># process the request</span>
    <span class="n">firstLevelBrowseResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">processRequest</span><span class="p">(</span><span class="n">firstLevelBrowseRequest</span><span class="p">)</span>
    
    <span class="c1"># print the result</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; - Browse result of the first level:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ---------------------------------&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">firstLevelBrowseResult</span><span class="p">)</span>
    
    <span class="c1"># we don&#39;t expect that &quot;manual&quot; BrowseNext calls are still needed, as the UAF will</span>
    <span class="c1"># have done the BrowseNext calls up to 100 times automatically for us! If there would still be</span>
    <span class="c1"># some continuation points left, then we surely have some unexpected problem!</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">firstLevelBrowseResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">continuationPoint</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    
    <span class="c1"># we can now continue browsing the other nodes that we discovered, all simultaneously!!!</span>
    <span class="n">noOfFoundReferences</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">firstLevelBrowseResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
    <span class="n">secondLevelBrowseRequest</span> <span class="o">=</span> <span class="n">BrowseRequest</span><span class="p">(</span><span class="n">noOfFoundReferences</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">noOfFoundReferences</span><span class="p">):</span>
        <span class="n">secondLevelBrowseRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="n">firstLevelBrowseResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">references</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">nodeId</span><span class="p">)</span>
    
    <span class="n">secondLevelBrowseResult</span> <span class="o">=</span>  <span class="n">myClient</span><span class="o">.</span><span class="n">processRequest</span><span class="p">(</span><span class="n">secondLevelBrowseRequest</span><span class="p">)</span>
    
    <span class="c1"># print the result</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; - Browse result of the second level:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   ----------------------------------&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">secondLevelBrowseResult</span><span class="p">)</span>
    
    
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Some error occurred: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>
    <span class="k">raise</span>



</pre></div>
</div>
</div>
<div class="section" id="how-to-read-some-historical-data">
<h2>How to read some historical data?<a class="headerlink" href="#how-to-read-some-historical-data" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># examples/pyuaf/client/how_to_read_some_historical_data.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">EXAMPLE: how to read some historical data</span>
<span class="sd">====================================================================================================</span>

<span class="sd">A UAF Client can read historical data in two ways:</span>
<span class="sd">  - either using the &quot;convenience&quot; methods: historyReadRaw() and historyReadModified()</span>
<span class="sd">  - or using the &quot;generic&quot; method: processRequest() </span>

<span class="sd">The &quot;convenience&quot; methods (such as read(), write(), call(), ...) are conveniently to use </span>
<span class="sd"> (since they accept the most frequently used parameters directly), </span>
<span class="sd">but they are less powerful than the &quot;generic&quot; processRequest() method </span>
<span class="sd"> (since this method accepts ReadRequests, WriteRequests, etc. that can be fully configured).</span>

<span class="sd">In this example, we will use both ways to read historical data.</span>

<span class="sd">As will be shown in this example, the UAF can automatically take care of subsequent </span>
<span class="sd">history reading calls, when the first call returned a continuation point (because either the server</span>
<span class="sd">or the client restricted the number of results that were passed in one OPC UA message).</span>
<span class="sd">With this &quot;automatic&quot; UAF feature, you don&#39;t have to worry about incomplete results anymore!</span>

<span class="sd">To run the example, start the UaDemoServer of UnifiedAutomation first on the same machine. </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">pyuaf</span>
<span class="kn">from</span> <span class="nn">pyuaf.client</span>           <span class="k">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.settings</span>  <span class="k">import</span> <span class="n">ClientSettings</span><span class="p">,</span> <span class="n">HistoryReadRawModifiedSettings</span><span class="p">,</span> <span class="n">SessionSettings</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.requests</span>  <span class="k">import</span> <span class="n">HistoryReadRawModifiedRequest</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">Address</span><span class="p">,</span> <span class="n">NodeId</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">DateTime</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">DataValue</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">Status</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">RelativePathElement</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">QualifiedName</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">primitives</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">opcuaidentifiers</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">opcuastatuscodes</span>
<span class="kn">from</span> <span class="nn">pyuaf.util.errors</span>      <span class="k">import</span> <span class="n">UafError</span>


<span class="c1"># define the namespace URI and server URI of the UaDemoServer</span>
<span class="n">demoNsUri</span>     <span class="o">=</span> <span class="s2">&quot;http://www.unifiedautomation.com/DemoServer&quot;</span>
<span class="n">demoServerUri</span> <span class="o">=</span> <span class="s2">&quot;urn:UnifiedAutomation:UaServerCpp&quot;</span>

<span class="c1"># define the addresses of some useful nodes</span>
<span class="c1"># (demoAddress is an absolute address, all the others are relative ones) </span>
<span class="n">demoAddress</span>             <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s2">&quot;Demo&quot;</span><span class="p">,</span> <span class="n">demoNsUri</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>
<span class="n">simulationActiveAddress</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">demoAddress</span><span class="p">,</span> <span class="p">[</span><span class="n">RelativePathElement</span><span class="p">(</span><span class="n">QualifiedName</span><span class="p">(</span><span class="s2">&quot;SimulationActive&quot;</span><span class="p">,</span> <span class="n">demoNsUri</span><span class="p">))]</span> <span class="p">)</span>
<span class="n">startSimulationAddress</span>  <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">demoAddress</span><span class="p">,</span> <span class="p">[</span><span class="n">RelativePathElement</span><span class="p">(</span><span class="n">QualifiedName</span><span class="p">(</span><span class="s2">&quot;StartSimulation&quot;</span> <span class="p">,</span> <span class="n">demoNsUri</span><span class="p">))]</span> <span class="p">)</span>
<span class="n">historyAddress</span>          <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">demoAddress</span><span class="p">,</span> <span class="p">[</span><span class="n">RelativePathElement</span><span class="p">(</span><span class="n">QualifiedName</span><span class="p">(</span><span class="s2">&quot;History&quot;</span><span class="p">,</span> <span class="n">demoNsUri</span><span class="p">))]</span> <span class="p">)</span>
<span class="n">loggingActiveAddress</span>    <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">historyAddress</span><span class="p">,</span> <span class="p">[</span><span class="n">RelativePathElement</span><span class="p">(</span><span class="n">QualifiedName</span><span class="p">(</span><span class="s2">&quot;DataLoggerActive&quot;</span><span class="p">,</span> <span class="n">demoNsUri</span><span class="p">))]</span> <span class="p">)</span>
<span class="n">startLoggingAddress</span>     <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">historyAddress</span><span class="p">,</span> <span class="p">[</span><span class="n">RelativePathElement</span><span class="p">(</span><span class="n">QualifiedName</span><span class="p">(</span><span class="s2">&quot;StartLogging&quot;</span><span class="p">,</span> <span class="n">demoNsUri</span><span class="p">))]</span> <span class="p">)</span>
<span class="n">doubleAddress</span>           <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">historyAddress</span><span class="p">,</span> <span class="p">[</span><span class="n">RelativePathElement</span><span class="p">(</span><span class="n">QualifiedName</span><span class="p">(</span><span class="s2">&quot;DoubleWithHistory&quot;</span><span class="p">,</span> <span class="n">demoNsUri</span><span class="p">))]</span> <span class="p">)</span>

<span class="c1"># define the ClientSettings:</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">ClientSettings</span><span class="p">()</span>
<span class="n">settings</span><span class="o">.</span><span class="n">applicationName</span> <span class="o">=</span> <span class="s2">&quot;MyClient&quot;</span>
<span class="n">settings</span><span class="o">.</span><span class="n">discoveryUrls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;opc.tcp://localhost:48010&quot;</span><span class="p">)</span>

<span class="c1"># create the client</span>
<span class="n">myClient</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>

<span class="c1"># first, we need to start the simulation (if it&#39;s not already started),</span>
<span class="c1"># and we need to start the logging (if it&#39;s not already started)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="p">[</span><span class="n">simulationActiveAddress</span><span class="p">,</span><span class="n">loggingActiveAddress</span><span class="p">]</span>  <span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t read some nodes of the server: is uaservercpp started and properly configured?&quot;</span><span class="p">)</span>

<span class="n">isSimulationActive</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">value</span>
<span class="n">isLoggingActive</span>    <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">value</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;isSimulationActive : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">isSimulationActive</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;isLoggingActive    : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">isLoggingActive</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">isSimulationActive</span><span class="p">:</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">demoAddress</span><span class="p">,</span> <span class="n">startSimulationAddress</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The simulation was started&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t start the simulation: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">res</span><span class="o">.</span><span class="n">overallStatus</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">isLoggingActive</span><span class="p">:</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">historyAddress</span><span class="p">,</span> <span class="n">startLoggingAddress</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The logging was started&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t start the logging: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">res</span><span class="o">.</span><span class="n">overallStatus</span><span class="p">)</span>
    

<span class="c1"># now wait a bit more than a second, so that we have at least one second of historical data</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>


<span class="k">try</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First option: use the convenience functions historyReadRaw() and historyReadModified()&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;======================================================================================&quot;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First example:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------&quot;</span><span class="p">)</span>
    
    <span class="c1"># Read the raw historical data </span>
    <span class="c1">#   - that is provided by the double node,</span>
    <span class="c1">#   - that was recorded during the past second</span>
    <span class="c1">#   - with a maximum of a 100 returned values </span>
    <span class="c1">#     (we expect around 10 values, so 100 is a very safe margin) </span>
    <span class="c1">#   - and let the UAF invoke at most 10 &quot;continuation calls&quot;</span>
    <span class="c1">#     (we expect that all data can be returned by a single call, so a maximum of 10 </span>
    <span class="c1">#      additional calls is again a very safe margin)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">historyReadRaw</span><span class="p">(</span><span class="n">addresses</span>          <span class="o">=</span> <span class="p">[</span><span class="n">doubleAddress</span><span class="p">],</span>
                                     <span class="n">startTime</span>          <span class="o">=</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="mf">1.5</span><span class="p">),</span>
                                     <span class="n">endTime</span>            <span class="o">=</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
                                     <span class="n">numValuesPerNode</span>   <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> 
                                     <span class="n">maxAutoReadMore</span>    <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    
    <span class="c1"># print the result:</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
    
    <span class="c1"># do some processing on the result</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">isNotGood</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not read historical data from the double: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">status</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dataValues</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Strange, we didn&#39;t receive any historical data.</span>
            <span class="c1"># Check if this is expected behavior:</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">opcUaStatusCode</span> <span class="o">==</span> <span class="n">opcuastatuscodes</span><span class="o">.</span><span class="n">OpcUa_GoodNoData</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OK, no data could be received because he server reports that there is &quot;</span>
                      <span class="s2">&quot;no data that matches your request&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">allStatusCodes</span>  <span class="o">=</span> <span class="p">[]</span>
            <span class="n">allDoubleValues</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">allSourceTimes</span>  <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">for</span> <span class="n">dataValue</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dataValues</span><span class="p">:</span>
                <span class="c1"># check the data type</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dataValue</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="n">primitives</span><span class="o">.</span><span class="n">Double</span><span class="p">:</span>
                    
                    <span class="c1"># NOTE that dataValue is just a POINTER!</span>
                    <span class="c1"># So if you want to copy any objects </span>
                    <span class="c1">#  (like we&#39;re copying Status or DateTime objects to a Python list in this case),</span>
                    <span class="c1"># then you must use the copy constructors </span>
                    <span class="c1">#  (like Status(...) and DateTime(...) in this case),</span>
                    <span class="c1"># to actually copy the data!</span>
                    <span class="c1"># If you don&#39;t do this, then you will just create pointers to the underlying data.</span>
                    <span class="c1"># And when Python garbage collects this data, your pointers will point to</span>
                    <span class="c1"># invalid memory, and your software will crash when you try to use them!</span>
                    
                    <span class="n">allStatusCodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">dataValue</span><span class="o">.</span><span class="n">opcUaStatusCode</span> <span class="p">)</span>           <span class="c1"># notice the copy constructor!</span>
                    <span class="n">allDoubleValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">dataValue</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">value</span> <span class="p">)</span>               <span class="c1"># an int, no copy constructor needed</span>
                    <span class="n">allSourceTimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">dataValue</span><span class="o">.</span><span class="n">sourceTimestamp</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># notice the copy constructor!</span>
            
            <span class="c1"># now print the lists </span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The results are:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">allDoubleValues</span><span class="p">)):</span>
                
                <span class="n">timeFloat</span>  <span class="o">=</span> <span class="n">allSourceTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ctime</span><span class="p">()</span>
                <span class="n">timeTuple</span>  <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span> <span class="n">long</span><span class="p">(</span><span class="n">timeFloat</span><span class="p">)</span> <span class="p">)</span>
                <span class="n">timeString</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">,</span> <span class="n">timeTuple</span><span class="p">)</span>   \
                             <span class="o">+</span> <span class="s2">&quot;.&quot;</span>                                  \
                             <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%.3d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">allSourceTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">msec</span><span class="p">())</span>
                
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Code=</span><span class="si">%d</span><span class="s2"> - Value=</span><span class="si">%s</span><span class="s2"> - Time=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">allStatusCodes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">allDoubleValues</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">timeString</span><span class="p">))</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Second example:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------&quot;</span><span class="p">)</span>
    <span class="c1"># Now do the same, but this time get the modifications of the data of the last second.</span>
    <span class="c1"># Since we didn&#39;t do any modifications, none will be reported!</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">historyReadModified</span><span class="p">(</span><span class="n">addresses</span>          <span class="o">=</span> <span class="p">[</span><span class="n">doubleAddress</span><span class="p">],</span>
                                          <span class="n">startTime</span>          <span class="o">=</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                                          <span class="n">endTime</span>            <span class="o">=</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
                                          <span class="n">numValuesPerNode</span>   <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> 
                                          <span class="n">maxAutoReadMore</span>    <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    
    <span class="c1"># print the result:</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
    
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Third example:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------&quot;</span><span class="p">)</span>
    
    <span class="c1"># Now suppose we want to use the continuation points manually, </span>
    <span class="c1"># instead of letting the UAF handle them.</span>
    <span class="c1"># We therefore put </span>
    <span class="c1">#   - numValuesPerNode to a very low value, so that not all results will be retrieved at once</span>
    <span class="c1">#   - maxAutoReadMore to 0, so that the UAF may not invoke &quot;continuation request&quot; automatically</span>
    
    <span class="n">startTime</span> <span class="o">=</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">endTime</span>   <span class="o">=</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
    
    <span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">historyReadRaw</span><span class="p">(</span><span class="n">addresses</span>          <span class="o">=</span> <span class="p">[</span><span class="n">doubleAddress</span><span class="p">],</span>
                                     <span class="n">startTime</span>          <span class="o">=</span> <span class="n">startTime</span><span class="p">,</span>
                                     <span class="n">endTime</span>            <span class="o">=</span> <span class="n">endTime</span><span class="p">,</span>
                                     <span class="n">numValuesPerNode</span>   <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> 
                                     <span class="n">maxAutoReadMore</span>    <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># append all DataValues to the following list:</span>
    <span class="n">allDataValues</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">dataValue</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dataValues</span><span class="p">:</span>
        <span class="n">allDataValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">DataValue</span><span class="p">(</span><span class="n">dataValue</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># notice the copy constructor!!!</span>
    
    <span class="c1"># as long as we get continuation points, we must continue to read the data</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">continuationPoint</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">historyReadRaw</span><span class="p">(</span><span class="n">addresses</span>          <span class="o">=</span> <span class="p">[</span><span class="n">doubleAddress</span><span class="p">],</span>
                                         <span class="n">startTime</span>          <span class="o">=</span> <span class="n">startTime</span><span class="p">,</span>
                                         <span class="n">endTime</span>            <span class="o">=</span> <span class="n">endTime</span><span class="p">,</span>
                                         <span class="n">numValuesPerNode</span>   <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> 
                                         <span class="n">maxAutoReadMore</span>    <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                                         <span class="n">continuationPoints</span> <span class="o">=</span> <span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">continuationPoint</span><span class="p">])</span>
        
        <span class="k">for</span> <span class="n">dataValue</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dataValues</span><span class="p">:</span>
            <span class="n">allDataValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">DataValue</span><span class="p">(</span><span class="n">dataValue</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># notice the copy constructor!!!</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The following values were received:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dataValue</span> <span class="ow">in</span> <span class="n">allDataValues</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; - </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">dataValue</span><span class="o">.</span><span class="n">toCompactString</span><span class="p">())</span>
    
    
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Second option: use the generic method processRequest()&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;======================================================&quot;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fourth example:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---------------&quot;</span><span class="p">)</span>
    
    <span class="c1"># create a request with 1 target</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">HistoryReadRawModifiedRequest</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">request</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">doubleAddress</span>
    
    <span class="c1"># configure the request further:</span>
    <span class="n">serviceSettings</span> <span class="o">=</span> <span class="n">HistoryReadRawModifiedSettings</span><span class="p">()</span>
    <span class="n">serviceSettings</span><span class="o">.</span><span class="n">startTime</span>         <span class="o">=</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">serviceSettings</span><span class="o">.</span><span class="n">endTime</span>           <span class="o">=</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
    <span class="n">serviceSettings</span><span class="o">.</span><span class="n">callTimeoutSec</span>    <span class="o">=</span> <span class="mf">2.0</span>                        <span class="c1"># optional of course</span>
    <span class="n">serviceSettings</span><span class="o">.</span><span class="n">numValuesPerNode</span>  <span class="o">=</span> <span class="mi">100</span>
    <span class="n">serviceSettings</span><span class="o">.</span><span class="n">maxAutoReadMore</span>   <span class="o">=</span> <span class="mi">10</span>
    <span class="n">serviceSettings</span><span class="o">.</span><span class="n">isReadModified</span>    <span class="o">=</span> <span class="kc">False</span>                      <span class="c1"># we want raw historical data</span>
    <span class="n">request</span><span class="o">.</span><span class="n">serviceSettings</span> <span class="o">=</span> <span class="n">serviceSettings</span>
    <span class="n">request</span><span class="o">.</span><span class="n">serviceSettingsGiven</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="n">sessionSettings</span> <span class="o">=</span> <span class="n">SessionSettings</span><span class="p">()</span>
    <span class="n">sessionSettings</span><span class="o">.</span><span class="n">sessionTimeoutSec</span> <span class="o">=</span> <span class="mf">600.0</span>                      <span class="c1"># optional of course</span>
    <span class="n">request</span><span class="o">.</span><span class="n">sessionSettings</span> <span class="o">=</span> <span class="n">sessionSettings</span>
    <span class="n">request</span><span class="o">.</span><span class="n">sessionSettingsGiven</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="c1"># process the request</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">processRequest</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    
    <span class="c1"># print the result</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
    
    <span class="c1"># process the result in the same way as before</span>
    
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Some error occurred: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>
    <span class="k">raise</span>

<span class="c1"># don&#39;t worry about closing sessions etc., the UAF client will cleanup everything</span>
<span class="c1"># when it&#39;s garbage collected</span>


</pre></div>
</div>
</div>
<div class="section" id="id1">
<h2>How to read some data?<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># examples/pyuaf/client/how_to_read_some_data.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">EXAMPLE: how to read some data</span>
<span class="sd">====================================================================================================</span>

<span class="sd">A UAF Client can read data in two ways:</span>
<span class="sd">  - either using the &quot;convenience&quot; method: read()</span>
<span class="sd">  - or using the &quot;generic&quot; method: processRequest() </span>

<span class="sd">The &quot;convenience&quot; methods (such as read(), beginRead(), write(), ...) are conveniently to use </span>
<span class="sd"> (since they accept the most frequently used parameters directly), </span>
<span class="sd">but they are less powerful than the &quot;generic&quot; processRequest() method </span>
<span class="sd"> (since this method accepts ReadRequests, AsyncReadRequests, etc. that can be fully configured).</span>

<span class="sd">In this example, we will use several ways to read data:</span>
<span class="sd"> - first option  : &quot;convenience&quot; synchronous  function read()</span>
<span class="sd"> - second option : &quot;generic&quot;     synchronous  function processRequest()</span>
<span class="sd"> - third option  : &quot;convenience&quot; asynchronous function beginRead()       , with external callback</span>
<span class="sd"> - fourth option : &quot;generic&quot;     asynchronous function processRequest()  , with external callback</span>
<span class="sd"> - fifth option  : &quot;convenience&quot; asynchronous function beginRead()       , with overridden callback</span>
<span class="sd"> - sixth option  : &quot;generic&quot;     asynchronous function processRequest()  , with overridden callback</span>

<span class="sd">To run the example, start the UaDemoServer of UnifiedAutomation first on the same machine. </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">pyuaf</span>
<span class="kn">from</span> <span class="nn">pyuaf.client</span>           <span class="k">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.settings</span>  <span class="k">import</span> <span class="n">ClientSettings</span><span class="p">,</span> <span class="n">ReadSettings</span><span class="p">,</span> <span class="n">SessionSettings</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.requests</span>  <span class="k">import</span> <span class="n">ReadRequest</span><span class="p">,</span> <span class="n">AsyncReadRequest</span><span class="p">,</span> <span class="n">ReadRequestTarget</span> 
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">Address</span><span class="p">,</span> <span class="n">NodeId</span><span class="p">,</span> <span class="n">RelativePathElement</span><span class="p">,</span> <span class="n">QualifiedName</span><span class="p">,</span> <span class="n">LocalizedText</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">primitives</span>
<span class="kn">from</span> <span class="nn">pyuaf.util.errors</span>      <span class="k">import</span> <span class="n">UafError</span>


<span class="c1"># define the namespace URI and server URI of the UaDemoServer</span>
<span class="n">demoNsUri</span>     <span class="o">=</span> <span class="s2">&quot;http://www.unifiedautomation.com/DemoServer&quot;</span>
<span class="n">demoServerUri</span> <span class="o">=</span> <span class="s2">&quot;urn:UnifiedAutomation:UaServerCpp&quot;</span>

<span class="c1"># define some addresses of nodes of which we will read the Value attribute</span>
<span class="c1"># (you could also define addresses as Relative Paths to other addresses, </span>
<span class="c1">#  see the example that shows you how to define addresses)</span>
<span class="n">someDoubleNode</span>        <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s2">&quot;Demo.Static.Scalar.Double&quot;</span>              <span class="p">,</span> <span class="n">demoNsUri</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>
<span class="n">someUInt32Node</span>        <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s2">&quot;Demo.Static.Scalar.UInt32&quot;</span>              <span class="p">,</span> <span class="n">demoNsUri</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>
<span class="n">someStringNode</span>        <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s2">&quot;Demo.Static.Scalar.String&quot;</span>              <span class="p">,</span> <span class="n">demoNsUri</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>
<span class="n">someLocalizedTextNode</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s2">&quot;Demo.Static.Scalar.LocalizedText&quot;</span>       <span class="p">,</span> <span class="n">demoNsUri</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>
<span class="n">someSByteArrayNode</span>    <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s2">&quot;Demo.Static.Arrays.SByte&quot;</span>               <span class="p">,</span> <span class="n">demoNsUri</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>

<span class="c1"># define a function to print the readResult (which is of type pyuaf.client.results.ReadResult)</span>
<span class="k">def</span> <span class="nf">printResult</span><span class="p">(</span><span class="n">readResult</span><span class="p">):</span>
    <span class="c1"># overall result</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The overall status is: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="n">readResult</span><span class="o">.</span><span class="n">overallStatus</span><span class="p">))</span>
    
    <span class="c1"># target 0:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">status</span>                         <span class="c1"># &#39;status&#39; has type pyuaf.util.Status</span>
    <span class="n">data</span>   <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>                           <span class="c1"># &#39;data&#39; has type pyuaf.util.primitives.Double</span>
    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">isGood</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">primitives</span><span class="o">.</span><span class="n">Double</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The double is: </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    
    <span class="c1"># target 1:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">status</span>                         <span class="c1"># &#39;status&#39; has type pyuaf.util.Status</span>
    <span class="n">data</span>   <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>                           <span class="c1"># &#39;data&#39; has type pyuaf.util.primitives.UInt32</span>
    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">isGood</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">primitives</span><span class="o">.</span><span class="n">UInt32</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The uint32 is: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    
    <span class="c1"># target 2:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">status</span>                         <span class="c1"># &#39;status&#39; has type pyuaf.util.Status</span>
    <span class="n">data</span>   <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>                           <span class="c1"># &#39;data&#39; has type pyuaf.util.primitives.String</span>
    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">isGood</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">primitives</span><span class="o">.</span><span class="n">String</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The string is: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    
    <span class="c1"># target 3:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">status</span>                         <span class="c1"># &#39;status&#39; has type pyuaf.util.Status</span>
    <span class="n">data</span>   <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>                           <span class="c1"># &#39;data&#39; has type pyuaf.util.LocalizedText</span>
    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">isGood</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">LocalizedText</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The locale is: &#39;</span><span class="si">%s</span><span class="s2">&#39;, the text is: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">locale</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
    
    <span class="c1"># target 4:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">status</span>                         <span class="c1"># &#39;status&#39; has type pyuaf.util.Status</span>
    <span class="n">data</span>   <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>                           <span class="c1"># &#39;data&#39; is a list of pyuaf.util.primitives.SByte</span>
    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">isGood</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The array is:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; - array[</span><span class="si">%d</span><span class="s2">] = </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>


<span class="c1"># define the ClientSettings:</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">ClientSettings</span><span class="p">()</span>
<span class="n">settings</span><span class="o">.</span><span class="n">applicationName</span> <span class="o">=</span> <span class="s2">&quot;MyClient&quot;</span>
<span class="n">settings</span><span class="o">.</span><span class="n">discoveryUrls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;opc.tcp://localhost:48010&quot;</span><span class="p">)</span>

<span class="c1"># create the client</span>
<span class="n">myClient</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>



<span class="c1"># read the node attributes all at once</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First option: use the convenience function read() to read data synchronously&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;============================================================================&quot;</span><span class="p">)</span>
    
<span class="c1"># OPTIONAL: You could also provide a ReadSettings to configure a call timeout, </span>
<span class="c1">#           or maximum age of the values, or ... </span>
<span class="n">serviceSettings</span> <span class="o">=</span> <span class="n">ReadSettings</span><span class="p">()</span>
<span class="n">serviceSettings</span><span class="o">.</span><span class="n">callTimeoutSec</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">serviceSettings</span><span class="o">.</span><span class="n">maxAgeSec</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># OPTIONAL: And you could also provide a SessionConfig to configure the sessions </span>
<span class="c1">#           (e.g. set the timeout to 600.0 seconds)</span>
<span class="c1">#           For more info about SessionConfigs, see the sessionconfig_example</span>
<span class="n">sessionSettings</span> <span class="o">=</span> <span class="n">SessionSettings</span><span class="p">()</span>
<span class="n">sessionSettings</span><span class="o">.</span><span class="n">sessionTimeoutSec</span> <span class="o">=</span> <span class="mf">600.0</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># now read the node attributes</span>
    <span class="n">readResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="n">addresses</span>     <span class="o">=</span> <span class="p">[</span><span class="n">someDoubleNode</span><span class="p">,</span> <span class="n">someUInt32Node</span><span class="p">,</span> <span class="n">someStringNode</span><span class="p">,</span> 
                                                 <span class="n">someLocalizedTextNode</span><span class="p">,</span> <span class="n">someSByteArrayNode</span><span class="p">],</span>
                                <span class="n">serviceSettings</span> <span class="o">=</span> <span class="n">serviceSettings</span><span class="p">,</span> <span class="c1"># optional argument</span>
                                <span class="n">sessionSettings</span> <span class="o">=</span> <span class="n">sessionSettings</span><span class="p">)</span> <span class="c1"># optional argument</span>
    
    <span class="c1"># print the result using the function we defined before</span>
    <span class="n">printResult</span><span class="p">(</span><span class="n">readResult</span><span class="p">)</span>
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Some error occurred: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>



<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Second option: use the generic function processRequest() to read data synchronously&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===================================================================================&quot;</span><span class="p">)</span>

<span class="c1"># create a request with 5 targets</span>
<span class="n">readRequest</span> <span class="o">=</span> <span class="n">ReadRequest</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">someDoubleNode</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">someUInt32Node</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">someStringNode</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">someLocalizedTextNode</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">someSByteArrayNode</span>

<span class="c1"># we could also add a 6th node, of which we want to read the DisplayName (= of type LocalizedText)</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReadRequestTarget</span><span class="p">())</span> <span class="c1"># or readRequest.targets.resize(6)</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">address</span>     <span class="o">=</span> <span class="n">someDoubleNode</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">attributeId</span> <span class="o">=</span> <span class="n">pyuaf</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">attributeids</span><span class="o">.</span><span class="n">DisplayName</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">serviceSettings</span>        <span class="o">=</span> <span class="n">serviceSettings</span> <span class="c1"># optional</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">sessionSettings</span>        <span class="o">=</span> <span class="n">sessionSettings</span> <span class="c1"># optional</span>

<span class="k">try</span><span class="p">:</span>    
    <span class="c1"># process the request</span>
    <span class="n">readResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">processRequest</span><span class="p">(</span><span class="n">readRequest</span><span class="p">)</span>
    
    <span class="c1"># print the result</span>
    <span class="n">printResult</span><span class="p">(</span><span class="n">readResult</span><span class="p">)</span>
    
    <span class="c1"># also print the display name of the 6th node:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">status</span>
    <span class="n">data</span>   <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">isGood</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">LocalizedText</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The DisplayName-locale is: &#39;</span><span class="si">%s</span><span class="s2">&#39;, the DisplayName-text is: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">locale</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Some error occurred: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>
    
    

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Third option: use the convenience function beginRead() to read data asynchronously&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==================================================================================&quot;</span><span class="p">)</span>

<span class="c1"># notice we enable asynchronous communication now by providing the printResult() method as </span>
<span class="c1"># a callback function!</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">asyncReadResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">beginRead</span><span class="p">(</span><span class="n">addresses</span>       <span class="o">=</span> <span class="p">[</span><span class="n">someDoubleNode</span><span class="p">,</span> <span class="n">someUInt32Node</span><span class="p">,</span> 
                                                            <span class="n">someStringNode</span><span class="p">,</span> <span class="n">someLocalizedTextNode</span><span class="p">,</span> 
                                                            <span class="n">someSByteArrayNode</span><span class="p">],</span>
                                         <span class="n">serviceSettings</span> <span class="o">=</span> <span class="n">serviceSettings</span><span class="p">,</span> <span class="c1"># optional argument</span>
                                         <span class="n">sessionSettings</span> <span class="o">=</span> <span class="n">sessionSettings</span><span class="p">,</span> <span class="c1"># optional argument</span>
                                         <span class="n">callback</span>        <span class="o">=</span> <span class="n">printResult</span><span class="p">)</span>     <span class="c1"># callback function!</span>
    
    <span class="c1"># check if there was an &quot;immediate&quot; error on the client side when executing the asynchronous </span>
    <span class="c1"># service call:</span>
    <span class="k">if</span> <span class="n">asyncReadResult</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OK, the client could invoke the asynchronous request without problems.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Let&#39;s wait a second for the result ...&quot;</span><span class="p">)</span>
        
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The read result should have been received by now!&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Some error occurred: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fourth option: use the generic function processRequest() to read data asynchronously&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;====================================================================================&quot;</span><span class="p">)</span>

<span class="c1"># notice we enable asynchronous communication now by providing the printResult() method as </span>
<span class="c1"># a callback function!</span>

<span class="c1"># create an asynchronous (!) request with 5 targets</span>
<span class="n">asyncReadRequest</span> <span class="o">=</span> <span class="n">AsyncReadRequest</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># we can simply copy the targets of the synchronous request to the asynchronous request:</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">asyncReadRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
<span class="c1"># OPTIONAL: also copy the service config and session config:</span>
<span class="n">asyncReadRequest</span><span class="o">.</span><span class="n">serviceSettings</span> <span class="o">=</span> <span class="n">serviceSettings</span>
<span class="n">asyncReadRequest</span><span class="o">.</span><span class="n">sessionSettings</span> <span class="o">=</span> <span class="n">sessionSettings</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># process the request</span>
    <span class="n">asyncReadResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">processRequest</span><span class="p">(</span><span class="n">asyncReadRequest</span><span class="p">,</span> <span class="n">resultCallback</span><span class="o">=</span><span class="n">printResult</span><span class="p">)</span>
    
    <span class="c1"># check if there was an &quot;immediate&quot; error on the client side when executing the asynchronous </span>
    <span class="c1"># service call:</span>
    <span class="k">if</span> <span class="n">asyncReadResult</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OK, the client could invoke the asynchronous request without problems.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Let&#39;s wait a second for the result ...&quot;</span><span class="p">)</span>
        
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The read result should have been received by now!&quot;</span><span class="p">)</span>

    
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Some error occurred: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>



<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fifth option: read data asynchronously using beginRead() without specifying external callbacks&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==============================================================================================&quot;</span><span class="p">)</span>

<span class="c1"># instead of using &quot;external&quot; callback functions (such as printResult() above), we can also use</span>
<span class="c1"># the &quot;internal&quot; callback function of the Client class. If the argument &#39;callback&#39; of beginRead() is </span>
<span class="c1"># not used (or &#39;resultCallback&#39; is not used in case of processRequest()), the asynchronous result</span>
<span class="c1"># will be dispatched to the readComplete() method of the Client class. </span>
<span class="c1"># In other words, when you subclass Client, you can simply override the readComplete() method</span>
<span class="c1"># to receive the asynchronous read results.</span>

<span class="k">class</span> <span class="nc">MySubClasssedClient</span><span class="p">(</span><span class="n">Client</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
        <span class="n">Client</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">readComplete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span> <span class="c1"># overridden method!</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This is the overridden method readComplete() speaking:&quot;</span><span class="p">)</span>
        <span class="n">printResult</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="c1"># create the client</span>
<span class="n">mySubClassedClient</span> <span class="o">=</span> <span class="n">MySubClasssedClient</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
    
<span class="k">try</span><span class="p">:</span>
    <span class="n">asyncReadResult</span> <span class="o">=</span> <span class="n">mySubClassedClient</span><span class="o">.</span><span class="n">beginRead</span><span class="p">(</span>
                                         <span class="n">addresses</span>       <span class="o">=</span> <span class="p">[</span><span class="n">someDoubleNode</span><span class="p">,</span> <span class="n">someUInt32Node</span><span class="p">,</span> 
                                                            <span class="n">someStringNode</span><span class="p">,</span> <span class="n">someLocalizedTextNode</span><span class="p">,</span> 
                                                            <span class="n">someSByteArrayNode</span><span class="p">],</span>
                                         <span class="n">serviceSettings</span> <span class="o">=</span> <span class="n">serviceSettings</span><span class="p">,</span> <span class="c1"># optional argument</span>
                                         <span class="n">sessionSettings</span> <span class="o">=</span> <span class="n">sessionSettings</span><span class="p">)</span> <span class="c1"># optional argument!</span>
    <span class="c1"># note: the &#39;callback&#39; argument is not used in the above call!</span>
    
    <span class="c1"># check if there was an &quot;immediate&quot; error on the client side when executing the asynchronous </span>
    <span class="c1"># service call:</span>
    <span class="k">if</span> <span class="n">asyncReadResult</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OK, the client could invoke the asynchronous request without problems.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Let&#39;s wait a second for the result ...&quot;</span><span class="p">)</span>
        
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The read result should have been received by now!&quot;</span><span class="p">)</span>
    
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Some error occurred: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>
    


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sixth option: read data asynchronously using processRequest() without specifying external callbacks&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===================================================================================================&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># process the request</span>
    <span class="n">asyncReadResult</span> <span class="o">=</span> <span class="n">mySubClassedClient</span><span class="o">.</span><span class="n">processRequest</span><span class="p">(</span><span class="n">asyncReadRequest</span><span class="p">)</span> 
    <span class="c1"># note: the &#39;resultCallback&#39; argument is not used in the above call!</span>
    
    <span class="c1"># check if there was an &quot;immediate&quot; error on the client side when executing the asynchronous </span>
    <span class="c1"># service call:</span>
    <span class="k">if</span> <span class="n">asyncReadResult</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OK, the client could invoke the asynchronous request without problems.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Let&#39;s wait a second for the result ...&quot;</span><span class="p">)</span>
        
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The read result should have been received by now!&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Some error occurred: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>
    

</pre></div>
</div>
</div>
<div class="section" id="how-to-read-and-write-structures">
<span id="read-and-write-structures"></span><h2>How to read and write structures?<a class="headerlink" href="#how-to-read-and-write-structures" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># examples/pyuaf/client/how_to_read_and_write_structures.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">EXAMPLE: how to read and write structures</span>
<span class="sd">====================================================================================================</span>

<span class="sd">To run the example, start the UaServerCPP of UnifiedAutomation first on the same machine. </span>
<span class="sd">($SDK/bin/uaservercpp, this executable is part of the SDK).</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">pyuaf</span>
<span class="kn">from</span> <span class="nn">pyuaf.client</span>           <span class="k">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.settings</span>  <span class="k">import</span> <span class="n">ClientSettings</span><span class="p">,</span> <span class="n">SessionSettings</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">Address</span><span class="p">,</span> <span class="n">NodeId</span><span class="p">,</span> <span class="n">ExtensionObject</span><span class="p">,</span> <span class="n">SdkStatus</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">GenericStructureValue</span><span class="p">,</span> <span class="n">GenericStructureVector</span><span class="p">,</span> <span class="n">GenericUnionValue</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">primitives</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">opcuaidentifiers</span><span class="p">,</span> <span class="n">attributeids</span><span class="p">,</span> <span class="n">opcuatypes</span><span class="p">,</span> <span class="n">structurefielddatatypes</span>
<span class="kn">from</span> <span class="nn">pyuaf.util.errors</span>      <span class="k">import</span> <span class="n">UafError</span>


<span class="c1"># define the namespace URI and server URI of the UaServerCPP demo server</span>
<span class="n">demoServerUri</span> <span class="o">=</span> <span class="s2">&quot;urn:UnifiedAutomation:UaServerCpp&quot;</span>
<span class="n">demoNamespaceUri</span> <span class="o">=</span> <span class="s2">&quot;http://www.unifiedautomation.com/DemoServer/&quot;</span>

<span class="c1"># define the ClientSettings:</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">ClientSettings</span><span class="p">()</span>
<span class="n">settings</span><span class="o">.</span><span class="n">applicationName</span> <span class="o">=</span> <span class="s2">&quot;MyClient&quot;</span>
<span class="n">settings</span><span class="o">.</span><span class="n">discoveryUrls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;opc.tcp://localhost:48010&quot;</span><span class="p">)</span>

<span class="c1"># create the client</span>
<span class="n">myClient</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>



<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#**************************************************************************************************#&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#                                                                                                  #&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# 1) To understand a GenericStructureValue instance, let&#39;s define the function below to print one: #&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#                                                                                                  #&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#**************************************************************************************************#&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">printStructure</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">indentation</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print a structure.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">      structure:   a pyuaf.util.GenericStructureValue instance. May represent a structure</span>
<span class="sd">                   or union or optionset.</span>
<span class="sd">      indentation: a string to print at the beginning of each line (to add indentation when</span>
<span class="sd">                   this function is called recursively).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get the definition of the structure:</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">definition</span><span class="p">()</span>
    
    <span class="c1"># we&#39;ll print the contents of the structure</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">indentation</span> <span class="o">+</span> <span class="s2">&quot;Structure contents:&quot;</span><span class="p">)</span>
    
    <span class="c1"># loop through the fields of the structure, by looking at the definition:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">definition</span><span class="o">.</span><span class="n">childrenCount</span><span class="p">()):</span>
        
        <span class="c1"># retrieve information both from the definition and from the structure itself:</span>
        <span class="n">child</span> <span class="o">=</span> <span class="n">definition</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">childName</span>  <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>           <span class="c1"># a string</span>
        <span class="n">childType</span>  <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">valueType</span><span class="p">()</span>      <span class="c1"># datatype, e.g. Double</span>
        <span class="n">fieldType</span><span class="p">,</span> <span class="n">opcUaStatusCode</span>  <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">valueType</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c1"># e.g. Variant, GenericStructure, GenericStructureArray...</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">SdkStatus</span><span class="p">(</span><span class="n">opcUaStatusCode</span><span class="p">)</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Oops, we could not get the valueType due to: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">SdkStatus</span><span class="p">(</span><span class="n">opcUaStatusCode</span><span class="p">))</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="n">indentation</span> <span class="o">+</span> <span class="s2">&quot;  * child number </span><span class="si">%d</span><span class="s2">:&quot;</span>         <span class="o">%</span><span class="n">i</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">indentation</span> <span class="o">+</span> <span class="s2">&quot;     - child name = </span><span class="si">%s</span><span class="s2">&quot;</span>       <span class="o">%</span><span class="n">childName</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">indentation</span> <span class="o">+</span> <span class="s2">&quot;     - child type = </span><span class="si">%d</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span>  <span class="o">%</span><span class="p">(</span><span class="n">childType</span><span class="p">,</span> <span class="n">opcuatypes</span><span class="o">.</span><span class="n">toString</span><span class="p">(</span><span class="n">childType</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">indentation</span> <span class="o">+</span> <span class="s2">&quot;     - field type = </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span>  <span class="o">%</span><span class="p">(</span><span class="n">fieldType</span><span class="p">,</span> <span class="n">structurefielddatatypes</span><span class="o">.</span><span class="n">toString</span><span class="p">(</span><span class="n">fieldType</span><span class="p">)))</span>
        
        <span class="k">if</span> <span class="n">fieldType</span> <span class="o">==</span> <span class="n">structurefielddatatypes</span><span class="o">.</span><span class="n">Variant</span><span class="p">:</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">opcUaStatusCode</span> <span class="o">=</span> <span class="n">structure</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">indentation</span> <span class="o">+</span> <span class="s2">&quot;     - value      = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fieldType</span> <span class="o">==</span> <span class="n">structurefielddatatypes</span><span class="o">.</span><span class="n">GenericStructure</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">indentation</span> <span class="o">+</span> <span class="s2">&quot;     - value:&quot;</span><span class="p">)</span>
            <span class="c1"># recursive call</span>
            <span class="n">printStructure</span><span class="p">(</span><span class="n">structureValue</span><span class="o">.</span><span class="n">genericStructureValue</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">indentation</span> <span class="o">+</span> <span class="s2">&quot;   &quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fieldType</span> <span class="o">==</span> <span class="n">structurefielddatatypes</span><span class="o">.</span><span class="n">GenericStructureArray</span><span class="p">:</span>
            <span class="n">array</span><span class="p">,</span> <span class="n">opcUaStatusCode</span> <span class="o">=</span> <span class="n">structureValue</span><span class="o">.</span><span class="n">genericStructureArray</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">SdkStatus</span><span class="p">(</span><span class="n">opcUaStatusCode</span><span class="p">)</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Oops, we could not get the structure due to: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">SdkStatus</span><span class="p">(</span><span class="n">opcUaStatusCode</span><span class="p">))</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="n">indentation</span> <span class="o">+</span> <span class="s2">&quot;     - value:&quot;</span><span class="p">)</span>
            <span class="c1"># recursive calls to all array items:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">indentation</span> <span class="o">+</span> <span class="s2">&quot;        array[</span><span class="si">%d</span><span class="s2">]:&quot;</span> <span class="o">%</span><span class="n">j</span><span class="p">)</span>
                <span class="n">printStructure</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">indentation</span> <span class="o">+</span> <span class="s2">&quot;          &quot;</span><span class="p">)</span>
        
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="c1"># empty line</span>



<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#******************************************************************************************#&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#                                                                                          #&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# 2) How to read and write a scalar structure (i.e. a single structure, not an array)      #&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#                                                                                          #&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#******************************************************************************************#&quot;</span><span class="p">)</span>

<span class="c1"># define the address of the Structure which we would like to read</span>
<span class="n">address</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s2">&quot;Demo.Static.Scalar.Vector&quot;</span><span class="p">,</span> <span class="n">demoNamespaceUri</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>

<span class="c1"># try to read a structure</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="p">[</span><span class="n">address</span><span class="p">]</span> <span class="p">)</span>

<span class="c1"># we&#39;re expecting an ExtensionObject. Let&#39;s check this:</span>
<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">ExtensionObject</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;We received an ExtensionObject&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Oops, we were expecting an ExtensionObject, but we received a: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<span class="n">extensionObject</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># now let&#39;s find out the datatype of the ExtensionObject</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="p">[</span><span class="n">address</span><span class="p">]</span> <span class="p">,</span> <span class="n">attributeId</span> <span class="o">=</span> <span class="n">attributeids</span><span class="o">.</span><span class="n">DataType</span><span class="p">)</span>

<span class="n">dataTypeId</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="c1"># data represents a NodeId</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The datatype of the ExtensionObject is: NodeId: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">dataTypeId</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1"># using the datatypeId, get the definition of the structure</span>
<span class="n">definition</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">structureDefinition</span><span class="p">(</span><span class="n">dataTypeId</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The definition of the structure:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">definition</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1"># using the original ExtensionObject the StructureDefinition, we can now create the GenericStructureValue:</span>
<span class="n">structureValue</span> <span class="o">=</span> <span class="n">GenericStructureValue</span><span class="p">(</span><span class="n">extensionObject</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>

<span class="c1"># print the structure:</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;So we can now print the full structure:&quot;</span><span class="p">)</span>
<span class="n">printStructure</span><span class="p">(</span><span class="n">structureValue</span><span class="p">)</span>

<span class="c1"># now change the value of the first child (i = 0):</span>
<span class="n">structureValue</span><span class="o">.</span><span class="n">setField</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">primitives</span><span class="o">.</span><span class="n">Double</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>

<span class="c1"># we can also change a field via its name:</span>
<span class="n">structureValue</span><span class="o">.</span><span class="n">setField</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="n">primitives</span><span class="o">.</span><span class="n">Double</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>

<span class="c1"># write back the structure</span>
<span class="n">newExtensionObject</span> <span class="o">=</span> <span class="n">ExtensionObject</span><span class="p">()</span>
<span class="n">structureValue</span><span class="o">.</span><span class="n">toExtensionObject</span><span class="p">(</span><span class="n">newExtensionObject</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Now writing </span><span class="si">{structure}</span><span class="s2">.X = 0.1 and </span><span class="si">{structure}</span><span class="s2">.Y = 0.2&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="p">[</span><span class="n">address</span><span class="p">],</span> <span class="p">[</span><span class="n">newExtensionObject</span><span class="p">]</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OK, the new structure value has been written successfully&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Oops, some OPC UA problem occurred. Here&#39;s the result:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">result</span><span class="p">)</span>
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Oops, some error occurred on the client side. Here&#39;s the error message: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Let&#39;s read the same structure again, to verify that the values have changed:&quot;</span><span class="p">)</span>
<span class="n">result</span>          <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="p">[</span><span class="n">address</span><span class="p">]</span> <span class="p">)</span>
<span class="n">extensionObject</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">structureValue</span>  <span class="o">=</span> <span class="n">GenericStructureValue</span><span class="p">(</span><span class="n">extensionObject</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>
<span class="n">printStructure</span><span class="p">(</span><span class="n">structureValue</span><span class="p">)</span>



<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#******************************************************************************************#&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#                                                                                          #&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# 3) How to read and write an array of structures                                          #&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#                                                                                          #&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#******************************************************************************************#&quot;</span><span class="p">)</span>

<span class="c1"># let&#39;s now read an array of structures</span>
<span class="n">arrayAddress</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s2">&quot;Demo.Static.Arrays.Vector&quot;</span><span class="p">,</span> <span class="n">demoNamespaceUri</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>

<span class="c1"># try to read a structure</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="p">[</span><span class="n">arrayAddress</span><span class="p">]</span> <span class="p">)</span>

<span class="c1"># we&#39;re expecting a list of ExtensionObjects. Let&#39;s check this:</span>
<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExtensionObject</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;We received a list of ExtensionObjects&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Oops, we were expecting a list of ExtensionObjects, but we received a: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<span class="n">extensionObjectList</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># get the datatype</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="p">[</span><span class="n">arrayAddress</span><span class="p">]</span> <span class="p">,</span> <span class="n">attributeId</span> <span class="o">=</span> <span class="n">attributeids</span><span class="o">.</span><span class="n">DataType</span><span class="p">)</span>

<span class="n">arrayDataTypeId</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="c1"># data represents a NodeId</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The datatype of the ExtensionObjects of this array is: NodeId: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">dataTypeId</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1"># using the datatypeId, get the definition of the structure</span>
<span class="n">definition</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">structureDefinition</span><span class="p">(</span><span class="n">dataTypeId</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The definition of the structures is:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">definition</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Now let&#39;s loop through the list:&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">extensionObjectList</span><span class="p">)):</span>
    
    <span class="n">extensionObject</span> <span class="o">=</span> <span class="n">extensionObjectList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
    <span class="c1"># using the original ExtensionObject the StructureDefinition, we can now create the GenericStructureValue:</span>
    <span class="n">structureValue</span> <span class="o">=</span> <span class="n">GenericStructureValue</span><span class="p">(</span><span class="n">extensionObject</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>
    
    <span class="c1"># print the structure in one line:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;item[</span><span class="si">%d</span><span class="s2">]: &quot;</span> <span class="o">%</span><span class="n">i</span><span class="p">)</span>
    <span class="n">printStructure</span><span class="p">(</span><span class="n">structureValue</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1"># now change the values of the first child of the first array item:</span>
<span class="n">firstItem</span> <span class="o">=</span> <span class="n">GenericStructureValue</span><span class="p">(</span><span class="n">extensionObjectList</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">definition</span><span class="p">)</span>
<span class="n">firstItem</span><span class="o">.</span><span class="n">setField</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">primitives</span><span class="o">.</span><span class="n">Double</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
<span class="n">firstItem</span><span class="o">.</span><span class="n">setField</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="n">primitives</span><span class="o">.</span><span class="n">Double</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>

<span class="c1"># write back the structure</span>
<span class="n">firstItem</span><span class="o">.</span><span class="n">toExtensionObject</span><span class="p">(</span><span class="n">extensionObjectList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Now writing the modified structure array&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="p">[</span><span class="n">arrayAddress</span><span class="p">],</span> <span class="p">[</span><span class="n">extensionObjectList</span><span class="p">]</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OK, the new structure array has been written successfully&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Oops, some OPC UA problem occurred. Here&#39;s the result:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">result</span><span class="p">)</span>
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Oops, some error occurred on the client side. Here&#39;s the error message: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>



<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#*************************************************************************************************#&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#                                                                                                 #&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# 4) How to read and write a structure which contains an array of structures as one of its fields #&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#                                                                                                 #&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#*************************************************************************************************#&quot;</span><span class="p">)</span>

<span class="c1"># define the address of the Structure which has an array of structure as one of its fields </span>
<span class="n">address</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s2">&quot;Demo.Static.Scalar.WorkOrder&quot;</span><span class="p">,</span> <span class="n">demoNamespaceUri</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>

<span class="c1"># read the structure</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="p">[</span><span class="n">address</span><span class="p">]</span> <span class="p">)</span>

<span class="c1"># make sure it&#39;s an ExtensionObject</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="n">ExtensionObject</span>
<span class="n">extensionObject</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># read the datatype</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="p">[</span><span class="n">address</span><span class="p">]</span> <span class="p">,</span> <span class="n">attributeId</span> <span class="o">=</span> <span class="n">attributeids</span><span class="o">.</span><span class="n">DataType</span><span class="p">)</span>
<span class="n">dataTypeId</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="c1"># data represents a NodeId</span>

<span class="c1"># get the definition of the structure</span>
<span class="n">definition</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">structureDefinition</span><span class="p">(</span><span class="n">dataTypeId</span><span class="p">)</span>

<span class="c1"># using the original ExtensionObject the StructureDefinition, we can now create the GenericStructureValue:</span>
<span class="n">structureValue</span> <span class="o">=</span> <span class="n">GenericStructureValue</span><span class="p">(</span><span class="n">extensionObject</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Let&#39;s read a structure which has an array of WorkOrder structures as child number 3:&quot;</span><span class="p">)</span>
<span class="n">printStructure</span><span class="p">(</span><span class="n">structureValue</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Let&#39;s change one of the array items&quot;</span><span class="p">)</span>
<span class="n">array</span><span class="p">,</span> <span class="n">opcUaStatusCode</span> <span class="o">=</span> <span class="n">structureValue</span><span class="o">.</span><span class="n">genericStructureArray</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># child number 3 of the main structure</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">SdkStatus</span><span class="p">(</span><span class="n">opcUaStatusCode</span><span class="p">)</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Oops, we could not get the structure array due to: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">SdkStatus</span><span class="p">(</span><span class="n">opcUaStatusCode</span><span class="p">))</span>

<span class="n">status</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">setField</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">pyuaf</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">LocalizedText</span><span class="p">(</span><span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="s2">&quot;THIS FIELD WAS CHANGED!!!&quot;</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">status</span><span class="o">.</span><span class="n">isGood</span><span class="p">()</span>

<span class="n">status</span> <span class="o">=</span> <span class="n">structureValue</span><span class="o">.</span><span class="n">setField</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">status</span><span class="o">.</span><span class="n">isGood</span><span class="p">()</span>

<span class="n">structureValue</span><span class="o">.</span><span class="n">toExtensionObject</span><span class="p">(</span><span class="n">extensionObject</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Now writing the modified structure&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="p">[</span><span class="n">address</span><span class="p">],</span> <span class="p">[</span><span class="n">extensionObject</span><span class="p">]</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OK, the new structure array has been written successfully&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Oops, some OPC UA problem occurred. Here&#39;s the result:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">result</span><span class="p">)</span>
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Oops, some error occurred on the client side. Here&#39;s the error message: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>



<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#*************************************************************************************************#&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#                                                                                                 #&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# 4) How to read and write a union                                                                #&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#                                                                                                 #&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#*************************************************************************************************#&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">printUnion</span><span class="p">(</span><span class="n">union</span><span class="p">,</span> <span class="n">indentation</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Print a structure.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">      union:       a pyuaf.util.GenericUnionValue instance. </span>
<span class="sd">      indentation: a string to print at the beginning of each line (to add indentation when</span>
<span class="sd">                   this function is called recursively).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get the definition of the structure:</span>
    <span class="n">definition</span> <span class="o">=</span> <span class="n">union</span><span class="o">.</span><span class="n">definition</span><span class="p">()</span>
    
    <span class="c1"># we&#39;ll print the contents of the structure</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">indentation</span> <span class="o">+</span> <span class="s2">&quot;Union contents:&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">definition</span><span class="o">.</span><span class="n">isUnion</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The given union is no union!&quot;</span><span class="p">)</span>
    
    <span class="c1"># let&#39;s show the possible values by looking at the definition:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">definition</span><span class="o">.</span><span class="n">childrenCount</span><span class="p">()):</span>
        
        <span class="c1"># retrieve information both from the definition and from the structure itself:</span>
        <span class="n">child</span> <span class="o">=</span> <span class="n">definition</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">childName</span>   <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>           <span class="c1"># a string</span>
        <span class="n">childType</span>   <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">valueType</span><span class="p">()</span>      <span class="c1"># datatype, e.g. Double</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="n">indentation</span> <span class="o">+</span> <span class="s2">&quot;  * child number </span><span class="si">%d</span><span class="s2">:&quot;</span>         <span class="o">%</span><span class="n">i</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">indentation</span> <span class="o">+</span> <span class="s2">&quot;     - child name = </span><span class="si">%s</span><span class="s2">&quot;</span>       <span class="o">%</span><span class="n">childName</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">indentation</span> <span class="o">+</span> <span class="s2">&quot;     - child type = </span><span class="si">%d</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span>  <span class="o">%</span><span class="p">(</span><span class="n">childType</span><span class="p">,</span> <span class="n">opcuatypes</span><span class="o">.</span><span class="n">toString</span><span class="p">(</span><span class="n">childType</span><span class="p">)))</span>
        
    <span class="c1"># show the active value (the &quot;switchValue&quot;)    </span>
    <span class="n">switchValue</span> <span class="o">=</span> <span class="n">union</span><span class="o">.</span><span class="n">switchValue</span><span class="p">()</span>
    <span class="n">field</span>       <span class="o">=</span> <span class="n">union</span><span class="o">.</span><span class="n">field</span><span class="p">()</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="n">indentation</span> <span class="o">+</span> <span class="s2">&quot;Switch value: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">switchValue</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">indentation</span> <span class="o">+</span> <span class="s2">&quot;Field name: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">union</span><span class="o">.</span><span class="n">field</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">indentation</span> <span class="o">+</span> <span class="s2">&quot;Value: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">union</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="c1"># empty line</span>


<span class="c1"># define the address of the Union</span>
<span class="n">address</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s2">&quot;Demo.Static.Scalar.Structures.AnalogMeasurement&quot;</span><span class="p">,</span> <span class="n">demoNamespaceUri</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>

<span class="c1"># try to read a structure</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="p">[</span><span class="n">address</span><span class="p">]</span> <span class="p">)</span>

<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="n">ExtensionObject</span>
<span class="n">extensionObject</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># now let&#39;s find out the datatype of the ExtensionObject</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="p">[</span><span class="n">address</span><span class="p">]</span> <span class="p">,</span> <span class="n">attributeId</span> <span class="o">=</span> <span class="n">attributeids</span><span class="o">.</span><span class="n">DataType</span><span class="p">)</span>
<span class="n">dataTypeId</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="c1"># data represents a NodeId</span>

<span class="c1"># using the datatypeId, get the definition of the structure</span>
<span class="n">definition</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">structureDefinition</span><span class="p">(</span><span class="n">dataTypeId</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The definition of the union:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">definition</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1"># we can now create the union:</span>
<span class="n">union</span> <span class="o">=</span> <span class="n">GenericUnionValue</span><span class="p">(</span><span class="n">extensionObject</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>

<span class="c1"># print the union:</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;So we can now print the full union:&quot;</span><span class="p">)</span>
<span class="n">printUnion</span><span class="p">(</span><span class="n">union</span><span class="p">)</span>

<span class="c1"># now change the active value</span>
<span class="n">union</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">union</span><span class="o">.</span><span class="n">field</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">(),</span> <span class="n">primitives</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="mf">111.222</span><span class="p">))</span>

<span class="c1"># write back the union</span>
<span class="n">newExtensionObject</span> <span class="o">=</span> <span class="n">ExtensionObject</span><span class="p">()</span>
<span class="n">union</span><span class="o">.</span><span class="n">toExtensionObject</span><span class="p">(</span><span class="n">newExtensionObject</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Now writing union[&#39;</span><span class="si">%s</span><span class="s2">&#39;] = 111.222333&quot;</span> <span class="o">%</span><span class="n">union</span><span class="o">.</span><span class="n">field</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="p">[</span><span class="n">address</span><span class="p">],</span> <span class="p">[</span><span class="n">newExtensionObject</span><span class="p">]</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OK, the new structure value has been written successfully&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Oops, some OPC UA problem occurred. Here&#39;s the result:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">result</span><span class="p">)</span>
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Oops, some error occurred on the client side. Here&#39;s the error message: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Let&#39;s read the same union again, to verify that the active value have changed:&quot;</span><span class="p">)</span>
<span class="n">result</span>          <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="p">[</span><span class="n">address</span><span class="p">]</span> <span class="p">)</span>
<span class="n">extensionObject</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">union</span>           <span class="o">=</span> <span class="n">GenericUnionValue</span><span class="p">(</span><span class="n">extensionObject</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>
<span class="n">printUnion</span><span class="p">(</span><span class="n">union</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="section" id="how-to-configure-all-settings">
<span id="configure-settings-example"></span><h2>How to configure all settings?<a class="headerlink" href="#how-to-configure-all-settings" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># examples/pyuaf/client/how_to_configure_all_settings.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">EXAMPLE: how to configure the client/session/subscription/service settings</span>
<span class="sd">=================================================================================================</span>

<span class="sd">With PyUAF you can configure sessions, subscriptions and services (like read, write, ...) in</span>
<span class="sd">great detail. This example shows how to change them. </span>

<span class="sd">This is an example to show you some more advanced feature of the UAF, you can skip it if you&#39;re </span>
<span class="sd">happy with the default session/subscription/service settings of the UAF!</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">pyuaf</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">Address</span><span class="p">,</span> <span class="n">NodeId</span>
<span class="kn">from</span> <span class="nn">pyuaf.util.primitives</span>  <span class="k">import</span> <span class="n">UInt32</span><span class="p">,</span> <span class="n">Boolean</span>
<span class="kn">from</span> <span class="nn">pyuaf.client</span>           <span class="k">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.settings</span>  <span class="k">import</span> <span class="n">ClientSettings</span><span class="p">,</span> <span class="n">SessionSettings</span><span class="p">,</span> <span class="n">SubscriptionSettings</span><span class="p">,</span> \
                                   <span class="n">ReadSettings</span>


<span class="c1"># Some constants needed during the rest of this example:</span>
<span class="n">NAMESPACE_URI</span> <span class="o">=</span> <span class="s2">&quot;http://www.unifiedautomation.com/DemoServer&quot;</span>
<span class="n">SERVER_URI</span> <span class="o">=</span> <span class="s2">&quot;urn:UnifiedAutomation:UaServerCpp&quot;</span>

<span class="c1"># ==================================================================================================</span>
<span class="c1"># 1) Setting the defaults</span>
<span class="c1"># ==================================================================================================</span>

<span class="c1"># using ClientSettings, you can configure all default session/subscription and service settings:</span>
<span class="n">clientSettings</span> <span class="o">=</span> <span class="n">ClientSettings</span><span class="p">()</span>

<span class="c1"># first configure some general client settings:</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">applicationName</span> <span class="o">=</span> <span class="s2">&quot;MyClient&quot;</span><span class="p">;</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">discoveryUrls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;opc.tcp://localhost:48010&quot;</span><span class="p">)</span>
<span class="c1"># etc. ...</span>

<span class="c1"># now configure the default session settings:</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">defaultSessionSettings</span><span class="o">.</span><span class="n">sessionTimeoutSec</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">defaultSessionSettings</span><span class="o">.</span><span class="n">connectTimeoutSec</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="c1"># etc. ...</span>

<span class="c1"># now configure the default subscription settings:</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">defaultSubscriptionSettings</span><span class="o">.</span><span class="n">publishingIntervalSec</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">defaultSubscriptionSettings</span><span class="o">.</span><span class="n">lifeTimeCount</span>         <span class="o">=</span> <span class="mi">600</span>
<span class="c1"># etc. ...</span>

<span class="c1"># now configure the default settings for the Read service:</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">defaultReadSettings</span><span class="o">.</span><span class="n">callTimeoutSec</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">defaultReadSettings</span><span class="o">.</span><span class="n">maxAgeSec</span>      <span class="o">=</span> <span class="mf">10.0</span>

<span class="c1"># same for the writeSettings, methodCallSettings, ...</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">defaultMethodCallSettings</span><span class="o">.</span><span class="n">callTimeoutSec</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">defaultWriteSettings</span><span class="o">.</span><span class="n">callTimeoutSec</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">defaultBrowseSettings</span><span class="o">.</span><span class="n">callTimeoutSec</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="c1"># and so on, and so on ...</span>

<span class="c1"># NOTE: for clientSettings, you may also configure SessionSettings for specific servers:</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">specificSessionSettings</span><span class="p">[</span><span class="s2">&quot;My/Unreliable/Device/Server/URI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SessionSettings</span><span class="p">()</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">specificSessionSettings</span><span class="p">[</span><span class="s2">&quot;My/Unreliable/Device/Server/URI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sessionTimeoutSec</span> <span class="o">=</span> <span class="mf">200.0</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">specificSessionSettings</span><span class="p">[</span><span class="s2">&quot;My/Unreliable/Device/Server/URI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">connectTimeoutSec</span> <span class="o">=</span> <span class="mf">5.0</span>
<span class="c1"># If the client connects to the server with ServerUri = &quot;My/Unreliable/Device/Server/URI&quot;,</span>
<span class="c1"># then it will use these settings instead of the defaultSessionSettings!</span>

<span class="c1"># Now you can simply create a client that uses these settings:</span>
<span class="n">myClient</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">clientSettings</span><span class="p">)</span>
<span class="c1"># or alternatively:</span>
<span class="c1"># myClient = Client()</span>
<span class="c1"># myClient.setClientSettings(clientSettings)</span>

<span class="c1"># let&#39;s read 2 nodes:</span>
<span class="n">address0</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="n">NodeId</span><span class="p">(</span><span class="s2">&quot;Demo.SimulationSpeed&quot;</span> <span class="p">,</span> <span class="n">NAMESPACE_URI</span><span class="p">),</span> <span class="n">SERVER_URI</span><span class="p">)</span>
<span class="n">address1</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="n">NodeId</span><span class="p">(</span><span class="s2">&quot;Demo.SimulationActive&quot;</span><span class="p">,</span> <span class="n">NAMESPACE_URI</span><span class="p">),</span> <span class="n">SERVER_URI</span><span class="p">)</span>

<span class="c1"># the next line will result in </span>
<span class="c1">#  - a session being created, with the defaultSessionSettings which we configured before</span>
<span class="c1">#  - the Read service being invoked, with the defaultReadSettings we configured before</span>
<span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="p">[</span><span class="n">address0</span><span class="p">,</span> <span class="n">address1</span><span class="p">]</span> <span class="p">)</span> 

<span class="c1"># when the next line is executed, then:</span>
<span class="c1">#  - the session we created before will be reused (as we&#39;re requesting a session with the</span>
<span class="c1">#    defaultSessionSettings, but such a session exists already, so it can be reused!)</span>
<span class="c1">#  - the Write service will be invoked, with the defaultWriteSettings we configured before</span>
<span class="n">myClient</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="p">[</span><span class="n">address0</span><span class="p">,</span> <span class="n">address1</span><span class="p">]</span> <span class="p">,</span> <span class="p">[</span> <span class="n">UInt32</span><span class="p">(</span><span class="mi">60</span><span class="p">),</span> <span class="n">Boolean</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span> <span class="p">]</span> <span class="p">)</span>


<span class="c1"># ==================================================================================================</span>
<span class="c1"># 2) Overriding the defaults</span>
<span class="c1"># ==================================================================================================</span>

<span class="c1"># If needed, you can also configure the settings for each service call, using the **kwargs arguments</span>
<span class="c1"># of read/write/call/...</span>

<span class="c1"># e.g. set some special session settings for a specific read() call:</span>
<span class="n">mySessionSettings</span> <span class="o">=</span> <span class="n">SessionSettings</span><span class="p">()</span>
<span class="n">mySessionSettings</span><span class="o">.</span><span class="n">connectTimeoutSec</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">mySessionSettings</span><span class="o">.</span><span class="n">sessionTimeoutSec</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="c1"># simply mention &#39;sessionSettings = ...&#39; to use these settings as a **kwarg:</span>
<span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="p">[</span><span class="n">address0</span><span class="p">,</span> <span class="n">address1</span><span class="p">],</span> <span class="n">sessionSettings</span> <span class="o">=</span> <span class="n">mySessionSettings</span> <span class="p">)</span> 

<span class="c1"># e.g. set some special service settings for a specific read() call:</span>
<span class="n">myReadSettings</span> <span class="o">=</span> <span class="n">ReadSettings</span><span class="p">()</span>
<span class="n">myReadSettings</span><span class="o">.</span><span class="n">callTimeoutSec</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">myReadSettings</span><span class="o">.</span><span class="n">maxAgeSec</span>      <span class="o">=</span> <span class="mf">1.0</span>
<span class="c1"># simply mention &#39;serviceSettings = ...&#39; to use these settings as a **kwarg:</span>
<span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="p">[</span><span class="n">address0</span><span class="p">,</span> <span class="n">address1</span><span class="p">],</span> <span class="n">serviceSettings</span> <span class="o">=</span> <span class="n">myReadSettings</span> <span class="p">)</span> 
<span class="c1"># or combine them:</span>
<span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="p">[</span><span class="n">address0</span><span class="p">,</span> <span class="n">address1</span><span class="p">],</span> <span class="n">serviceSettings</span> <span class="o">=</span> <span class="n">myReadSettings</span><span class="p">,</span> <span class="n">sessionSettings</span> <span class="o">=</span> <span class="n">mySessionSettings</span> <span class="p">)</span> 

<span class="c1"># e.g. set some special subscription settings for a specific createMonitoredData() call:</span>
<span class="n">mySubscriptionSettings</span> <span class="o">=</span> <span class="n">SubscriptionSettings</span><span class="p">()</span>
<span class="n">mySubscriptionSettings</span><span class="o">.</span><span class="n">publishingIntervalSec</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">mySubscriptionSettings</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">myClient</span><span class="o">.</span><span class="n">createMonitoredData</span><span class="p">(</span> <span class="p">[</span><span class="n">address0</span><span class="p">,</span> <span class="n">address1</span><span class="p">],</span> <span class="n">subscriptionSettings</span> <span class="o">=</span> <span class="n">mySubscriptionSettings</span> <span class="p">)</span>

<span class="c1"># Both the SessionSettings and SubscriptionSettings have a special &#39;unique&#39; attribute, which </span>
<span class="c1"># can be True or False.</span>
<span class="c1"># By default it is False, which tells the PyUAF Client that it may re-use a session (or subscription)</span>
<span class="c1"># if there exists one with the same SessionSettings (or SubscriptionSettings).</span>
<span class="c1"># However, if you set the unique attribute to True, then the PyUAF Client will ignore any existing</span>
<span class="c1"># sessions (or subscriptions) and create a new unique one.</span>
<span class="c1"># This is useful, e.g. if your HMI (Human Machine Interface) has several tabs, then you can create</span>
<span class="c1"># a subscription for each tab (to hold all monitored items for that specific tab). Using the</span>
<span class="c1"># setPublishingMode() service, you can then temporarily enable the subscription for a visible</span>
<span class="c1"># tab, and temporarily disable the subscription for a hidden one. Like this: </span>
<span class="c1"># tab 1:  </span>
<span class="n">tab1SubscriptionSettings</span> <span class="o">=</span> <span class="n">SubscriptionSettings</span><span class="p">()</span>
<span class="n">tab1SubscriptionSettings</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">tab1SubscriptionSettings</span><span class="o">.</span><span class="n">publishingIntervalSec</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="c1"># tab 2:</span>
<span class="n">tab2SubscriptionSettings</span> <span class="o">=</span> <span class="n">SubscriptionSettings</span><span class="p">()</span>
<span class="n">tab2SubscriptionSettings</span><span class="o">.</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">tab2SubscriptionSettings</span><span class="o">.</span><span class="n">publishingIntervalSec</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="c1"># create the subscriptions and monitored items:</span>
<span class="n">tab1Result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">createMonitoredData</span><span class="p">(</span> <span class="p">[</span><span class="n">address0</span><span class="p">]</span> <span class="p">,</span> <span class="n">subscriptionSettings</span> <span class="o">=</span> <span class="n">tab1SubscriptionSettings</span> <span class="p">)</span>
<span class="n">tab2Result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">createMonitoredData</span><span class="p">(</span> <span class="p">[</span><span class="n">address0</span><span class="p">]</span> <span class="p">,</span> <span class="n">subscriptionSettings</span> <span class="o">=</span> <span class="n">tab2SubscriptionSettings</span> <span class="p">)</span>
<span class="c1"># disable the subscription for tab 2:</span>
<span class="n">myClient</span><span class="o">.</span><span class="n">setPublishingMode</span><span class="p">(</span><span class="n">clientSubscriptionHandle</span> <span class="o">=</span> <span class="n">tab2Result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">clientSubscriptionHandle</span><span class="p">,</span> 
                           <span class="n">publishingEnabled</span>        <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>


<span class="c1"># ==================================================================================================</span>
<span class="c1"># Keeping full control over the sessions and subscriptions</span>
<span class="c1"># ==================================================================================================</span>

<span class="c1"># By manually creating and configuring sessions and subscriptions, you can keep full control over </span>
<span class="c1"># them. You&#39;ll have to take care of some things yourself (e.g. re-create monitored items in case</span>
<span class="c1"># a session or subscription dies due to a restart of the server), but you can still benefit from</span>
<span class="c1"># may of PyUAF&#39;s features such as automatic browsepath translation, discovery etc.</span>

<span class="c1"># create a Session and remember its clientConnectionId:</span>
<span class="n">myClientConnectionId</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">manuallyConnect</span><span class="p">(</span><span class="n">serverUri</span>       <span class="o">=</span> <span class="n">SERVER_URI</span><span class="p">,</span> 
                                                <span class="n">sessionSettings</span> <span class="o">=</span> <span class="n">mySessionSettings</span><span class="p">)</span>

<span class="c1"># use this clientConnectionId to read/write/call/...:</span>
<span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="n">addresses</span>          <span class="o">=</span> <span class="p">[</span><span class="n">address0</span><span class="p">,</span> <span class="n">address1</span><span class="p">],</span> 
               <span class="n">clientConnectionId</span> <span class="o">=</span> <span class="n">myClientConnectionId</span> <span class="p">)</span>

<span class="c1"># of course if you don&#39;t want to use the defaultReadSettings of the ClientSettings (see above)</span>
<span class="c1"># then you can provide the service settings as well:</span>
<span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="n">addresses</span>          <span class="o">=</span> <span class="p">[</span><span class="n">address0</span><span class="p">,</span> <span class="n">address1</span><span class="p">],</span> 
               <span class="n">clientConnectionId</span> <span class="o">=</span> <span class="n">myClientConnectionId</span><span class="p">,</span> 
               <span class="n">serviceSettings</span>    <span class="o">=</span> <span class="n">myReadSettings</span> <span class="p">)</span>

<span class="c1"># you can also create a subscription &quot;within&quot; the session created before:</span>
<span class="n">myClientSubscriptionHandle</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">manuallySubscribe</span><span class="p">(</span><span class="n">clientConnectionId</span>   <span class="o">=</span> <span class="n">myClientConnectionId</span><span class="p">,</span> 
                                                        <span class="n">subscriptionSettings</span> <span class="o">=</span> <span class="n">mySubscriptionSettings</span><span class="p">)</span>

<span class="c1"># now you can add monitored items to this specific subscription of this specific session:</span>
<span class="k">def</span> <span class="nf">myCallback</span><span class="p">(</span><span class="n">notification</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;new notification received:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">notification</span><span class="p">)</span>
    
<span class="n">myClient</span><span class="o">.</span><span class="n">createMonitoredData</span><span class="p">(</span> <span class="n">addresses</span>                <span class="o">=</span> <span class="p">[</span><span class="n">address0</span><span class="p">],</span> 
                              <span class="n">notificationCallbacks</span>    <span class="o">=</span> <span class="p">[</span><span class="n">myCallback</span><span class="p">],</span>
                              <span class="n">clientConnectionId</span>       <span class="o">=</span> <span class="n">myClientConnectionId</span><span class="p">,</span>
                              <span class="n">clientSubscriptionHandle</span> <span class="o">=</span> <span class="n">myClientSubscriptionHandle</span> <span class="p">)</span>

<span class="c1"># allow some time to receive a notification:</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># don&#39;t worry about disconnecting sessions etc., these things will be done automatically</span>
<span class="c1"># when the client is destroyed.</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-manually-connect-to-an-endpoint-without-discovery">
<span id="manual-connection-to-endpoint"></span><h2>How to manually connect to an endpoint without discovery?<a class="headerlink" href="#how-to-manually-connect-to-an-endpoint-without-discovery" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># examples/pyuaf/client/how_to_manually_connect_to_an_endpoint_without_discovery.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">EXAMPLE: how to manually connect to an endpoint without discovery</span>
<span class="sd">====================================================================================================</span>

<span class="sd">A UAF client normally uses the discovery process to identify a server and connect to it.</span>
<span class="sd">The user therefore doesn&#39;t have to worry about connecting, disconnecting, session management, etc.</span>

<span class="sd">However, in certain cases you may want to connect manually to a specific endpoint, without using</span>
<span class="sd">the discovery process (i.e. without relying on the discovery endpoint of the server). </span>

<span class="sd">This example will show you how to manually connect to the UaServerCPP demo server of Untified </span>
<span class="sd">Automation, without any discovery involved. </span>

<span class="sd">To run the example, start the UaServerCPP of UnifiedAutomation first on the same machine. </span>
<span class="sd">($SDK/bin/uaservercpp, this executable is part of the SDK).</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">pyuaf</span>
<span class="kn">from</span> <span class="nn">pyuaf.client</span>           <span class="k">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.settings</span>  <span class="k">import</span> <span class="n">ClientSettings</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">Address</span><span class="p">,</span> <span class="n">NodeId</span>
<span class="kn">from</span> <span class="nn">pyuaf.util.errors</span>      <span class="k">import</span> <span class="n">UafError</span><span class="p">,</span> <span class="ne">ConnectionError</span>


<span class="c1"># define the ClientSettings (note that we do NOT provide a discoveryUrl!!!):</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">ClientSettings</span><span class="p">()</span>
<span class="n">settings</span><span class="o">.</span><span class="n">applicationName</span> <span class="o">=</span> <span class="s2">&quot;MyClient&quot;</span>
<span class="c1"># settings.logToStdOutLevel = pyuaf.util.loglevels.Debug # uncomment to see the full UAF logging</span>

<span class="c1"># create the client</span>
<span class="n">myClient</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>

<span class="c1"># Now manually connect to an endpoint of the demo server using &#39;manuallyConnectToEndpoint()&#39;.</span>
<span class="c1">#  - The first argument (endpointUrl) is the URL of the endpoint you want to connect to </span>
<span class="c1">#  - The optional (!) second argument (sessionSettings) a SessionSettings instance.</span>
<span class="c1">#    If you don&#39;t provide one, then a default SessionSettings instance will be used.</span>
<span class="c1">#    A default SessionSettings instance has:</span>
<span class="c1">#     - no security policy (pyuaf.util.securitypolicies.UA_None)</span>
<span class="c1">#     - no security mode (pyuaf.util.messagesecuritymodes.Mode_None)</span>
<span class="c1">#     - no authentication (pyuaf.util.usertokentypes.Anonymous)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Now connecting&quot;</span><span class="p">)</span>
    <span class="n">clientConnectionId</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">manuallyConnectToEndpoint</span><span class="p">(</span><span class="s2">&quot;opc.tcp://localhost:48010&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># if an error was raised, then no Session has been created! </span>
    <span class="c1"># In other words, the client is back in it&#39;s original state, there is no </span>
    <span class="c1"># session that tries to reconnect in the background.</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ConnectionError -&gt; sys.exit()&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;UafError -&gt; sys.exit()&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>


<span class="c1"># The clientConnectionId is a number that identifies the session.</span>
<span class="c1"># You can use it to request some information about the Session that you just created:</span>
<span class="k">try</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Now getting the session information&quot;</span><span class="p">)</span>
    
    <span class="n">info</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">sessionInformation</span><span class="p">(</span><span class="n">clientConnectionId</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SessionInformation:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
    
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t read the session information: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exiting...&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>


<span class="c1"># now use the server URI to read some variables</span>
<span class="k">try</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Now reading some variables&quot;</span><span class="p">)</span>
    
    <span class="c1"># define the namespace URI of the UaDemoServer:</span>
    <span class="n">demoNsUri</span> <span class="o">=</span> <span class="s2">&quot;http://www.unifiedautomation.com/DemoServer&quot;</span>
    
    <span class="c1"># define some addresses:</span>
    <span class="n">someDoubleNode</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s2">&quot;Demo.Static.Scalar.Double&quot;</span><span class="p">,</span> <span class="n">demoNsUri</span><span class="p">),</span> <span class="n">info</span><span class="o">.</span><span class="n">serverUri</span> <span class="p">)</span>
    <span class="n">someUInt32Node</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s2">&quot;Demo.Static.Scalar.UInt32&quot;</span><span class="p">,</span> <span class="n">demoNsUri</span><span class="p">),</span> <span class="n">info</span><span class="o">.</span><span class="n">serverUri</span> <span class="p">)</span>
    
    <span class="c1"># read the nodes of the addresses:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">([</span><span class="n">someDoubleNode</span><span class="p">,</span> <span class="n">someUInt32Node</span><span class="p">])</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ReadResult:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t read some variables: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exiting...&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>


</pre></div>
</div>
</div>
<div class="section" id="how-to-connect-to-a-secured-endpoint">
<h2>How to connect to a secured endpoint?<a class="headerlink" href="#how-to-connect-to-a-secured-endpoint" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyuaf</span>
<span class="kn">from</span> <span class="nn">pyuaf.client</span>           <span class="k">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.settings</span>  <span class="k">import</span> <span class="n">ClientSettings</span><span class="p">,</span> <span class="n">SessionSettings</span><span class="p">,</span> <span class="n">SessionSecuritySettings</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">Address</span><span class="p">,</span> <span class="n">NodeId</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">PkiRsaKeyPair</span><span class="p">,</span> <span class="n">PkiIdentity</span><span class="p">,</span> <span class="n">PkiCertificateInfo</span><span class="p">,</span> <span class="n">PkiCertificate</span>
<span class="kn">from</span> <span class="nn">pyuaf.util.errors</span>      <span class="k">import</span> <span class="n">UafError</span><span class="p">,</span> <span class="ne">ConnectionError</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="k">import</span> <span class="n">securitypolicies</span><span class="p">,</span> <span class="n">messagesecuritymodes</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="n">DISCOVERY_URL</span>     <span class="o">=</span> <span class="s2">&quot;opc.tcp://localhost:48010&quot;</span>
<span class="n">SERVER_URI</span>        <span class="o">=</span> <span class="s2">&quot;urn:UnifiedAutomation:UaServerCpp&quot;</span>
<span class="n">DEMOSERVER_NS_URI</span> <span class="o">=</span> <span class="s2">&quot;http://www.unifiedautomation.com/DemoServer&quot;</span>

<span class="c1"># define a folder where we will store the Public Key Infrastructure files (i.e. certificates and keys)</span>
<span class="n">PKI_FOLDER</span> <span class="o">=</span> <span class="s2">&quot;./securityexample/PKI&quot;</span>

<span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">To run this example, start the UaServerCpp demo server first.</span>
<span class="s2">If you use the evaluation SDK, you can find thCliente executable here (e.g. on Windows):</span>
<span class="s2">   C:/Program Files/UnifiedAutomation/UaSdkCppBundleEval/bin/uaservercpp.exe</span>
<span class="s2">Note that all paths below must ALWAYS be specified using &#39;/&#39; separators, also on Windows!</span>
<span class="s2">This means you cannot use e.g. os.path.join or similar, since those functions may</span>
<span class="s2">introduce platform-dependent path separators.</span>

<span class="s2">Here&#39;s how the UAF Client handles certificates:</span>
<span class="s2">1) first the server certificate is verified. </span>
<span class="s2">   This server certificate was automatically received and kept in memory by the UAF</span>
<span class="s2">   client in the background during the discovery process, so you don&#39;t have to take </span>
<span class="s2">   care of it yourself. (Note, that if you use ``manuallyConnectToEndpoint`` to avoid </span>
<span class="s2">   discovery for some reason, you may provide the server certificate manually). </span>
<span class="s2">   If the server certificate is not trusted (e.g. because it&#39;s invalid or because </span>
<span class="s2">   it&#39;s not in the trust list), then the ``untrustedServerCertificateReceived`` </span>
<span class="s2">   will be called. This is done **regardless** of whether or not you want to sign or</span>
<span class="s2">   encrypt your communication! In this step you&#39;re **only** checking if you&#39;re trying</span>
<span class="s2">   to connect to the right server. In principle you should always override the </span>
<span class="s2">   ``untrustedServerCertificateReceived`` method for this purpose (or register</span>
<span class="s2">   your own callback via ``registerUntrustedServerCertificateCallback``). </span>
<span class="s2">   By default pyuaf will simply assume that you trust the server to which you&#39;re</span>
<span class="s2">   trying to connect (i.e. ``untrustedServerCertificateReceived`` returns </span>
<span class="s2">   ``Action_AcceptTemporarily`` unless you override it). </span>
<span class="s2">2) then both the client and server certificates are sent around again:</span>
<span class="s2">   - so that the server can decide to accept or reject the session</span>
<span class="s2">   - and so that the actual communication data can be encrypted and/or signed, </span>
<span class="s2">     if needed.</span>
<span class="s2">   All of this is handled by the UAF and SDK behind the scenes, so you don&#39;t have to </span>
<span class="s2">   take care of it yourself. Basically you only have to configure the client</span>
<span class="s2">   settings and session settings. </span>
<span class="s2">   </span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===========================================================================================&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; STEP 0: Cleanup and files and directories in the securityexample/ folder, if you want&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===========================================================================================&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">PKI_FOLDER</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Remove the </span><span class="si">%s</span><span class="s2"> folder and all of its contents?&quot;</span> <span class="o">%</span><span class="n">PKI_FOLDER</span><span class="p">)</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="n">raw_input</span><span class="p">(</span><span class="s2">&quot;Enter your choice (y/n) [n] : &quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">answer</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;YES&quot;</span><span class="p">]:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">PKI_FOLDER</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===========================================================================================&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;STEP 1: Create a client Certificate&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===========================================================================================&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1"># we will create a self-signed certificate, which means that the subject and issuer are the same!</span>

<span class="n">keyPair</span> <span class="o">=</span> <span class="n">PkiRsaKeyPair</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="n">issuerPrivateKey</span> <span class="o">=</span> <span class="n">keyPair</span><span class="o">.</span><span class="n">privateKey</span><span class="p">()</span>
<span class="n">subjectPublicKey</span> <span class="o">=</span> <span class="n">keyPair</span><span class="o">.</span><span class="n">publicKey</span><span class="p">()</span>

<span class="n">identity</span> <span class="o">=</span> <span class="n">PkiIdentity</span><span class="p">()</span>
<span class="n">identity</span><span class="o">.</span><span class="n">commonName</span>         <span class="o">=</span> <span class="s2">&quot;Wim Pessemier&quot;</span>
<span class="n">identity</span><span class="o">.</span><span class="n">organization</span>       <span class="o">=</span> <span class="s2">&quot;KU Leuven&quot;</span>
<span class="n">identity</span><span class="o">.</span><span class="n">organizationUnit</span>   <span class="o">=</span> <span class="s2">&quot;Institute of Astronomy&quot;</span>
<span class="n">identity</span><span class="o">.</span><span class="n">locality</span>           <span class="o">=</span> <span class="s2">&quot;Leuven&quot;</span>
<span class="n">identity</span><span class="o">.</span><span class="n">country</span>            <span class="o">=</span> <span class="s2">&quot;BE&quot;</span>

<span class="n">info</span> <span class="o">=</span> <span class="n">PkiCertificateInfo</span><span class="p">()</span>
<span class="n">info</span><span class="o">.</span><span class="n">uri</span>        <span class="o">=</span> <span class="s2">&quot;urn:</span><span class="si">%s</span><span class="s2">:InstituteOfAstronomy::MyExampleCode&quot;</span> <span class="o">%</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span> <span class="c1"># must be unique!</span>
<span class="n">info</span><span class="o">.</span><span class="n">dns</span>        <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>
<span class="n">info</span><span class="o">.</span><span class="n">eMail</span>      <span class="o">=</span> <span class="s2">&quot;Wxx.Pxxxxxxxx@ster.kuleuven.be&quot;</span>
<span class="n">info</span><span class="o">.</span><span class="n">validTime</span>  <span class="o">=</span> <span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">365</span><span class="o">*</span><span class="mi">5</span> <span class="c1"># 5 years</span>

<span class="n">certificate</span> <span class="o">=</span> <span class="n">PkiCertificate</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">identity</span><span class="p">,</span> <span class="n">subjectPublicKey</span><span class="p">,</span>  <span class="n">identity</span><span class="p">,</span> <span class="n">issuerPrivateKey</span><span class="p">)</span>

<span class="c1"># note: we will store the certificate and private key in STEP 3</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===========================================================================================&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;STEP 2: Create a Client instance&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===========================================================================================&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>


<span class="c1"># define the clientSettings</span>
<span class="n">clientSettings</span> <span class="o">=</span> <span class="n">ClientSettings</span><span class="p">()</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">applicationName</span>  <span class="o">=</span> <span class="s2">&quot;MyClient&quot;</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">applicationUri</span>   <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">uri</span> <span class="c1"># Certificate info URI and application URI must be the same !!!</span>
<span class="c1">#clientSettings.logToStdOutLevel = pyuaf.util.loglevels.Debug # uncomment if needed</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">discoveryUrls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DISCOVERY_URL</span><span class="p">)</span>

<span class="c1"># We configure the PKI folder structure (set the PKI_FOLDER to &#39;PKI&#39; and you get the defaults).</span>
<span class="c1"># Note that paths must ALWAYS be specified using &#39;/&#39;, also on Windows! </span>
<span class="c1"># You cannot use os.path.join or similar, since these will introduce platform-dependent separators!</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">clientCertificate</span>                 <span class="o">=</span> <span class="n">PKI_FOLDER</span> <span class="o">+</span> <span class="s1">&#39;/client/certs/client.der&#39;</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">clientPrivateKey</span>                  <span class="o">=</span> <span class="n">PKI_FOLDER</span> <span class="o">+</span> <span class="s1">&#39;/client/private/client.pem&#39;</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">certificateTrustListLocation</span>      <span class="o">=</span> <span class="n">PKI_FOLDER</span> <span class="o">+</span> <span class="s1">&#39;/trusted/certs/&#39;</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">certificateRevocationListLocation</span> <span class="o">=</span> <span class="n">PKI_FOLDER</span> <span class="o">+</span> <span class="s1">&#39;/trusted/crl/&#39;</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">issuersCertificatesLocation</span>       <span class="o">=</span> <span class="n">PKI_FOLDER</span> <span class="o">+</span> <span class="s1">&#39;/issuers/certs/&#39;</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">issuersRevocationListLocation</span>     <span class="o">=</span> <span class="n">PKI_FOLDER</span> <span class="o">+</span> <span class="s1">&#39;/issuers/crl/&#39;</span>

<span class="c1"># make sure the above directories are created</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">createSecurityLocations</span><span class="p">()</span>

<span class="c1"># create the client</span>
<span class="n">myClient</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">clientSettings</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===========================================================================================&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;STEP 3: Store the client certificate and private key&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===========================================================================================&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1"># store the certificate </span>
<span class="n">result</span> <span class="o">=</span> <span class="n">certificate</span><span class="o">.</span><span class="n">toDERFile</span><span class="p">(</span><span class="n">clientSettings</span><span class="o">.</span><span class="n">clientCertificate</span><span class="p">)</span>
<span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Could not save the client certificate!&quot;</span><span class="p">)</span>

<span class="c1"># store the private key:</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">keyPair</span><span class="o">.</span><span class="n">toPEMFile</span><span class="p">(</span><span class="n">clientSettings</span><span class="o">.</span><span class="n">clientPrivateKey</span><span class="p">)</span>
<span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Could not save the client private key!&quot;</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===========================================================================================&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;STEP 4: Copy the client certificate to the trust list of the demo server&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===========================================================================================&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1"># for convenience, let&#39;s try to find out the path of the uaservercpp demo server,</span>
<span class="c1"># so that the user doesn&#39;t have to type this path manually</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;posix&quot;</span><span class="p">:</span>
    <span class="c1"># in linux we can do the following trick: since the uaservercpp process should be running, </span>
    <span class="c1"># we can extract the uaservercpp path from there</span>
    <span class="n">uaservercpp</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="s2">&quot;ps ax -o cmd | grep uaservercpp&quot;</span><span class="p">,</span> 
                                   <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                   <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">suggestion</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">uaservercpp</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/pkiserver/trusted/certs/pyuafexample.der&quot;</span>
<span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;nt&quot;</span><span class="p">:</span>
    <span class="n">suggestion</span> <span class="o">=</span> <span class="s2">&quot;C:/Documents and Settings/All Users/Application Data/UnifiedAutomation/UaSdkCppBundleEval/pkiserver/trusted/certs/pyuafexample.der&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">suggestion</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Enter the path to copy the client certificate to,&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; or leave blank to accept the following suggestion:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span><span class="n">suggestion</span><span class="p">)</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">raw_input</span><span class="p">(</span><span class="s2">&quot;Enter your choice: &quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">answer</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="n">suggestion</span>

<span class="c1"># store the certificate </span>
<span class="n">result</span> <span class="o">=</span> <span class="n">certificate</span><span class="o">.</span><span class="n">toDERFile</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
<span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Could not save the client certificate to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">answer</span><span class="p">)</span>



<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===========================================================================================&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;STEP 5: Configure the session to be created&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===========================================================================================&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1"># suppose we want Basic128Rsa15 encryption + signed communication:</span>
<span class="n">sessionSettings</span> <span class="o">=</span> <span class="n">SessionSettings</span><span class="p">()</span>
<span class="n">sessionSettings</span><span class="o">.</span><span class="n">securitySettings</span><span class="o">.</span><span class="n">securityPolicy</span>      <span class="o">=</span> <span class="n">securitypolicies</span><span class="o">.</span><span class="n">UA_Basic128Rsa15</span>
<span class="n">sessionSettings</span><span class="o">.</span><span class="n">securitySettings</span><span class="o">.</span><span class="n">messageSecurityMode</span> <span class="o">=</span> <span class="n">messagesecuritymodes</span><span class="o">.</span><span class="n">Mode_Sign</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===========================================================================================&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;STEP 6: Register a callback function to handle the server certificate&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===========================================================================================&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">myCallback</span><span class="p">(</span><span class="n">certificate</span><span class="p">,</span> <span class="n">cause</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The following server certificate was not found in the trust list:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">certificate</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Choose one of the following options:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; [r] : Reject the certificate&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; [t] : Accept the certificate Temporarily (i.e. don&#39;t store it inside the trust list)&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; [p] : Accept the certificate Permanently (i.e. store it inside the trust list)&quot;</span><span class="p">)</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="n">raw_input</span><span class="p">(</span><span class="s2">&quot;Enter your choice (r/t/p) [r] : &quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">answer</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;R&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PkiCertificate</span><span class="o">.</span><span class="n">Action_Reject</span>
    <span class="k">elif</span> <span class="n">answer</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;T&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PkiCertificate</span><span class="o">.</span><span class="n">Action_AcceptTemporarily</span>
    <span class="k">elif</span> <span class="n">answer</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;P&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PkiCertificate</span><span class="o">.</span><span class="n">Action_AcceptPermanently</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;INVALID CHOICE&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The certificate will be rejected.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">PkiCertificate</span><span class="o">.</span><span class="n">Action_Reject</span>


<span class="n">myClient</span><span class="o">.</span><span class="n">registerUntrustedServerCertificateCallback</span><span class="p">(</span><span class="n">myCallback</span><span class="p">)</span>



<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===========================================================================================&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;STEP 7: Read some variable using the configured secure session&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===========================================================================================&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1"># define the address of a node which we would like to read:</span>
<span class="n">someAddress</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="n">NodeId</span><span class="p">(</span><span class="s2">&quot;Demo.SimulationSpeed&quot;</span><span class="p">,</span> <span class="n">DEMOSERVER_NS_URI</span><span class="p">),</span> <span class="n">SERVER_URI</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="p">[</span><span class="n">someAddress</span><span class="p">],</span> <span class="n">sessionSettings</span> <span class="o">=</span> <span class="n">sessionSettings</span> <span class="p">)</span>

<span class="c1"># Note that instead of explicitly providing the sessionSettings **kwarg argument, we could also</span>
<span class="c1"># have done the following:</span>
<span class="c1">#  clientSettings.defaultSessionSettings = sessionSettings</span>
<span class="c1">#  myClient.setClientSettings(clientSettings)</span>
<span class="c1">#  result = myClient.read( [someAddress] )</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Read result:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>


<span class="c1"># check the session that was used to read this address:</span>
<span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Information about the session:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">myClient</span><span class="o">.</span><span class="n">sessionInformation</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">clientConnectionId</span><span class="p">))</span>


</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/uaf_logo_200x67_transparent.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Client examples</a><ul>
<li><a class="reference internal" href="#easiest-client-example">Easiest client example</a></li>
<li><a class="reference internal" href="#how-to-define-addresses">How to define addresses?</a></li>
<li><a class="reference internal" href="#how-to-read-some-data">How to read some data?</a></li>
<li><a class="reference internal" href="#how-to-browse-some-nodes">How to browse some nodes?</a></li>
<li><a class="reference internal" href="#how-to-read-some-historical-data">How to read some historical data?</a></li>
<li><a class="reference internal" href="#id1">How to read some data?</a></li>
<li><a class="reference internal" href="#how-to-read-and-write-structures">How to read and write structures?</a></li>
<li><a class="reference internal" href="#how-to-configure-all-settings">How to configure all settings?</a></li>
<li><a class="reference internal" href="#how-to-manually-connect-to-an-endpoint-without-discovery">How to manually connect to an endpoint without discovery?</a></li>
<li><a class="reference internal" href="#how-to-connect-to-a-secured-endpoint">How to connect to a secured endpoint?</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">PyUAF - Python bindings for the UAF (Unified Architecture Framework)</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="api_pyuaf.html"
                        title="next chapter"><code class="docutils literal"><span class="pre">pyuaf</span></code></a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/client_examples.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api_pyuaf.html" title="pyuaf"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="PyUAF - Python bindings for the UAF (Unified Architecture Framework)"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PyUAF 2.3.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2013, Wim Pessemier (Institute for Astronomy, KU Leuven) - http://github.com/uaf.
    </div>
  </body>
</html>