
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Client examples &mdash; PyUAF 1.8 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="PyUAF 1.8 documentation" href="index.html" />
    <link rel="next" title="pyuaf" href="api_pyuaf.html" />
    <link rel="prev" title="PyUAF - Python bindings for the UAF (Unified Architecture Framework)" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api_pyuaf.html" title="pyuaf"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="PyUAF - Python bindings for the UAF (Unified Architecture Framework)"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">PyUAF 1.8 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="client-examples">
<h1>Client examples<a class="headerlink" href="#client-examples" title="Permalink to this headline">¶</a></h1>
<div class="section" id="easiest-client-example">
<h2>Easiest client example<a class="headerlink" href="#easiest-client-example" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># examples/pyuaf/client/easiest_client_example.py</span>

<span class="c"># Start the demo server ($SDK/bin/uaservercpp) of Unified Automation before running this script!</span>

<span class="kn">import</span> <span class="nn">pyuaf</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="kn">import</span> <span class="n">Address</span><span class="p">,</span> <span class="n">NodeId</span>
<span class="kn">from</span> <span class="nn">pyuaf.client</span>           <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.settings</span>  <span class="kn">import</span> <span class="n">ClientSettings</span>

<span class="c"># create a client named &quot;myClient&quot;, and provide the discovery URL of the server (uaservercpp):</span>
<span class="n">myClient</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">ClientSettings</span><span class="p">(</span><span class="s">&quot;myClient&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;opc.tcp://localhost:48010&quot;</span><span class="p">]))</span>

<span class="c"># specify the address of the node of which we would like to read its Value attribute:</span>
<span class="c"># (here we&#39;re using an absolute address, i.e. a NodeId(&lt;identifier&gt;, &lt;namespace URI&gt;) and a &lt;server URI&gt;)</span>
<span class="n">someAddress</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="n">NodeId</span><span class="p">(</span><span class="s">&quot;Demo.SimulationSpeed&quot;</span><span class="p">,</span>                         <span class="c"># NodeId identifier</span>
                             <span class="s">&quot;http://www.unifiedautomation.com/DemoServer&quot;</span><span class="p">),</span> <span class="c"># NodeId namespace URI</span>
                      <span class="s">&quot;urn:UnifiedAutomation:UaServerCpp&quot;</span><span class="p">)</span>                   <span class="c"># server URI</span>

<span class="c"># read the Value attribute of the node that we just addressed:</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="p">[</span><span class="n">someAddress</span><span class="p">]</span> <span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;The value is </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-define-addresses">
<h2>How to define addresses?<a class="headerlink" href="#how-to-define-addresses" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># examples/pyuaf/util/how_to_define_addresses.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Example: how to define addresses</span>
<span class="sd">====================================================================================================</span>

<span class="sd">An OPC UA address space consists of Nodes, connected to each other by References. </span>

<span class="sd">In the UAF, these Nodes can be addressed in two ways:</span>
<span class="sd">  1) by their ExpandedNodeId (or NodeId and a server URI)</span>
<span class="sd">  2) by a RelativePath relative to another address</span>

<span class="sd">1) An ExpandedNodeId is like an &quot;absolute address&quot; of a Node. It contains </span>
<span class="sd"> - a server URI : information about the server that hosts the Node </span>
<span class="sd"> - a NodeId     : information to locate the Node within the address space of that server.</span>

<span class="sd">2) A RelativePath on the other hand is like a &quot;relative address&quot; of a Node. Since</span>
<span class="sd">an address space of a server is a sort of &quot;web&quot; of Nodes and References, you </span>
<span class="sd">can follow a path of references and nodes to locate a particular Node. This path contains:</span>
<span class="sd"> - a starting node: the node from which the relative path starts</span>
<span class="sd"> - a relative path: the path that leads to the node of our interest.</span>
<span class="sd">                    This path consists of one or more elements, </span>
<span class="sd">                    and each element consists of a BrowseName and some other properties.</span>

<span class="sd">Either way, the node is defined within a certain namespace (a sort of &quot;context&quot;) because they </span>
<span class="sd">consist of elements that have an associated namespace URI. This URI (a Uniform Resource Identifier)</span>
<span class="sd">is in fact just a string that fully defines the namespace. For instance, the standard OPC UA</span>
<span class="sd">namespace has the namespace URI &quot;http://opcfoundation.org/UA/&quot;. This means that all NodeIds </span>
<span class="sd">and BrowseNames defined by the OPC UA standard are all qualified by this OPC UA namespace URI. </span>
<span class="sd">If you define your own nodes, you should define them within your own namespace, which could have</span>
<span class="sd">the following URI for example: &quot;http://www.myorganization.org/mymachines/&quot;.</span>

<span class="sd">While namespaces are defined by a URI, they can also be referred to by an integer: the namespace </span>
<span class="sd">index. OPC UA servers expose a NamespaceArray that map these namespace indexes to URIs.</span>
<span class="sd">So all identifiers and qualified names exposed by a server can simply refer to a namespace index, </span>
<span class="sd">and it is the responsibility of the client to read the NamespaceArray and use it to convert the </span>
<span class="sd">namespace indexes into URIs. Fortunately, a UAF Client will do this conversion for you, behind the</span>
<span class="sd">scenes. Namespace indexes therefore do NOT suffice to qualify an identifier or a name, since they</span>
<span class="sd">depend on a mapping (the NamespaceArray), and this mapping depends on the server and may change</span>
<span class="sd">over time. One notable exception is namespace index 0 (zero). This index is reserved for the </span>
<span class="sd">standard OPC UA namespace, so it ALWAYS (!) refers to namespace URI &quot;http://opcfoundation.org/UA/&quot;.</span>
<span class="sd">&quot;&quot;&quot;</span> 

<span class="kn">import</span> <span class="nn">pyuaf</span>
<span class="kn">from</span> <span class="nn">pyuaf.client</span>                   <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.settings</span>          <span class="kn">import</span> <span class="n">ClientSettings</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>                     <span class="kn">import</span> <span class="n">Address</span><span class="p">,</span> <span class="n">ExpandedNodeId</span><span class="p">,</span> <span class="n">RelativePathElement</span><span class="p">,</span> <span class="n">QualifiedName</span><span class="p">,</span> <span class="n">LocalizedText</span><span class="p">,</span> <span class="n">NodeId</span>
<span class="kn">from</span> <span class="nn">pyuaf.util.opcuaidentifiers</span>    <span class="kn">import</span> <span class="n">OpcUaId_RootFolder</span><span class="p">,</span> <span class="n">OpcUaId_ObjectsFolder</span><span class="p">,</span> <span class="n">OpcUaId_ObjectsFolder</span><span class="p">,</span> <span class="n">OpcUaId_Server</span>
<span class="kn">from</span> <span class="nn">pyuaf.util.constants</span>           <span class="kn">import</span> <span class="n">OPCUA_NAMESPACE_URI</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span>

<span class="c">#========================================================#</span>
<span class="c">#                     standard nodes                     #</span>
<span class="c">#========================================================#</span>

<span class="c"># First we define some standard OPC UA nodes. </span>
<span class="c"># Standard nodes have NodeIds that are fully defined by the OPC UA standard.</span>
<span class="c"># For instance, the Root node that is present on all servers, has a</span>
<span class="c">#   - namespace URI &quot;http://opcfoundation.org/UA/&quot; --&gt; defined as pyuaf.util.constants.OPCUA_NAMESPACE_URI</span>
<span class="c">#   - namespace index 0                            --&gt; defined as pyuaf.util.constants.OPCUA_NAMESPACE_ID</span>
<span class="c">#                                                      (note that index 0 is ALWAYS reserved for the OPC UA namespace!) </span>
<span class="c">#   - the numeric NodeId identifier 84             --&gt; defined as pyuaf.util.opcuaidentifiers.OpcUaId_RootFolder</span>
<span class="c"># </span>
<span class="c"># So here are all valid ways to define the Root node: </span>
<span class="n">Root_NodeId</span> <span class="o">=</span> <span class="n">NodeId</span><span class="p">(</span><span class="mi">84</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">Root_NodeId</span> <span class="o">=</span> <span class="n">NodeId</span><span class="p">(</span><span class="n">OpcUaId_RootFolder</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">)</span>                      <span class="c"># same as the previous, but with symbols</span>
<span class="n">Root_NodeId</span> <span class="o">=</span> <span class="n">NodeId</span><span class="p">(</span><span class="n">OpcUaId_RootFolder</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_URI</span><span class="p">)</span>                     <span class="c"># namespace URI instead of namespace index</span>
<span class="n">Root_NodeId</span> <span class="o">=</span> <span class="n">NodeId</span><span class="p">(</span><span class="n">OpcUaId_RootFolder</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_URI</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">)</span> <span class="c"># redundant namespace info, but valid</span>

<span class="c"># NodeIds don&#39;t contain info about the server they are hosted by.</span>
<span class="c"># If you specifically want to refer to a NodeId within a particular server, you need to</span>
<span class="c"># use an ExpandedNodeId, which contains</span>
<span class="c">#   - a NodeId</span>
<span class="c">#   - and a serverUri</span>
<span class="c"># Assume from now on that the particular nodes we want to refer to, are hosted by a server defined</span>
<span class="c"># by the server URI &quot;urn:UnifiedAutomation:UaDemoserver&quot;:</span>
<span class="n">serverUri</span> <span class="o">=</span> <span class="s">&quot;urn:UnifiedAutomation:UaDemoserver&quot;</span> 
<span class="c"># Then we can refer to the Root node like this:</span>
<span class="n">Root_Node</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">Root_NodeId</span><span class="p">,</span> <span class="n">serverUri</span> <span class="p">)</span>
<span class="c"># An absolute address can also be created directly from an ExpandedNodeId:</span>
<span class="n">Root_Node</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">ExpandedNodeId</span><span class="p">(</span><span class="n">OpcUaId_RootFolder</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">,</span> <span class="n">serverUri</span><span class="p">)</span> <span class="p">)</span>

<span class="c"># within the Root folder, there is another standard node called the Objects folder:</span>
<span class="n">Objects_Node</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="n">OpcUaId_ObjectsFolder</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">),</span> <span class="n">serverUri</span> <span class="p">)</span>

<span class="c"># we could also refer to the Objects node via a relative path!</span>
<span class="c"># We can do this, since the standard Object node has a standard BrowseName. </span>
<span class="c"># The following are all valid ways to define the BrowseName of the Objects node </span>
<span class="n">Objects_BrowseName</span> <span class="o">=</span> <span class="n">QualifiedName</span><span class="p">(</span><span class="s">&quot;Objects&quot;</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">)</span>
<span class="n">Objects_BrowseName</span> <span class="o">=</span> <span class="n">QualifiedName</span><span class="p">(</span><span class="s">&quot;Objects&quot;</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_URI</span><span class="p">)</span>                      <span class="c"># namespace URI instead of index</span>
<span class="n">Objects_BrowseName</span> <span class="o">=</span> <span class="n">QualifiedName</span><span class="p">(</span><span class="s">&quot;Objects&quot;</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_URI</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">)</span>  <span class="c"># redundant namespace info, but valid</span>
<span class="c"># we can now create a path from the Root node to the Objects node, using a path of one element:</span>
<span class="n">Objects_Node</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">Root_Node</span><span class="p">,</span> <span class="p">[</span> <span class="n">RelativePathElement</span><span class="p">(</span><span class="n">Objects_BrowseName</span><span class="p">)</span> <span class="p">]</span> <span class="p">)</span>
<span class="c"># The Objects_Node that we just created, refers to the exact same node as the Objects_Node that we previously created.</span>

<span class="c"># within the Objects node, there is a standard node called Server, which represents a sort </span>
<span class="c"># of object that contains all kinds of information about the server. </span>
<span class="c"># The following are all equally valid ways to define this node:</span>
<span class="n">Server_Node</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">ExpandedNodeId</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="n">OpcUaId_Server</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">),</span> <span class="n">serverUri</span><span class="p">)</span> <span class="p">)</span>
<span class="n">Server_Node</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">ExpandedNodeId</span><span class="p">(</span> <span class="n">OpcUaId_Server</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">,</span> <span class="n">serverUri</span><span class="p">)</span> <span class="p">)</span>
<span class="n">Server_Node</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">Root_Node</span>   <span class="p">,</span> <span class="p">[</span> <span class="n">RelativePathElement</span><span class="p">(</span><span class="n">QualifiedName</span><span class="p">(</span><span class="s">&quot;Objects&quot;</span><span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">)),</span> 
                                       <span class="n">RelativePathElement</span><span class="p">(</span><span class="n">QualifiedName</span><span class="p">(</span><span class="s">&quot;Server&quot;</span> <span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">))</span> <span class="p">]</span> <span class="p">)</span>
<span class="n">Server_Node</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">Objects_Node</span><span class="p">,</span> <span class="p">[</span> <span class="n">RelativePathElement</span><span class="p">(</span><span class="n">QualifiedName</span><span class="p">(</span><span class="s">&quot;Server&quot;</span> <span class="p">,</span> <span class="n">OPCUA_NAMESPACE_ID</span><span class="p">))</span> <span class="p">]</span> <span class="p">)</span>
<span class="c"># note that all Server_Node instances are equally valid, even the last one </span>
<span class="c"># (which is a &quot;relative path to a relative path to an ExpandedNodeId&quot;) </span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-read-some-data">
<h2>How to read some data?<a class="headerlink" href="#how-to-read-some-data" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># examples/pyuaf/client/how_to_read_some_data.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">EXAMPLE: how to read some data</span>
<span class="sd">====================================================================================================</span>

<span class="sd">A UAF Client can read data in two ways:</span>
<span class="sd">  - either using the &quot;convenience&quot; method: read()</span>
<span class="sd">  - or using the &quot;generic&quot; method: processRequest() </span>

<span class="sd">The &quot;convenience&quot; methods (such as read(), beginRead(), write(), ...) are conveniently to use </span>
<span class="sd"> (since they accept the most frequently used parameters directly), </span>
<span class="sd">but they are less powerful than the &quot;generic&quot; processRequest() method </span>
<span class="sd"> (since this method accepts ReadRequests, AsyncReadRequests, etc. that can be fully configured).</span>

<span class="sd">In this example, we will use several ways to read data:</span>
<span class="sd"> - first option  : &quot;convenience&quot; synchronous  function read()</span>
<span class="sd"> - second option : &quot;generic&quot;     synchronous  function processRequest()</span>
<span class="sd"> - third option  : &quot;convenience&quot; asynchronous function beginRead()       , with external callback</span>
<span class="sd"> - fourth option : &quot;generic&quot;     asynchronous function processRequest()  , with external callback</span>
<span class="sd"> - fifth option  : &quot;convenience&quot; asynchronous function beginRead()       , with overridden callback</span>
<span class="sd"> - sixth option  : &quot;generic&quot;     asynchronous function processRequest()  , with overridden callback</span>

<span class="sd">To run the example, start the UaDemoServer of UnifiedAutomation first on the same machine. </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">pyuaf</span>
<span class="kn">from</span> <span class="nn">pyuaf.client</span>           <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.settings</span>  <span class="kn">import</span> <span class="n">ClientSettings</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.requests</span>  <span class="kn">import</span> <span class="n">ReadRequest</span><span class="p">,</span> <span class="n">AsyncReadRequest</span><span class="p">,</span> <span class="n">ReadRequestTarget</span> 
<span class="kn">from</span> <span class="nn">pyuaf.client.configs</span>   <span class="kn">import</span> <span class="n">ReadConfig</span><span class="p">,</span> <span class="n">SessionConfig</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="kn">import</span> <span class="n">Address</span><span class="p">,</span> <span class="n">NodeId</span><span class="p">,</span> <span class="n">RelativePathElement</span><span class="p">,</span> <span class="n">QualifiedName</span><span class="p">,</span> <span class="n">LocalizedText</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="kn">import</span> <span class="n">primitives</span>
<span class="kn">from</span> <span class="nn">pyuaf.util.errors</span>      <span class="kn">import</span> <span class="n">UafError</span>


<span class="c"># define the namespace URI and server URI of the UaDemoServer</span>
<span class="n">demoNsUri</span>     <span class="o">=</span> <span class="s">&quot;http://www.unifiedautomation.com/DemoServer&quot;</span>
<span class="n">demoServerUri</span> <span class="o">=</span> <span class="s">&quot;urn:UnifiedAutomation:UaServerCpp&quot;</span>

<span class="c"># define some addresses of nodes of which we will read the Value attribute</span>
<span class="c"># (you could also define addresses as Relative Paths to other addresses, </span>
<span class="c">#  see the example that shows you how to define addresses)</span>
<span class="n">someDoubleNode</span>        <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s">&quot;Demo.Static.Scalar.Double&quot;</span>              <span class="p">,</span> <span class="n">demoNsUri</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>
<span class="n">someUInt32Node</span>        <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s">&quot;Demo.Static.Scalar.UInt32&quot;</span>              <span class="p">,</span> <span class="n">demoNsUri</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>
<span class="n">someStringNode</span>        <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s">&quot;Demo.Static.Scalar.String&quot;</span>              <span class="p">,</span> <span class="n">demoNsUri</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>
<span class="n">someLocalizedTextNode</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s">&quot;Demo.Static.Scalar.LocalizedText&quot;</span>       <span class="p">,</span> <span class="n">demoNsUri</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>
<span class="n">someSByteArrayNode</span>    <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s">&quot;Demo.Static.Arrays.SByte&quot;</span>               <span class="p">,</span> <span class="n">demoNsUri</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>

<span class="c"># define a function to print the readResult (which is of type pyuaf.client.results.ReadResult)</span>
<span class="k">def</span> <span class="nf">printResult</span><span class="p">(</span><span class="n">readResult</span><span class="p">):</span>
    <span class="c"># overall result</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;The overall status is: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="n">readResult</span><span class="o">.</span><span class="n">overallStatus</span><span class="p">))</span>
    
    <span class="c"># target 0:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">status</span>                         <span class="c"># &#39;status&#39; has type pyuaf.util.Status</span>
    <span class="n">data</span>   <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>                           <span class="c"># &#39;data&#39; has type pyuaf.util.primitives.Double</span>
    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">isGood</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">primitives</span><span class="o">.</span><span class="n">Double</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;The double is: </span><span class="si">%.3f</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    
    <span class="c"># target 1:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">status</span>                         <span class="c"># &#39;status&#39; has type pyuaf.util.Status</span>
    <span class="n">data</span>   <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>                           <span class="c"># &#39;data&#39; has type pyuaf.util.primitives.UInt32</span>
    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">isGood</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">primitives</span><span class="o">.</span><span class="n">UInt32</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;The uint32 is: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    
    <span class="c"># target 2:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">status</span>                         <span class="c"># &#39;status&#39; has type pyuaf.util.Status</span>
    <span class="n">data</span>   <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>                           <span class="c"># &#39;data&#39; has type pyuaf.util.primitives.String</span>
    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">isGood</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">primitives</span><span class="o">.</span><span class="n">String</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;The string is: &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    
    <span class="c"># target 3:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">status</span>                         <span class="c"># &#39;status&#39; has type pyuaf.util.Status</span>
    <span class="n">data</span>   <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>                           <span class="c"># &#39;data&#39; has type pyuaf.util.LocalizedText</span>
    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">isGood</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">LocalizedText</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;The locale is: &#39;</span><span class="si">%s</span><span class="s">&#39;, the text is: &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">locale</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
    
    <span class="c"># target 4:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">status</span>                         <span class="c"># &#39;status&#39; has type pyuaf.util.Status</span>
    <span class="n">data</span>   <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>                           <span class="c"># &#39;data&#39; is a list of pyuaf.util.primitives.SByte</span>
    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">isGood</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;The array is:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot; - array[</span><span class="si">%d</span><span class="s">] = </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>


<span class="c"># define the ClientSettings:</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">ClientSettings</span><span class="p">()</span>
<span class="n">settings</span><span class="o">.</span><span class="n">applicationName</span> <span class="o">=</span> <span class="s">&quot;MyClient&quot;</span>
<span class="n">settings</span><span class="o">.</span><span class="n">discoveryUrls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;opc.tcp://localhost:48010&quot;</span><span class="p">)</span>

<span class="c"># create the client</span>
<span class="n">myClient</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>



<span class="c"># read the node attributes all at once</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;First option: use the convenience function read() to read data synchronously&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;============================================================================&quot;</span><span class="p">)</span>
    
<span class="c"># OPTIONAL: You could also provide a ReadConfig to configure a call timeout, </span>
<span class="c">#           or maximum age of the values, or ... </span>
<span class="n">serviceConfig</span> <span class="o">=</span> <span class="n">ReadConfig</span><span class="p">()</span>
<span class="n">serviceConfig</span><span class="o">.</span><span class="n">serviceSettings</span><span class="o">.</span><span class="n">callTimeoutSec</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">serviceConfig</span><span class="o">.</span><span class="n">serviceSettings</span><span class="o">.</span><span class="n">maxAgeSec</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c"># OPTIONAL: And you could also provide a SessionConfig to configure the sessions </span>
<span class="c">#           (e.g. set the timeout to 600.0 seconds)</span>
<span class="c">#           For more info about SessionConfigs, see the sessionconfig_example</span>
<span class="n">sessionConfig</span> <span class="o">=</span> <span class="n">SessionConfig</span><span class="p">()</span>
<span class="n">sessionConfig</span><span class="o">.</span><span class="n">defaultSessionSettings</span><span class="o">.</span><span class="n">sessionTimeoutSec</span> <span class="o">=</span> <span class="mf">600.0</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c"># now read the node attributes</span>
    <span class="n">readResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="n">addresses</span>     <span class="o">=</span> <span class="p">[</span><span class="n">someDoubleNode</span><span class="p">,</span> <span class="n">someUInt32Node</span><span class="p">,</span> <span class="n">someStringNode</span><span class="p">,</span> 
                                                 <span class="n">someLocalizedTextNode</span><span class="p">,</span> <span class="n">someSByteArrayNode</span><span class="p">],</span>
                                <span class="n">serviceConfig</span> <span class="o">=</span> <span class="n">serviceConfig</span><span class="p">,</span> <span class="c"># optional argument</span>
                                <span class="n">sessionConfig</span> <span class="o">=</span> <span class="n">sessionConfig</span><span class="p">)</span> <span class="c"># optional argument</span>
    
    <span class="c"># print the result using the function we defined before</span>
    <span class="n">printResult</span><span class="p">(</span><span class="n">readResult</span><span class="p">)</span>
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Some error occurred: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>



<span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Second option: use the generic function processRequest() to read data synchronously&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;===================================================================================&quot;</span><span class="p">)</span>

<span class="c"># create a request with 5 targets</span>
<span class="n">readRequest</span> <span class="o">=</span> <span class="n">ReadRequest</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">someDoubleNode</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">someUInt32Node</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">someStringNode</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">someLocalizedTextNode</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">someSByteArrayNode</span>

<span class="c"># we could also add a 6th node, of which we want to read the DisplayName (= of type LocalizedText)</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReadRequestTarget</span><span class="p">())</span> <span class="c"># or readRequest.targets.resize(6)</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">address</span>     <span class="o">=</span> <span class="n">someDoubleNode</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">attributeId</span> <span class="o">=</span> <span class="n">pyuaf</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">attributeids</span><span class="o">.</span><span class="n">DisplayName</span>

<span class="c"># OPTIONAL: let&#39;s also specify a small call timeout, since the UaDemoServer is running </span>
<span class="c">#           on the local machine anyway</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">serviceConfig</span><span class="o">.</span><span class="n">serviceSettings</span><span class="o">.</span><span class="n">callTimeoutSec</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="c"># OPTIONAL: let&#39;s also specify that the values cannot be older than 1 second</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">serviceConfig</span><span class="o">.</span><span class="n">serviceSettings</span><span class="o">.</span><span class="n">maxAgeSec</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="c"># OPTIONAL: and finally let&#39;s also specify that sessions should have a timeout of 600 seconds</span>
<span class="c">#           For more info about SessionConfigs, see the sessionconfig_example</span>
<span class="n">readRequest</span><span class="o">.</span><span class="n">sessionConfig</span><span class="o">.</span><span class="n">defaultSessionSettings</span><span class="o">.</span><span class="n">sessionTimeoutSec</span> <span class="o">=</span> <span class="mf">600.0</span>

<span class="k">try</span><span class="p">:</span>    
    <span class="c"># process the request</span>
    <span class="n">readResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">processRequest</span><span class="p">(</span><span class="n">readRequest</span><span class="p">)</span>
    
    <span class="c"># print the result</span>
    <span class="n">printResult</span><span class="p">(</span><span class="n">readResult</span><span class="p">)</span>
    
    <span class="c"># also print the display name of the 6th node:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">status</span>
    <span class="n">data</span>   <span class="o">=</span> <span class="n">readResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">isGood</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">LocalizedText</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;The DisplayName-locale is: &#39;</span><span class="si">%s</span><span class="s">&#39;, the DisplayName-text is: &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">locale</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Some error occurred: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>
    
    

<span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Third option: use the convenience function beginRead() to read data asynchronously&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;==================================================================================&quot;</span><span class="p">)</span>

<span class="c"># notice we enable asynchronous communication now by providing the printResult() method as </span>
<span class="c"># a callback function!</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">asyncReadResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">beginRead</span><span class="p">(</span><span class="n">addresses</span>     <span class="o">=</span> <span class="p">[</span><span class="n">someDoubleNode</span><span class="p">,</span> <span class="n">someUInt32Node</span><span class="p">,</span> 
                                                          <span class="n">someStringNode</span><span class="p">,</span> <span class="n">someLocalizedTextNode</span><span class="p">,</span> 
                                                          <span class="n">someSByteArrayNode</span><span class="p">],</span>
                                         <span class="n">serviceConfig</span> <span class="o">=</span> <span class="n">serviceConfig</span><span class="p">,</span> <span class="c"># optional argument</span>
                                         <span class="n">sessionConfig</span> <span class="o">=</span> <span class="n">sessionConfig</span><span class="p">,</span> <span class="c"># optional argument</span>
                                         <span class="n">callback</span>      <span class="o">=</span> <span class="n">printResult</span><span class="p">)</span> <span class="c"># callback function!</span>
    
    <span class="c"># check if there was an &quot;immediate&quot; error on the client side when executing the asynchronous </span>
    <span class="c"># service call:</span>
    <span class="k">if</span> <span class="n">asyncReadResult</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;OK, the client could invoke the asynchronous request without problems.&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Let&#39;s wait a second for the result ...&quot;</span><span class="p">)</span>
        
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;The read result should have been received by now!&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Some error occurred: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>


<span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Fourth option: use the generic function processRequest() to read data asynchronously&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;====================================================================================&quot;</span><span class="p">)</span>

<span class="c"># notice we enable asynchronous communication now by providing the printResult() method as </span>
<span class="c"># a callback function!</span>

<span class="c"># create an asynchronous (!) request with 5 targets</span>
<span class="n">asyncReadRequest</span> <span class="o">=</span> <span class="n">AsyncReadRequest</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c"># we can simply copy the targets of the synchronous request to the asynchronous request:</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">asyncReadRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">readRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
<span class="c"># OPTIONAL: also copy the service config and session config:</span>
<span class="n">asyncReadRequest</span><span class="o">.</span><span class="n">serviceConfig</span> <span class="o">=</span> <span class="n">readRequest</span><span class="o">.</span><span class="n">serviceConfig</span>
<span class="n">asyncReadRequest</span><span class="o">.</span><span class="n">sessionConfig</span> <span class="o">=</span> <span class="n">readRequest</span><span class="o">.</span><span class="n">sessionConfig</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c"># process the request</span>
    <span class="n">asyncReadResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">processRequest</span><span class="p">(</span><span class="n">asyncReadRequest</span><span class="p">,</span> <span class="n">resultCallback</span><span class="o">=</span><span class="n">printResult</span><span class="p">)</span>
    
    <span class="c"># check if there was an &quot;immediate&quot; error on the client side when executing the asynchronous </span>
    <span class="c"># service call:</span>
    <span class="k">if</span> <span class="n">asyncReadResult</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;OK, the client could invoke the asynchronous request without problems.&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Let&#39;s wait a second for the result ...&quot;</span><span class="p">)</span>
        
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;The read result should have been received by now!&quot;</span><span class="p">)</span>

    
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Some error occurred: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>



<span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Fifth option: read data asynchronously using beginRead() without specifying external callbacks&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;==============================================================================================&quot;</span><span class="p">)</span>

<span class="c"># instead of using &quot;external&quot; callback functions (such as printResult() above), we can also use</span>
<span class="c"># the &quot;internal&quot; callback function of the Client class. If the argument &#39;callback&#39; of beginRead() is </span>
<span class="c"># not used (or &#39;resultCallback&#39; is not used in case of processRequest()), the asynchronous result</span>
<span class="c"># will be dispatched to the readComplete() method of the Client class. </span>
<span class="c"># In other words, when you subclass Client, you can simply override the readComplete() method</span>
<span class="c"># to receive the asynchronous read results.</span>

<span class="k">class</span> <span class="nc">MySubClasssedClient</span><span class="p">(</span><span class="n">Client</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
        <span class="n">Client</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">readComplete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span> <span class="c"># overridden method!</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;This is the overridden method readComplete() speaking:&quot;</span><span class="p">)</span>
        <span class="n">printResult</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="c"># create the client</span>
<span class="n">mySubClassedClient</span> <span class="o">=</span> <span class="n">MySubClasssedClient</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
    
<span class="k">try</span><span class="p">:</span>
    <span class="n">asyncReadResult</span> <span class="o">=</span> <span class="n">mySubClassedClient</span><span class="o">.</span><span class="n">beginRead</span><span class="p">(</span>
                                         <span class="n">addresses</span>     <span class="o">=</span> <span class="p">[</span><span class="n">someDoubleNode</span><span class="p">,</span> <span class="n">someUInt32Node</span><span class="p">,</span> 
                                                          <span class="n">someStringNode</span><span class="p">,</span> <span class="n">someLocalizedTextNode</span><span class="p">,</span> 
                                                          <span class="n">someSByteArrayNode</span><span class="p">],</span>
                                         <span class="n">serviceConfig</span> <span class="o">=</span> <span class="n">serviceConfig</span><span class="p">,</span> <span class="c"># optional argument</span>
                                         <span class="n">sessionConfig</span> <span class="o">=</span> <span class="n">sessionConfig</span><span class="p">)</span> <span class="c"># optional argument!</span>
    <span class="c"># note: the &#39;callback&#39; argument is not used in the above call!</span>
    
    <span class="c"># check if there was an &quot;immediate&quot; error on the client side when executing the asynchronous </span>
    <span class="c"># service call:</span>
    <span class="k">if</span> <span class="n">asyncReadResult</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;OK, the client could invoke the asynchronous request without problems.&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Let&#39;s wait a second for the result ...&quot;</span><span class="p">)</span>
        
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;The read result should have been received by now!&quot;</span><span class="p">)</span>
    
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Some error occurred: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>
    


<span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Sixth option: read data asynchronously using processRequest() without specifying external callbacks&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;===================================================================================================&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c"># process the request</span>
    <span class="n">asyncReadResult</span> <span class="o">=</span> <span class="n">mySubClassedClient</span><span class="o">.</span><span class="n">processRequest</span><span class="p">(</span><span class="n">asyncReadRequest</span><span class="p">)</span> 
    <span class="c"># note: the &#39;resultCallback&#39; argument is not used in the above call!</span>
    
    <span class="c"># check if there was an &quot;immediate&quot; error on the client side when executing the asynchronous </span>
    <span class="c"># service call:</span>
    <span class="k">if</span> <span class="n">asyncReadResult</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;OK, the client could invoke the asynchronous request without problems.&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Let&#39;s wait a second for the result ...&quot;</span><span class="p">)</span>
        
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;The read result should have been received by now!&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Some error occurred: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
<div class="section" id="how-to-browse-some-nodes">
<h2>How to browse some nodes?<a class="headerlink" href="#how-to-browse-some-nodes" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># examples/pyuaf/client/how_to_browse_some_nodes.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">EXAMPLE: how to browse some nodes</span>
<span class="sd">====================================================================================================</span>

<span class="sd">A UAF Client can browse nodes in two ways:</span>
<span class="sd">  - either using the &quot;convenience&quot; method: browse()</span>
<span class="sd">  - or using the &quot;generic&quot; method: processRequest() </span>

<span class="sd">The &quot;convenience&quot; methods (such as read(), write(), call(), ...) are conveniently to use </span>
<span class="sd"> (since they accept the most frequently used parameters directly), </span>
<span class="sd">but they are less powerful than the &quot;generic&quot; processRequest() method </span>
<span class="sd"> (since this method accepts ReadRequests, WriteRequests, etc. that can be fully configured).</span>

<span class="sd">In this example, we will use both ways to browse nodes.</span>

<span class="sd">As will be shown in this example, the UAF can automatically take care of BrowseNext calls,</span>
<span class="sd">so as a user you don&#39;t have to worry about incomplete Browse results!</span>

<span class="sd">To run the example, start the UaServerCPP of UnifiedAutomation first on the same machine. </span>
<span class="sd">($SDK/bin/uaservercpp, this executable is part of the SDK).</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">pyuaf</span>
<span class="kn">from</span> <span class="nn">pyuaf.client</span>           <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.settings</span>  <span class="kn">import</span> <span class="n">ClientSettings</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.requests</span>  <span class="kn">import</span> <span class="n">BrowseRequest</span><span class="p">,</span> <span class="n">BrowseRequestTarget</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.configs</span>   <span class="kn">import</span> <span class="n">BrowseConfig</span><span class="p">,</span> <span class="n">SessionConfig</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="kn">import</span> <span class="n">Address</span><span class="p">,</span> <span class="n">NodeId</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="kn">import</span> <span class="n">primitives</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="kn">import</span> <span class="n">opcuaidentifiers</span>
<span class="kn">from</span> <span class="nn">pyuaf.util.errors</span>      <span class="kn">import</span> <span class="n">UafError</span>


<span class="c"># define the namespace URI and server URI of the UaServerCPP demo server</span>
<span class="n">demoServerUri</span> <span class="o">=</span> <span class="s">&quot;urn:UnifiedAutomation:UaServerCpp&quot;</span>

<span class="c"># define the address of the Root node which we would like to start browsing</span>
<span class="n">rootNode</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="n">opcuaidentifiers</span><span class="o">.</span><span class="n">OpcUaId_RootFolder</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>

<span class="c"># define the ClientSettings:</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">ClientSettings</span><span class="p">()</span>
<span class="n">settings</span><span class="o">.</span><span class="n">applicationName</span> <span class="o">=</span> <span class="s">&quot;MyClient&quot;</span>
<span class="n">settings</span><span class="o">.</span><span class="n">discoveryUrls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;opc.tcp://localhost:48010&quot;</span><span class="p">)</span>

<span class="c"># create the client</span>
<span class="n">myClient</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>



<span class="k">try</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;First option: use the convenience function </span><span class="se">\&quot;</span><span class="s">browse()</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;===================================================&quot;</span><span class="p">)</span>
    
    <span class="c"># now browse the root node</span>
    <span class="c"># (notice that there is also an argument called &#39;maxAutoBrowseNext&#39;, which we don&#39;t mention</span>
    <span class="c">#  here because we can leave it at the default value (100), to make sure that BrowseNext is </span>
    <span class="c"># automatically being called for us as much as needed!)</span>
    <span class="c"># (notice too that you can optionally provide a BrowseConfig and a SessionConfig for </span>
    <span class="c">#  more detailed configuration)</span>
    <span class="n">firstLevelBrowseResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">browse</span><span class="p">([</span><span class="n">rootNode</span><span class="p">])</span>
    
    <span class="c"># print the result</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot; - Browse result of the first level:&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;   ---------------------------------&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">firstLevelBrowseResult</span><span class="p">)</span>
    
    <span class="c"># we don&#39;t expect that &quot;manual&quot; BrowseNext calls are still needed, as the UAF will</span>
    <span class="c"># have done the BrowseNext calls up to 100 times automatically for us! If there would still be</span>
    <span class="c"># some continuation points left, then we surely have some unexpected problem!</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">firstLevelBrowseResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">continuationPoint</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    
    <span class="c"># we can now continue browsing the other nodes that we discovered, all simultaneously!!!</span>
    <span class="n">noOfFoundReferences</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">firstLevelBrowseResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
    <span class="n">newNodesToBeBrowsed</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">noOfFoundReferences</span><span class="p">):</span>
        <span class="n">newNodesToBeBrowsed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">Address</span><span class="p">(</span><span class="n">firstLevelBrowseResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">references</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">nodeId</span><span class="p">)</span> <span class="p">)</span>
    
    <span class="n">secondLevelBrowseResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="n">newNodesToBeBrowsed</span><span class="p">)</span>
    
    <span class="c"># print the result</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot; - Browse result of the second level:&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;   ----------------------------------&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">secondLevelBrowseResult</span><span class="p">)</span>
    
    
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Second option: use the generic function </span><span class="se">\&quot;</span><span class="s">processRequest()</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;==========================================================&quot;</span><span class="p">)</span>
    
    <span class="c"># create a request with 1 target</span>
    <span class="n">firstLevelBrowseRequest</span> <span class="o">=</span> <span class="n">BrowseRequest</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">firstLevelBrowseRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">rootNode</span>
    
    <span class="c"># OPTIONAL: let&#39;s also specify a small call timeout, since the UaDemoServer is running </span>
    <span class="c">#           on the local machine anyway</span>
    <span class="n">firstLevelBrowseRequest</span><span class="o">.</span><span class="n">serviceConfig</span><span class="o">.</span><span class="n">serviceSettings</span><span class="o">.</span><span class="n">callTimeoutSec</span> <span class="o">=</span> <span class="mf">2.0</span>
    
    <span class="c"># OPTIONAL: and finally let&#39;s also specify that sessions should have a timeout of 600 seconds</span>
    <span class="c">#           For more info about SessionConfigs, see the sessionconfig example</span>
    <span class="n">firstLevelBrowseRequest</span><span class="o">.</span><span class="n">sessionConfig</span><span class="o">.</span><span class="n">defaultSessionSettings</span><span class="o">.</span><span class="n">sessionTimeoutSec</span> <span class="o">=</span> <span class="mf">600.0</span>
    
    <span class="c"># process the request</span>
    <span class="n">firstLevelBrowseResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">processRequest</span><span class="p">(</span><span class="n">firstLevelBrowseRequest</span><span class="p">)</span>
    
    <span class="c"># print the result</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot; - Browse result of the first level:&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;   ---------------------------------&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">firstLevelBrowseResult</span><span class="p">)</span>
    
    <span class="c"># we don&#39;t expect that &quot;manual&quot; BrowseNext calls are still needed, as the UAF will</span>
    <span class="c"># have done the BrowseNext calls up to 100 times automatically for us! If there would still be</span>
    <span class="c"># some continuation points left, then we surely have some unexpected problem!</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">firstLevelBrowseResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">continuationPoint</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    
    <span class="c"># we can now continue browsing the other nodes that we discovered, all simultaneously!!!</span>
    <span class="n">noOfFoundReferences</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">firstLevelBrowseResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">references</span><span class="p">)</span>
    <span class="n">secondLevelBrowseRequest</span> <span class="o">=</span> <span class="n">BrowseRequest</span><span class="p">(</span><span class="n">noOfFoundReferences</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">noOfFoundReferences</span><span class="p">):</span>
        <span class="n">secondLevelBrowseRequest</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="n">firstLevelBrowseResult</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">references</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">nodeId</span><span class="p">)</span>
    
    <span class="n">secondLevelBrowseResult</span> <span class="o">=</span>  <span class="n">myClient</span><span class="o">.</span><span class="n">processRequest</span><span class="p">(</span><span class="n">secondLevelBrowseRequest</span><span class="p">)</span>
    
    <span class="c"># print the result</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot; - Browse result of the second level:&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;   ----------------------------------&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">secondLevelBrowseResult</span><span class="p">)</span>
    
    
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Some error occurred: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>
    <span class="k">raise</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-read-some-historical-data">
<h2>How to read some historical data?<a class="headerlink" href="#how-to-read-some-historical-data" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># examples/pyuaf/client/how_to_read_some_historical_data.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">EXAMPLE: how to read some historical data</span>
<span class="sd">====================================================================================================</span>

<span class="sd">A UAF Client can read historical data in two ways:</span>
<span class="sd">  - either using the &quot;convenience&quot; methods: historyReadRaw() and historyReadModified()</span>
<span class="sd">  - or using the &quot;generic&quot; method: processRequest() </span>

<span class="sd">The &quot;convenience&quot; methods (such as read(), write(), call(), ...) are conveniently to use </span>
<span class="sd"> (since they accept the most frequently used parameters directly), </span>
<span class="sd">but they are less powerful than the &quot;generic&quot; processRequest() method </span>
<span class="sd"> (since this method accepts ReadRequests, WriteRequests, etc. that can be fully configured).</span>

<span class="sd">In this example, we will use both ways to read historical data.</span>

<span class="sd">As will be shown in this example, the UAF can automatically take care of subsequent </span>
<span class="sd">history reading calls, when the first call returned a continuation point (because either the server</span>
<span class="sd">or the client restricted the number of results that were passed in one OPC UA message).</span>
<span class="sd">With this &quot;automatic&quot; UAF feature, you don&#39;t have to worry about incomplete results anymore!</span>

<span class="sd">To run the example, start the UaDemoServer of UnifiedAutomation first on the same machine. </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">pyuaf</span>
<span class="kn">from</span> <span class="nn">pyuaf.client</span>           <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.settings</span>  <span class="kn">import</span> <span class="n">ClientSettings</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.requests</span>  <span class="kn">import</span> <span class="n">HistoryReadRawModifiedRequest</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.configs</span>   <span class="kn">import</span> <span class="n">HistoryReadRawModifiedConfig</span><span class="p">,</span> <span class="n">SessionConfig</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="kn">import</span> <span class="n">Address</span><span class="p">,</span> <span class="n">NodeId</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="kn">import</span> <span class="n">DateTime</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="kn">import</span> <span class="n">DataValue</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="kn">import</span> <span class="n">Status</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="kn">import</span> <span class="n">RelativePathElement</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="kn">import</span> <span class="n">QualifiedName</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="kn">import</span> <span class="n">primitives</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="kn">import</span> <span class="n">opcuaidentifiers</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="kn">import</span> <span class="n">opcuastatuscodes</span>
<span class="kn">from</span> <span class="nn">pyuaf.util.errors</span>      <span class="kn">import</span> <span class="n">UafError</span>


<span class="c"># define the namespace URI and server URI of the UaDemoServer</span>
<span class="n">demoNsUri</span>     <span class="o">=</span> <span class="s">&quot;http://www.unifiedautomation.com/DemoServer&quot;</span>
<span class="n">demoServerUri</span> <span class="o">=</span> <span class="s">&quot;urn:UnifiedAutomation:UaServerCpp&quot;</span>

<span class="c"># define the addresses of some useful nodes</span>
<span class="c"># (demoAddress is an absolute address, all the others are relative ones) </span>
<span class="n">demoAddress</span>             <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s">&quot;Demo&quot;</span><span class="p">,</span> <span class="n">demoNsUri</span><span class="p">),</span> <span class="n">demoServerUri</span> <span class="p">)</span>
<span class="n">simulationActiveAddress</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">demoAddress</span><span class="p">,</span> <span class="p">[</span><span class="n">RelativePathElement</span><span class="p">(</span><span class="n">QualifiedName</span><span class="p">(</span><span class="s">&quot;SimulationActive&quot;</span><span class="p">,</span> <span class="n">demoNsUri</span><span class="p">))]</span> <span class="p">)</span>
<span class="n">startSimulationAddress</span>  <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">demoAddress</span><span class="p">,</span> <span class="p">[</span><span class="n">RelativePathElement</span><span class="p">(</span><span class="n">QualifiedName</span><span class="p">(</span><span class="s">&quot;StartSimulation&quot;</span> <span class="p">,</span> <span class="n">demoNsUri</span><span class="p">))]</span> <span class="p">)</span>
<span class="n">historyAddress</span>          <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">demoAddress</span><span class="p">,</span> <span class="p">[</span><span class="n">RelativePathElement</span><span class="p">(</span><span class="n">QualifiedName</span><span class="p">(</span><span class="s">&quot;History&quot;</span><span class="p">,</span> <span class="n">demoNsUri</span><span class="p">))]</span> <span class="p">)</span>
<span class="n">loggingActiveAddress</span>    <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">historyAddress</span><span class="p">,</span> <span class="p">[</span><span class="n">RelativePathElement</span><span class="p">(</span><span class="n">QualifiedName</span><span class="p">(</span><span class="s">&quot;DataLoggerActive&quot;</span><span class="p">,</span> <span class="n">demoNsUri</span><span class="p">))]</span> <span class="p">)</span>
<span class="n">startLoggingAddress</span>     <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">historyAddress</span><span class="p">,</span> <span class="p">[</span><span class="n">RelativePathElement</span><span class="p">(</span><span class="n">QualifiedName</span><span class="p">(</span><span class="s">&quot;StartLogging&quot;</span><span class="p">,</span> <span class="n">demoNsUri</span><span class="p">))]</span> <span class="p">)</span>
<span class="n">doubleAddress</span>           <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">historyAddress</span><span class="p">,</span> <span class="p">[</span><span class="n">RelativePathElement</span><span class="p">(</span><span class="n">QualifiedName</span><span class="p">(</span><span class="s">&quot;DoubleWithHistory&quot;</span><span class="p">,</span> <span class="n">demoNsUri</span><span class="p">))]</span> <span class="p">)</span>

<span class="c"># define the ClientSettings:</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">ClientSettings</span><span class="p">()</span>
<span class="n">settings</span><span class="o">.</span><span class="n">applicationName</span> <span class="o">=</span> <span class="s">&quot;MyClient&quot;</span>
<span class="n">settings</span><span class="o">.</span><span class="n">discoveryUrls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;opc.tcp://localhost:48010&quot;</span><span class="p">)</span>

<span class="c"># create the client</span>
<span class="n">myClient</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>

<span class="c"># first, we need to start the simulation (if it&#39;s not already started),</span>
<span class="c"># and we need to start the logging (if it&#39;s not already started)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">(</span> <span class="p">[</span><span class="n">simulationActiveAddress</span><span class="p">,</span><span class="n">loggingActiveAddress</span><span class="p">]</span>  <span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t read some nodes of the server: is uaservercpp started and properly configured?&quot;</span><span class="p">)</span>

<span class="n">isSimulationActive</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">value</span>
<span class="n">isLoggingActive</span>    <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">value</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;isSimulationActive : </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">isSimulationActive</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;isLoggingActive    : </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">isLoggingActive</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">isSimulationActive</span><span class="p">:</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">demoAddress</span><span class="p">,</span> <span class="n">startSimulationAddress</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;The simulation was started&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t start the simulation: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">res</span><span class="o">.</span><span class="n">overallStatus</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">isLoggingActive</span><span class="p">:</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">historyAddress</span><span class="p">,</span> <span class="n">startLoggingAddress</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">overallStatus</span><span class="o">.</span><span class="n">isGood</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;The logging was started&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t start the logging: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">res</span><span class="o">.</span><span class="n">overallStatus</span><span class="p">)</span>
    

<span class="c"># now wait a bit more than a second, so that we have at least one second of historical data</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>


<span class="k">try</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;First option: use the convenience functions historyReadRaw() and historyReadModified()&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;======================================================================================&quot;</span><span class="p">)</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;First example:&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;-------------&quot;</span><span class="p">)</span>
    
    <span class="c"># Read the raw historical data </span>
    <span class="c">#   - that is provided by the double node,</span>
    <span class="c">#   - that was recorded during the past second</span>
    <span class="c">#   - with a maximum of a 100 returned values </span>
    <span class="c">#     (we expect around 10 values, so 100 is a very safe margin) </span>
    <span class="c">#   - and let the UAF invoke at most 10 &quot;continuation calls&quot;</span>
    <span class="c">#     (we expect that all data can be returned by a single call, so a maximum of 10 </span>
    <span class="c">#      additional calls is again a very safe margin)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">historyReadRaw</span><span class="p">(</span><span class="n">addresses</span>          <span class="o">=</span> <span class="p">[</span><span class="n">doubleAddress</span><span class="p">],</span>
                                     <span class="n">startTime</span>          <span class="o">=</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="mf">1.5</span><span class="p">),</span>
                                     <span class="n">endTime</span>            <span class="o">=</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
                                     <span class="n">numValuesPerNode</span>   <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> 
                                     <span class="n">maxAutoReadMore</span>    <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    
    <span class="c"># print the result:</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
    
    <span class="c"># do some processing on the result</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">isNotGood</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Could not read historical data from the double: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">status</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dataValues</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># Strange, we didn&#39;t receive any historical data.</span>
            <span class="c"># Check if this is expected behavior:</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">opcUaStatusCode</span><span class="p">()</span> <span class="o">==</span> <span class="n">opcuastatuscodes</span><span class="o">.</span><span class="n">OpcUa_GoodNoData</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;OK, no data could be received because he server reports that there is &quot;</span>
                      <span class="s">&quot;no data that matches your request&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">allStatuses</span>     <span class="o">=</span> <span class="p">[]</span>
            <span class="n">allDoubleValues</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">allSourceTimes</span>  <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">for</span> <span class="n">dataValue</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dataValues</span><span class="p">:</span>
                <span class="c"># check the data type</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dataValue</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="n">primitives</span><span class="o">.</span><span class="n">Double</span><span class="p">:</span>
                    
                    <span class="c"># NOTE that dataValue is just a POINTER!</span>
                    <span class="c"># So if you want to copy any objects </span>
                    <span class="c">#  (like we&#39;re copying Status or DateTime objects to a Python list in this case),</span>
                    <span class="c"># then you must use the copy constructors </span>
                    <span class="c">#  (like Status(...) and DateTime(...) in this case),</span>
                    <span class="c"># to actually copy the data!</span>
                    <span class="c"># If you don&#39;t do this, then you will just create pointers to the underlying data.</span>
                    <span class="c"># And when Python garbage collects this data, your pointers will point to</span>
                    <span class="c"># invalid memory, and your software will crash when you try to use them!</span>
                    
                    <span class="n">allStatuses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">Status</span><span class="p">(</span><span class="n">dataValue</span><span class="o">.</span><span class="n">status</span><span class="p">)</span> <span class="p">)</span>               <span class="c"># notice the copy constructor!</span>
                    <span class="n">allDoubleValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">dataValue</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">value</span> <span class="p">)</span>                  <span class="c"># an int, no copy constructor needed</span>
                    <span class="n">allSourceTimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">dataValue</span><span class="o">.</span><span class="n">sourceTimestamp</span><span class="p">)</span> <span class="p">)</span> <span class="c"># notice the copy constructor!</span>
            
            <span class="c"># now print the lists </span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;The results are:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">allDoubleValues</span><span class="p">)):</span>
                
                <span class="n">timeFloat</span>  <span class="o">=</span> <span class="n">allSourceTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ctime</span><span class="p">()</span>
                <span class="n">timeTuple</span>  <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span> <span class="nb">long</span><span class="p">(</span><span class="n">timeFloat</span><span class="p">)</span> <span class="p">)</span>
                <span class="n">timeString</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%H:%M:%S&quot;</span><span class="p">,</span> <span class="n">timeTuple</span><span class="p">)</span>   \
                             <span class="o">+</span> <span class="s">&quot;.&quot;</span>                                  \
                             <span class="o">+</span> <span class="p">(</span><span class="s">&quot;</span><span class="si">%.3d</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">allSourceTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">msec</span><span class="p">())</span>
                
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;Code=</span><span class="si">%d</span><span class="s"> - Value=</span><span class="si">%s</span><span class="s"> - Time=</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">allStatuses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">statusCode</span><span class="p">(),</span> <span class="n">allDoubleValues</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">timeString</span><span class="p">))</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Second example:&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;--------------&quot;</span><span class="p">)</span>
    <span class="c"># Now do the same, but this time get the modifications of the data of the last second.</span>
    <span class="c"># Since we didn&#39;t do any modifications, none will be reported!</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">historyReadModified</span><span class="p">(</span><span class="n">addresses</span>          <span class="o">=</span> <span class="p">[</span><span class="n">doubleAddress</span><span class="p">],</span>
                                          <span class="n">startTime</span>          <span class="o">=</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                                          <span class="n">endTime</span>            <span class="o">=</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
                                          <span class="n">numValuesPerNode</span>   <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> 
                                          <span class="n">maxAutoReadMore</span>    <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    
    <span class="c"># print the result:</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
    
    
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Third example:&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;--------------&quot;</span><span class="p">)</span>
    
    <span class="c"># Now suppose we want to use the continuation points manually, </span>
    <span class="c"># instead of letting the UAF handle them.</span>
    <span class="c"># We therefore put </span>
    <span class="c">#   - numValuesPerNode to a very low value, so that not all results will be retrieved at once</span>
    <span class="c">#   - maxAutoReadMore to 0, so that the UAF may not invoke &quot;continuation request&quot; automatically</span>
    
    <span class="n">startTime</span> <span class="o">=</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">endTime</span>   <span class="o">=</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
    
    <span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">historyReadRaw</span><span class="p">(</span><span class="n">addresses</span>          <span class="o">=</span> <span class="p">[</span><span class="n">doubleAddress</span><span class="p">],</span>
                                     <span class="n">startTime</span>          <span class="o">=</span> <span class="n">startTime</span><span class="p">,</span>
                                     <span class="n">endTime</span>            <span class="o">=</span> <span class="n">endTime</span><span class="p">,</span>
                                     <span class="n">numValuesPerNode</span>   <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> 
                                     <span class="n">maxAutoReadMore</span>    <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="c"># append all DataValues to the following list:</span>
    <span class="n">allDataValues</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">dataValue</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dataValues</span><span class="p">:</span>
        <span class="n">allDataValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">DataValue</span><span class="p">(</span><span class="n">dataValue</span><span class="p">)</span> <span class="p">)</span> <span class="c"># notice the copy constructor!!!</span>
    
    <span class="c"># as long as we get continuation points, we must continue to read the data</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">continuationPoint</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">historyReadRaw</span><span class="p">(</span><span class="n">addresses</span>          <span class="o">=</span> <span class="p">[</span><span class="n">doubleAddress</span><span class="p">],</span>
                                         <span class="n">startTime</span>          <span class="o">=</span> <span class="n">startTime</span><span class="p">,</span>
                                         <span class="n">endTime</span>            <span class="o">=</span> <span class="n">endTime</span><span class="p">,</span>
                                         <span class="n">numValuesPerNode</span>   <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> 
                                         <span class="n">maxAutoReadMore</span>    <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                                         <span class="n">continuationPoints</span> <span class="o">=</span> <span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">continuationPoint</span><span class="p">])</span>
        
        <span class="k">for</span> <span class="n">dataValue</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dataValues</span><span class="p">:</span>
            <span class="n">allDataValues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">DataValue</span><span class="p">(</span><span class="n">dataValue</span><span class="p">)</span> <span class="p">)</span> <span class="c"># notice the copy constructor!!!</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;The following values were received:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dataValue</span> <span class="ow">in</span> <span class="n">allDataValues</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot; - </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">dataValue</span><span class="o">.</span><span class="n">toCompactString</span><span class="p">())</span>
    
    
    
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Second option: use the generic method processRequest()&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;======================================================&quot;</span><span class="p">)</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Fourth example:&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;---------------&quot;</span><span class="p">)</span>
    
    <span class="c"># create a request with 1 target</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">HistoryReadRawModifiedRequest</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">request</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">doubleAddress</span>
    
    <span class="c"># configure the request:</span>
    <span class="n">request</span><span class="o">.</span><span class="n">serviceConfig</span><span class="o">.</span><span class="n">serviceSettings</span><span class="o">.</span><span class="n">startTime</span>                <span class="o">=</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">request</span><span class="o">.</span><span class="n">serviceConfig</span><span class="o">.</span><span class="n">serviceSettings</span><span class="o">.</span><span class="n">endTime</span>                  <span class="o">=</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
    <span class="n">request</span><span class="o">.</span><span class="n">serviceConfig</span><span class="o">.</span><span class="n">serviceSettings</span><span class="o">.</span><span class="n">callTimeoutSec</span>           <span class="o">=</span> <span class="mf">2.0</span>                        <span class="c"># optional of course</span>
    <span class="n">request</span><span class="o">.</span><span class="n">serviceConfig</span><span class="o">.</span><span class="n">serviceSettings</span><span class="o">.</span><span class="n">numValuesPerNode</span>         <span class="o">=</span> <span class="mi">100</span>
    <span class="n">request</span><span class="o">.</span><span class="n">serviceConfig</span><span class="o">.</span><span class="n">serviceSettings</span><span class="o">.</span><span class="n">maxAutoReadMore</span>          <span class="o">=</span> <span class="mi">10</span>
    <span class="n">request</span><span class="o">.</span><span class="n">serviceConfig</span><span class="o">.</span><span class="n">serviceSettings</span><span class="o">.</span><span class="n">isReadModified</span>           <span class="o">=</span> <span class="bp">False</span>                      <span class="c"># we want raw historical data</span>
    <span class="n">request</span><span class="o">.</span><span class="n">sessionConfig</span><span class="o">.</span><span class="n">defaultSessionSettings</span><span class="o">.</span><span class="n">sessionTimeoutSec</span> <span class="o">=</span> <span class="mf">600.0</span>                      <span class="c"># optional of course</span>
    
    <span class="c"># process the request</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">processRequest</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    
    <span class="c"># print the result</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
    
    <span class="c"># process the result in the same way as before</span>
    
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Some error occurred: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>
    <span class="k">raise</span>

<span class="c"># don&#39;t worry about closing sessions etc., the UAF client will cleanup everything</span>
<span class="c"># when it&#39;s garbage collected</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-change-the-default-session-behavior">
<span id="sessionconfig-example"></span><h2>How to change the default session behavior?<a class="headerlink" href="#how-to-change-the-default-session-behavior" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># examples/pyuaf/client/how_to_change_the_default_session_behavior.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">EXAMPLE: how to change the default session behavior</span>
<span class="sd">=================================================================================================</span>

<span class="sd">A SessionConfig instance can be used to configure one or more sessions that need to be created,</span>
<span class="sd">in order to successfully invoke an OPC UA service.</span>

<span class="sd">This is an example to show you some more advanced feature of the UAF, you can skip it if you&#39;re </span>
<span class="sd">happy with the default session behavior of the UAF!</span>

<span class="sd">As always, in the UAF terminology, a &quot;config&quot; object holds one or more &quot;settings&quot; objects.</span>

<span class="sd">In this case, a SessionConfig holds</span>
<span class="sd">  - one SessionSettings object to specify &quot;default&quot; settings for sessions that need to be created</span>
<span class="sd">    during the service call</span>
<span class="sd">  - and optionally some particular SessionSettings objects for sessions to particular servers.</span>

<span class="sd">Because a SessionConfig can contain settings for many different servers, you can create and</span>
<span class="sd">configure one SessionConfig, and then re-use this SessionConfig for multiple service calls.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">pyuaf</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="kn">import</span> <span class="n">Address</span><span class="p">,</span> <span class="n">NodeId</span>
<span class="kn">from</span> <span class="nn">pyuaf.util.primitives</span>  <span class="kn">import</span> <span class="n">Byte</span><span class="p">,</span> <span class="n">Double</span>
<span class="kn">from</span> <span class="nn">pyuaf.client</span>           <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.settings</span>  <span class="kn">import</span> <span class="n">ClientSettings</span><span class="p">,</span> <span class="n">SessionSettings</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.configs</span>   <span class="kn">import</span> <span class="n">SessionConfig</span>


<span class="k">print</span><span class="p">(</span><span class="s">&quot;This example will fail when executed, since it tries to connect to non-existing servers&quot;</span><span class="p">)</span>


<span class="c"># create a single SessionConfig object that we will use for all our service calls</span>
<span class="n">cfg</span> <span class="o">=</span> <span class="n">SessionConfig</span><span class="p">()</span>

<span class="c"># configure the default settings for the sessions that will be created</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">defaultSessionSettings</span><span class="o">.</span><span class="n">sessionTimeoutSec</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">defaultSessionSettings</span><span class="o">.</span><span class="n">connectTimeoutSec</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="c"># for a particular server (an embedded device) we expect an unreliable connection,</span>
<span class="c"># so we specify some settings that are more suitable for this particular server</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">specificSessionSettings</span><span class="p">[</span><span class="s">&quot;My/Unreliable/Device/Server&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SessionSettings</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">specificSessionSettings</span><span class="p">[</span><span class="s">&quot;My/Unreliable/Device/Server&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sessionTimeoutSec</span> <span class="o">=</span> <span class="mf">200.0</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">specificSessionSettings</span><span class="p">[</span><span class="s">&quot;My/Unreliable/Device/Server&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">connectTimeoutSec</span> <span class="o">=</span> <span class="mf">5.0</span>

<span class="c"># we also have a particular very reliable and fast server (some PLC), for which we want to</span>
<span class="c"># specify other settings:</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">specificSessionSettings</span><span class="p">[</span><span class="s">&quot;My/Reliable/PLC/Server&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SessionSettings</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">specificSessionSettings</span><span class="p">[</span><span class="s">&quot;My/Reliable/PLC/Server&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">connectTimeoutSec</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="c"># Now we can use the same config for many different service calls.</span>
<span class="c"># Sessions will be created silently in the background by the UAF, based on the</span>
<span class="c"># settings we provided via the &#39;cfg&#39; object.</span>
<span class="c"># If sessions need to be created to the &quot;My/Unreliable/Device/Uri&quot; or &quot;My/Reliable/PLC/Uri&quot;</span>
<span class="c"># servers, they will be created according to the specified settings.</span>
<span class="c"># If sessions need to be created to other servers, they will be created according to the</span>
<span class="c"># defaultSessionSettings settings.</span>

<span class="c"># configure a client ...</span>
<span class="n">clientSettings</span> <span class="o">=</span> <span class="n">ClientSettings</span><span class="p">()</span> 
<span class="n">clientSettings</span><span class="o">.</span><span class="n">applicationName</span> <span class="o">=</span> <span class="s">&quot;MyClient&quot;</span><span class="p">;</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">discoveryUrls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;opc.tcp://10.133.78.42&quot;</span><span class="p">)</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">discoveryUrls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;opc.tcp://10.133.78.81&quot;</span><span class="p">)</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">discoveryUrls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;opc.tcp://10.134.25.16&quot;</span><span class="p">)</span>

<span class="c"># ... and create the client</span>
<span class="n">myClient</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">clientSettings</span><span class="p">)</span>

<span class="c"># define some addresses</span>
<span class="n">temperature1</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="n">NodeId</span><span class="p">(</span><span class="s">&quot;temperature1&quot;</span> <span class="p">,</span> <span class="s">&quot;MyCompanyNamespace&quot;</span><span class="p">),</span> <span class="s">&quot;Some/OPCUA/Server&quot;</span><span class="p">)</span>
<span class="n">temperature2</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="n">NodeId</span><span class="p">(</span><span class="s">&quot;temperature2&quot;</span> <span class="p">,</span> <span class="s">&quot;MyCompanyNamespace&quot;</span><span class="p">),</span> <span class="s">&quot;Some/OPCUA/Server&quot;</span><span class="p">)</span>
<span class="n">pressure0005</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="n">NodeId</span><span class="p">(</span><span class="s">&quot;pressure0005&quot;</span> <span class="p">,</span> <span class="s">&quot;MyCompanyNamespace&quot;</span><span class="p">),</span> <span class="s">&quot;My/Unreliable/Device/Server&quot;</span><span class="p">)</span>
<span class="n">motorStatus3</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="n">NodeId</span><span class="p">(</span><span class="s">&quot;motorStatus3&quot;</span> <span class="p">,</span> <span class="s">&quot;MyCompanyNamespace&quot;</span><span class="p">),</span> <span class="s">&quot;My/Reliable/PLC/Server&quot;</span><span class="p">)</span>

<span class="c"># now we can read, write, ... any address(es) without worrying about the settings of the sessions!</span>

<span class="c"># read the Value attribute of the 4 nodes</span>
<span class="n">myReadResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">([</span><span class="n">temperature1</span><span class="p">,</span> <span class="n">temperature2</span><span class="p">,</span> <span class="n">pressure0005</span><span class="p">,</span> <span class="n">motorStatus3</span><span class="p">],</span> <span class="n">sessionConfig</span><span class="o">=</span><span class="n">cfg</span><span class="p">)</span>

<span class="c"># write a new motor status</span>
<span class="n">myWriteResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">write</span><span class="p">([</span><span class="n">motorStatus3</span><span class="p">],</span> <span class="p">[</span><span class="n">Byte</span><span class="p">(</span><span class="mh">0x3</span><span class="p">)],</span> <span class="n">sessionConfig</span><span class="o">=</span><span class="n">cfg</span><span class="p">)</span>
                             
<span class="c"># do some other stuff like monitoring variables, calling methods, ... all using</span>
<span class="c"># the same SessionConfig object (&#39;cfg&#39;)</span>
<span class="c"># ...</span>

<span class="c"># don&#39;t worry about disconnecting sessions etc., these things will be done automatically</span>
<span class="c"># when the client is destroyed.</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-change-the-default-subscription-behavior">
<span id="subscriptionconfig-example"></span><h2>How to change the default subscription_behavior?<a class="headerlink" href="#how-to-change-the-default-subscription-behavior" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># examples/pyuaf/client/how_to_change_the_default_subscription_behavior.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">EXAMPLE: how to change the default subscription behavior.</span>
<span class="sd">=================================================================================================</span>

<span class="sd">A SubscriptionConfig instance can be used to configure one or more subscriptions that need to be</span>
<span class="sd">created, e.g. in order to successfully create some MonitoredItems.</span>

<span class="sd">This is an example to show you some more advanced feature of the UAF, you can skip it if you&#39;re </span>
<span class="sd">happy with the default subscription behavior of the UAF!</span>

<span class="sd">As always, in the UAF terminology, a &quot;config&quot; object holds one or more &quot;settings&quot; objects.</span>

<span class="sd">In this case, a SubscriptionConfig holds</span>
<span class="sd"> - one SubscriptionSettings object to specify &quot;default&quot; settings for subscriptions that need to</span>
<span class="sd">   be created</span>
<span class="sd"> - and optionally some particular SubscriptionSettings objects for subscriptions to particular</span>
<span class="sd">   servers.</span>

<span class="sd">Because a SubscriptionConfig can contain settings for many different servers, you can create and</span>
<span class="sd">configure one SubscriptionConfig, and then re-use this SubscriptionConfig for multiple service</span>
<span class="sd">calls.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">pyuaf</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="kn">import</span> <span class="n">Address</span><span class="p">,</span> <span class="n">NodeId</span>
<span class="kn">from</span> <span class="nn">pyuaf.util.primitives</span>  <span class="kn">import</span> <span class="n">Byte</span><span class="p">,</span> <span class="n">Double</span>
<span class="kn">from</span> <span class="nn">pyuaf.client</span>           <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.settings</span>  <span class="kn">import</span> <span class="n">ClientSettings</span><span class="p">,</span> <span class="n">SubscriptionSettings</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.configs</span>   <span class="kn">import</span> <span class="n">SubscriptionConfig</span>


<span class="k">print</span><span class="p">(</span><span class="s">&quot;This example will fail when executed, since it tries to connect to non-existing servers&quot;</span><span class="p">)</span>


<span class="c"># create a single SubscriptionConfig object that we will use for all our service calls</span>
<span class="n">cfg</span> <span class="o">=</span> <span class="n">SubscriptionConfig</span><span class="p">()</span>

<span class="c"># configure the default settings for the sessions that will be created</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">defaultSubscriptionSettings</span><span class="o">.</span><span class="n">publishingIntervalSec</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">defaultSubscriptionSettings</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="mi">50</span>

<span class="c"># for a particular server (a small embedded device) we want to create a subscription with a</span>
<span class="c"># slow publishing interval, so that we don&#39;t require too much resources from the device:</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">specificSubscriptionSettings</span><span class="p">[</span><span class="s">&quot;My/Slow/Device/Server&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SubscriptionSettings</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">specificSubscriptionSettings</span><span class="p">[</span><span class="s">&quot;My/Slow/Device/Server&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">publishingIntervalSec</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="c"># we also have a very fast server (some high-end PLC), from which we want to receive updates</span>
<span class="c"># much faster (4 times per second!):</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">specificSubscriptionSettings</span><span class="p">[</span><span class="s">&quot;My/Fast/PLC/Server&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SubscriptionSettings</span><span class="p">()</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">specificSubscriptionSettings</span><span class="p">[</span><span class="s">&quot;My/Fast/PLC/Server&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">publishingIntervalSec</span> <span class="o">=</span> <span class="mf">0.25</span>

<span class="c"># Now we can use the same config for many different service calls.</span>
<span class="c"># Subscriptions will be created silently in the background by the UAF, based on the</span>
<span class="c"># settings we provided via the &#39;cfg&#39; object.</span>
<span class="c"># If subscriptions need to be created to the embedded device or the fast PLC, they will be</span>
<span class="c"># created according to the specified settings.</span>
<span class="c"># If subscriptions need to be created to other servers, they will be created according to the</span>
<span class="c"># defaultSubscriptionSettings settings.</span>

<span class="c"># First of all, configure a client ...</span>
<span class="n">clientSettings</span> <span class="o">=</span> <span class="n">ClientSettings</span><span class="p">()</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">applicationName</span> <span class="o">=</span> <span class="s">&quot;MyClient&quot;</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">discoveryUrls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;opc.tcp://10.133.78.42&quot;</span><span class="p">)</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">discoveryUrls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;opc.tcp://10.133.78.81&quot;</span><span class="p">)</span>
<span class="n">clientSettings</span><span class="o">.</span><span class="n">discoveryUrls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;opc.tcp://10.134.25.16&quot;</span><span class="p">)</span>

<span class="c"># ... and create the client</span>
<span class="n">myClient</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">clientSettings</span><span class="p">)</span>

<span class="c"># define some node addresses</span>
<span class="n">temperature1</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="n">NodeId</span><span class="p">(</span><span class="s">&quot;temperature1&quot;</span> <span class="p">,</span> <span class="s">&quot;MyCompanyNamespace&quot;</span><span class="p">),</span> <span class="s">&quot;Some/OPCUA/Server&quot;</span><span class="p">)</span>
<span class="n">temperature2</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="n">NodeId</span><span class="p">(</span><span class="s">&quot;temperature2&quot;</span> <span class="p">,</span> <span class="s">&quot;MyCompanyNamespace&quot;</span><span class="p">),</span> <span class="s">&quot;Some/OPCUA/Server&quot;</span><span class="p">)</span>
<span class="n">pressure0005</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="n">NodeId</span><span class="p">(</span><span class="s">&quot;pressure0005&quot;</span> <span class="p">,</span> <span class="s">&quot;MyCompanyNamespace&quot;</span><span class="p">),</span> <span class="s">&quot;My/Slow/Device/Server&quot;</span><span class="p">)</span>
<span class="n">motorStatus3</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="n">NodeId</span><span class="p">(</span><span class="s">&quot;motorStatus3&quot;</span> <span class="p">,</span> <span class="s">&quot;MyCompanyNamespace&quot;</span><span class="p">),</span> <span class="s">&quot;My/Fast/PLC/Server&quot;</span><span class="p">)</span>
<span class="n">safetyValve5</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span><span class="n">NodeId</span><span class="p">(</span><span class="s">&quot;safetyValve5&quot;</span> <span class="p">,</span> <span class="s">&quot;MyCompanyNamespace&quot;</span><span class="p">),</span> <span class="s">&quot;My/Fast/PLC/Server&quot;</span><span class="p">)</span>

<span class="c"># now we can monitor any variables or events without worrying about the settings of the subscriptions!</span>

<span class="c"># monitor the 4 variables</span>
<span class="n">myCreateMonitoredDataResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">createMonitoredData</span><span class="p">([</span><span class="n">temperature1</span><span class="p">,</span> <span class="n">temperature2</span><span class="p">,</span> <span class="n">pressure0005</span><span class="p">,</span> <span class="n">motorStatus3</span><span class="p">],</span> 
                                                           <span class="n">subscriptionConfig</span><span class="o">=</span><span class="n">cfg</span><span class="p">)</span>

<span class="c"># monitor the valve object that may send events</span>
<span class="c"># Note that the previous call already resulted in the creation of a &quot;fast&quot; subscription to</span>
<span class="c"># our fast PLC server. So in the next call, this subscription will be re-used (so no new</span>
<span class="c"># subscription will be created).</span>
<span class="n">myCreateMonitoredEventsResult</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">createMonitoredEvents</span><span class="p">([</span><span class="n">safetyValve5</span><span class="p">],</span> <span class="n">subscriptionConfig</span><span class="o">=</span><span class="n">cfg</span><span class="p">)</span>

<span class="c"># do some other stuff, each time using the same SubscriptionConfig object (&#39;cfg&#39;)</span>
<span class="c"># ...</span>

<span class="c"># don&#39;t worry about disconnecting sessions etc., these things will be done automatically</span>
<span class="c"># when the client is destroyed.</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-manually-connect-to-an-endpoint-without-discovery">
<span id="manual-connection-to-endpoint"></span><h2>How to manually connect to an endpoint without discovery?<a class="headerlink" href="#how-to-manually-connect-to-an-endpoint-without-discovery" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># examples/pyuaf/client/how_to_manually_connect_to_an_endpoint_without_discovery.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">EXAMPLE: how to browse some nodes</span>
<span class="sd">====================================================================================================</span>

<span class="sd">A UAF client normally uses the discovery process to identify a server and connect to it.</span>
<span class="sd">The user therefore doesn&#39;t have to worry about connecting, disconnecting, session management, etc.</span>

<span class="sd">However, in certain cases you may want to connect manually to a specific endpoint, without using</span>
<span class="sd">the discovery process (i.e. without relying on the discovery endpoint of the server). </span>

<span class="sd">This example will show you how to manually connect to the UaServerCPP demo server of Untified </span>
<span class="sd">Automation, without any discovery involved. </span>

<span class="sd">To run the example, start the UaServerCPP of UnifiedAutomation first on the same machine. </span>
<span class="sd">($SDK/bin/uaservercpp, this executable is part of the SDK).</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">pyuaf</span>
<span class="kn">from</span> <span class="nn">pyuaf.client</span>           <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">pyuaf.client.settings</span>  <span class="kn">import</span> <span class="n">ClientSettings</span>
<span class="kn">from</span> <span class="nn">pyuaf.util</span>             <span class="kn">import</span> <span class="n">Address</span><span class="p">,</span> <span class="n">NodeId</span>
<span class="kn">from</span> <span class="nn">pyuaf.util.errors</span>      <span class="kn">import</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">ConnectionError</span>


<span class="c"># define the ClientSettings (note that we do NOT provide a discoveryUrl!!!):</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">ClientSettings</span><span class="p">()</span>
<span class="n">settings</span><span class="o">.</span><span class="n">applicationName</span> <span class="o">=</span> <span class="s">&quot;MyClient&quot;</span>
<span class="c"># settings.logToStdOutLevel = pyuaf.util.loglevels.Debug # uncomment to see the full UAF logging</span>

<span class="c"># create the client</span>
<span class="n">myClient</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>

<span class="c"># Now manually connect to an endpoint of the demo server using &#39;manuallyConnectToEndpoint()&#39;.</span>
<span class="c">#  - The first argument (endpointUrl) is the URL of the endpoint you want to connect to </span>
<span class="c">#  - The optional (!) second argument (sessionSettings) a SessionSettings instance.</span>
<span class="c">#    If you don&#39;t provide one, then a default SessionSettings instance will be used.</span>
<span class="c">#    A default SessionSettings instance has:</span>
<span class="c">#     - no security policy (pyuaf.util.securitypolicies.UA_None)</span>
<span class="c">#     - no security mode (pyuaf.util.messagesecuritymodes.Mode_None)</span>
<span class="c">#     - no authentication (pyuaf.util.usertokentypes.Anonymous)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Now connecting&quot;</span><span class="p">)</span>
    <span class="n">clientConnectionId</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">manuallyConnectToEndpoint</span><span class="p">(</span><span class="s">&quot;opc.tcp://localhost:48010&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ConnectionError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="c"># if an error was raised, then no Session has been created! </span>
    <span class="c"># In other words, the client is back in it&#39;s original state, there is no </span>
    <span class="c"># session that tries to reconnect in the background.</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;ConnectionError -&gt; sys.exit()&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;UafError -&gt; sys.exit()&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>


<span class="c"># The clientConnectionId is a number that identifies the session.</span>
<span class="c"># You can use it to request some information about the Session that you just created:</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Now getting the session information&quot;</span><span class="p">)</span>
    
    <span class="n">info</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">sessionInformation</span><span class="p">(</span><span class="n">clientConnectionId</span><span class="p">)</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;SessionInformation:&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
    
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t read the session information: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Exiting...&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>


<span class="c"># now use the server URI to read some variables</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Now reading some variables&quot;</span><span class="p">)</span>
    
    <span class="c"># define the namespace URI of the UaDemoServer:</span>
    <span class="n">demoNsUri</span> <span class="o">=</span> <span class="s">&quot;http://www.unifiedautomation.com/DemoServer&quot;</span>
    
    <span class="c"># define some addresses:</span>
    <span class="n">someDoubleNode</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s">&quot;Demo.Static.Scalar.Double&quot;</span><span class="p">,</span> <span class="n">demoNsUri</span><span class="p">),</span> <span class="n">info</span><span class="o">.</span><span class="n">serverUri</span> <span class="p">)</span>
    <span class="n">someUInt32Node</span> <span class="o">=</span> <span class="n">Address</span><span class="p">(</span> <span class="n">NodeId</span><span class="p">(</span><span class="s">&quot;Demo.Static.Scalar.UInt32&quot;</span><span class="p">,</span> <span class="n">demoNsUri</span><span class="p">),</span> <span class="n">info</span><span class="o">.</span><span class="n">serverUri</span> <span class="p">)</span>
    
    <span class="c"># read the nodes of the addresses:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">myClient</span><span class="o">.</span><span class="n">read</span><span class="p">([</span><span class="n">someDoubleNode</span><span class="p">,</span> <span class="n">someUInt32Node</span><span class="p">])</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;ReadResult:&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    
<span class="k">except</span> <span class="n">UafError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t read some variables: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">e</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Exiting...&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/uaf_logo_200x67_transparent.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Client examples</a><ul>
<li><a class="reference internal" href="#easiest-client-example">Easiest client example</a></li>
<li><a class="reference internal" href="#how-to-define-addresses">How to define addresses?</a></li>
<li><a class="reference internal" href="#how-to-read-some-data">How to read some data?</a></li>
<li><a class="reference internal" href="#how-to-browse-some-nodes">How to browse some nodes?</a></li>
<li><a class="reference internal" href="#how-to-read-some-historical-data">How to read some historical data?</a></li>
<li><a class="reference internal" href="#how-to-change-the-default-session-behavior">How to change the default session behavior?</a></li>
<li><a class="reference internal" href="#how-to-change-the-default-subscription-behavior">How to change the default subscription_behavior?</a></li>
<li><a class="reference internal" href="#how-to-manually-connect-to-an-endpoint-without-discovery">How to manually connect to an endpoint without discovery?</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">PyUAF - Python bindings for the UAF (Unified Architecture Framework)</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="api_pyuaf.html"
                        title="next chapter"><tt class="docutils literal"><span class="pre">pyuaf</span></tt></a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/client_examples.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api_pyuaf.html" title="pyuaf"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="PyUAF - Python bindings for the UAF (Unified Architecture Framework)"
             >previous</a> |</li>
        <li><a href="index.html">PyUAF 1.8 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Wim Pessemier (Institute for Astronomy, KU Leuven) - http://github.com/uaf.
    </div>
  </body>
</html>